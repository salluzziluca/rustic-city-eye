<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: white;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
    content: counter(line);
    margin-right: 10px;
}
.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
  counter-increment: line;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","doc","mod.rs"],"content":"\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","drone_system","mod.rs"],"content":"\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","lib.rs"],"content":"pub mod doc;\npub mod drone_system;\nmod utils;\n#[doc = include_str!(\"doc/informe.md\")]\n#[doc = include_str!(\"doc/marco_teorico.md\")]\n\npub mod mqtt {\n    pub mod connect_config;\n    pub mod messages_config;\n    pub mod publish_config;\n    pub mod subscribe_config;\n\n    pub mod broker_message;\n    pub mod client;\n    pub mod client_message;\n    pub mod connect_properties;\n    pub mod protocol_error;\n    pub mod publish_properties;\n    pub mod reason_code;\n    pub mod subscribe_properties;\n    pub mod topic;\n    pub mod will_properties;\n\n    pub mod broker;\n    pub mod broker_config;\n\n    pub mod error;\n    pub mod protocol_return;\n}\n\npub mod monitoring {\n    pub mod incident;\n    pub mod monitoring_app;\n    pub mod monitoring_config;\n}\n\npub mod surveilling {\n    pub mod camera;\n    pub mod camera_system;\n    pub mod location;\n}\n\n// pub mod utils {\n//     pub mod reader;\n//     pub mod threadpool;\n//     pub mod writer;\n// }\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","monitoring","incident.rs"],"content":"use crate::surveilling::location::Location;\n\n#[derive(Debug, Clone)]\n#[allow(dead_code)]\npub struct Incident {\n    location: Location,\n}\n\nimpl Incident {\n    pub fn new(location: Location) -\u003e Incident {\n        Self { location }\n    }\n\n    pub fn parse_to_string(\u0026self) -\u003e String {\n        format!(\"Incident at {}\", self.location.parse_to_string())\n    }\n\n    pub fn from_string(incident: String) -\u003e Incident {\n        let location = incident.split(\" at \").collect::\u003cVec\u003c\u0026str\u003e\u003e()[1];\n        Incident {\n            location: Location::new(\n                location.split(\", \").collect::\u003cVec\u003c\u0026str\u003e\u003e()[0].to_string(),\n                location.split(\", \").collect::\u003cVec\u003c\u0026str\u003e\u003e()[1].to_string(),\n            ),\n        }\n    }\n\n    pub fn get_location(\u0026self) -\u003e Location {\n        self.location.clone()\n    }\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":8},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","monitoring","main.rs"],"content":"// extern crate gtk;\n\n// use gtk::glib::clone;\n// use gtk::{gdk, prelude::*};\n// use gtk::{glib, Window, WindowType};\n// use gtk::{Application, Box, Button, Entry, Label, Orientation};\n// use webkit2gtk::gio;\n// use webkit2gtk::{WebView, WebViewExt};\n\n// use std::cell::RefCell;\n// use std::rc::Rc;\n\n// use rustic_city_eye::monitoring::monitoring_app::MonitoringApp;\n// use rustic_city_eye::mqtt::protocol_error::ProtocolError;\n// use rustic_city_eye::surveilling::location::Location;\n\n// fn main() -\u003e Result\u003c(), ProtocolError\u003e {\n//     let app = Application::builder()\n//         .application_id(\"com.example.RusticCityEye\")\n//         .build();\n\n//     app.connect_activate(|app| {\n//         let home_window = Window::new(WindowType::Toplevel);\n//         home_window.set_title(\"Rustic City Eye\");\n//         home_window.set_default_size(2000, 1500);\n\n//         let vbox = Box::new(Orientation::Vertical, 5);\n\n//         let button = Button::with_label(\"Conectarse a un servidor\");\n//         vbox.pack_start(\u0026button, false, false, 0);\n\n//         let elements_container = Box::new(Orientation::Vertical, 5);\n//         vbox.pack_start(\u0026elements_container, true, true, 0);\n\n//         button.connect_clicked(clone!(@weak button, @weak elements_container =\u003e move |_| {\n//             button.hide();\n\n//             handle_connection(\u0026elements_container);\n\n//             elements_container.show_all();\n//         }));\n\n//         // Agrega la caja a la ventana.\n//         home_window.add(\u0026vbox);\n\n//         // Muestra todos los widgets en la ventana.\n//         home_window.show_all();\n\n//         // Configura la aplicaci√≥n principal.\n//         home_window.set_application(Some(app));\n//     });\n\n//     app.run();\n\n//     Ok(())\n// }\n\n// #[allow(clippy::useless_format)]\n// fn handle_connection(elements_container: \u0026gtk::Box) {\n//     let (connect_form, host, port, user, password, connect_btn) = get_connect_form();\n\n//     elements_container.pack_start(\u0026connect_form, false, false, 0);\n\n//     connect_btn.connect_clicked(clone!(@weak host, @weak port, @weak user, @weak password, @weak elements_container =\u003e move |_| {\n//         let args = vec![host.text().to_string(), port.text().to_string(), user.text().to_string(), password.text().to_string()];\n\n//         match MonitoringApp::new(args) {\n//             Ok(mut monitoring_app) =\u003e {\n//                 elements_container.foreach(|widget| {\n//                     elements_container.remove(widget);\n//                 });\n\n//                 let _ = monitoring_app.run_client();\n\n//                 // Create the horizontal box to hold the map and the panel\n//                 let hbox = Box::new(Orientation::Horizontal, 5);\n//                 elements_container.pack_start(\u0026hbox, true, true, 0);\n\n//                 let webview = WebView::new();\n//                 hbox.pack_start(\u0026webview, true, true, 0);\n\n//                 // Create the panel for camera list and buttons\n//                 let panel = Box::new(Orientation::Vertical, 5);\n//                 hbox.pack_start(\u0026panel, false, false, 0);\n\n//                 let add_camera_btn = Button::with_label(\"Add camera\");\n//                 panel.pack_start(\u0026add_camera_btn, false, false, 0);\n\n//                 let add_incident_btn = Button::with_label(\"Add incident\");\n//                 panel.pack_start(\u0026add_incident_btn, false, false, 0);\n\n//                 // Create the camera list panel\n//                 let camera_list_box = Box::new(Orientation::Vertical, 5);\n//                 panel.pack_start(\u0026camera_list_box, true, true, 0);\n\n//                 // Load Leaflet map\n//                 let html_content = format!(r#\"\n//                     \u003c!DOCTYPE html\u003e\n//                     \u003chtml\u003e\n//                     \u003chead\u003e\n//                         \u003ctitle\u003eMap\u003c/title\u003e\n//                         \u003cmeta charset=\"utf-8\" /\u003e\n//                         \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n//                         \u003clink rel=\"stylesheet\" href=\"https://unpkg.com/leaflet/dist/leaflet.css\" /\u003e\n//                         \u003cscript src=\"https://unpkg.com/leaflet/dist/leaflet.js\"\u003e\u003c/script\u003e\n//                     \u003c/head\u003e\n//                     \u003cbody\u003e\n//                         \u003cdiv id=\"map\" style=\"width: 100%; height: 100vh;\"\u003e\u003c/div\u003e\n//                         \u003cscript\u003e\n//                             var lat = -34.615077;\n//                             var lon = -58.368084;\n//                             var map = L.map('map').setView([lat, lon], 16);\n//                             L.tileLayer('https://{{s}}.tile.openstreetmap.org/{{z}}/{{x}}/{{y}}.png', {{\n//                                     attribution: '\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors'\n//                                 }}).addTo(map);\n//                                 function getLatLngFromPixel(x, y) {{\n//                                         var latlng = map.containerPointToLatLng([x, y]);\n//                                         return {{ lat: latlng.lat, lng: latlng.lng }};\n//                                     }}\n//                         \u003c/script\u003e\n//                     \u003c/body\u003e\n//                     \u003c/html\u003e\n//                 \"#);\n\n//                 webview.load_html(\u0026html_content, None);\n//                 let webview_clone = webview.clone();\n//                 let monitoring_app_ref = Rc::new(RefCell::new(monitoring_app));\n//                 let x = Rc::new(RefCell::new(0.0));\n//                 let y = Rc::new(RefCell::new(0.0));\n//                 add_camera_btn.connect_clicked(clone!(@strong y, @strong x, @strong monitoring_app_ref, @strong camera_list_box =\u003e move |_| {\n//                     on_add_camera_clicked(y.clone(), x.clone(), monitoring_app_ref.clone(), Rc::new(RefCell::new(camera_list_box.clone())));\n//                 }));\n//                 add_incident_btn.connect_clicked(clone!(@strong y, @strong x, @strong monitoring_app_ref =\u003e move |_| {\n//                     on_add_incident_clicked(y.clone(), x.clone(), monitoring_app_ref.clone());\n//                 }));\n\n//                 webview.connect_button_press_event(clone!(@strong x, @strong y, @strong monitoring_app_ref =\u003e move |_, event| {\n//                     on_webview_button_press_event(x.clone(), y.clone(), webview_clone.clone(), event).into()\n//                 }));\n\n//                 elements_container.show_all();\n\n//                 // Initial call to populate the camera list\n//                 update_camera_list(\u0026camera_list_box, \u0026monitoring_app_ref);\n//             },\n//             Err(_) =\u003e {\n//                 println!(\"Error: intenta conectarte de nuevo\");\n\n//                 handle_connection(\u0026elements_container);\n//             },\n//         }\n//     }));\n// }\n\n// fn get_connect_form() -\u003e (gtk::Box, Entry, Entry, Entry, Entry, gtk::Button) {\n//     let vbox = Box::new(Orientation::Vertical, 5);\n\n//     let label = Label::new(Some(\"Ingrese al servidor\"));\n\n//     let host = Entry::new();\n//     host.set_placeholder_text(Some(\"Host: \"));\n\n//     let port = Entry::new();\n//     port.set_placeholder_text(Some(\"Port: \"));\n\n//     let user = Entry::new();\n//     user.set_placeholder_text(Some(\"Username: \"));\n\n//     let password = Entry::new();\n//     password.set_placeholder_text(Some(\"Password: \"));\n\n//     let connect_btn = Button::with_label(\"Conectarse\");\n//     vbox.pack_start(\u0026label, false, false, 0);\n//     vbox.pack_start(\u0026host, false, false, 0);\n//     vbox.pack_start(\u0026port, false, false, 0);\n//     vbox.pack_start(\u0026user, false, false, 0);\n//     vbox.pack_start(\u0026password, false, false, 0);\n//     vbox.pack_start(\u0026connect_btn, false, false, 0);\n\n//     (vbox, host, port, user, password, connect_btn)\n// }\n\n// fn update_camera_list(camera_list_box: \u0026gtk::Box, monitoring_app_ref: \u0026Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e) {\n//     // Clear the existing list\n//     camera_list_box.foreach(|widget| {\n//         camera_list_box.remove(widget);\n//     });\n\n//     // Fetch the list of cameras from the monitoring app\n//     let cameras = monitoring_app_ref.borrow().get_cameras(); // Assuming you have a method to get the list of cameras\n\n//     // Add each camera to the list box\n//     for camera in cameras {\n//         let location = camera.get_location();\n//         let camera_label = Label::new(Some(\u0026format!(\n//             \"Camera at ({}, {})\",\n//             location.latitude, location.longitude\n//         )));\n//         camera_list_box.pack_start(\u0026camera_label, false, false, 0);\n//     }\n\n//     camera_list_box.show_all();\n// }\n\n// fn on_add_camera_clicked(\n//     y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     monitoring_app_ref: Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n//     camera_list_box: Rc\u003cRefCell\u003cgtk::Box\u003e\u003e,\n// ) {\n//     let lat = format!(\"{:.2}\", y.borrow());\n//     let long = format!(\"{:.2}\", x.borrow());\n//     let camera_location = Location::new(lat, long);\n//     monitoring_app_ref.borrow_mut().add_camera(camera_location);\n\n//     // Update the camera list panel\n//     update_camera_list(\u0026camera_list_box.borrow(), \u0026monitoring_app_ref);\n// }\n\n// fn on_webview_button_press_event(\n//     x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     webview_clone: WebView,\n//     event: \u0026gdk::EventButton,\n// ) -\u003e bool {\n//     if event.button() == 1 {\n//         let pos_x = event.position().0;\n//         let pos_y = event.position().1;\n\n//         let _script = format!(\n//             \"var result = getLatLngFromPixel({}, {});\n//              JSON.stringify(result);\",\n//             pos_x, pos_y\n//         );\n\n//         *x.borrow_mut() = pos_x;\n//         *y.borrow_mut() = pos_y;\n\n//         webview_clone.run_javascript(\n//             \u0026format!(\"window.map.setView(window.map.containerPointToLatLng([{}, {}]), window.map.getZoom());\", pos_x, pos_y),\n//             None::\u003c\u0026gio::Cancellable\u003e,\n//             |_result| (),\n//         );\n//     }\n//     false\n// }\n\n// ///Se toma la localizacion del click actual, y se crea una incidente nuevo dentro de la app de monitoreo\n// fn on_add_incident_clicked(\n//     y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     monitoring_app_ref: Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n// ) {\n//     let lat = y.borrow().to_string();\n//     let long = x.borrow().to_string();\n//     let incident_location = Location::new(lat, long);\n//     monitoring_app_ref\n//         .borrow_mut()\n//         .add_incident(incident_location);\n// }\n\nextern crate gtk;\n\nuse gtk::glib::clone;\nuse gtk::prelude::*;\nuse gtk::{glib, Window, WindowType};\nuse gtk::{Application, Box, Button, Entry, Label, Orientation};\n\nuse std::cell::RefCell;\nuse std::rc::Rc;\n\nuse rustic_city_eye::monitoring::monitoring_app::MonitoringApp;\nuse rustic_city_eye::mqtt::protocol_error::ProtocolError;\nuse rustic_city_eye::surveilling::location::Location;\n\n#[cfg(not(test))]\nfn main() -\u003e Result\u003c(), ProtocolError\u003e {\n    let app = Application::builder()\n        .application_id(\"com.example.RusticCityEye\")\n        .build();\n\n    app.connect_activate(|app| {\n        let home_window = Window::new(WindowType::Toplevel);\n        home_window.set_title(\"Rustic City Eye\");\n        home_window.set_default_size(2000, 1500);\n\n        let vbox = Box::new(Orientation::Vertical, 5);\n\n        let button = Button::with_label(\"Conectarse a un servidor\");\n        vbox.pack_start(\u0026button, false, false, 0);\n\n        let elements_container = Box::new(Orientation::Vertical, 5);\n        vbox.pack_start(\u0026elements_container, true, true, 0);\n\n        button.connect_clicked(clone!(@weak button, @weak elements_container =\u003e move |_| {\n            button.hide();\n\n            handle_connection(\u0026elements_container);\n\n            elements_container.show_all();\n        }));\n\n        // Agrega la caja a la ventana.\n        home_window.add(\u0026vbox);\n\n        // Muestra todos los widgets en la ventana.\n        home_window.show_all();\n\n        // Configura la aplicaci√≥n principal.\n        home_window.set_application(Some(app));\n    });\n\n    app.run();\n\n    Ok(())\n}\n\n#[cfg(not(test))]\nfn handle_connection(elements_container: \u0026gtk::Box) {\n    let (connect_form, host, port, user, password, connect_btn) = get_connect_form();\n\n    elements_container.pack_start(\u0026connect_form, false, false, 0);\n\n    connect_btn.connect_clicked(clone!(@weak host, @weak port, @weak user, @weak password, @weak elements_container =\u003e move |_| {\n        let args = vec![host.text().to_string(), port.text().to_string(), user.text().to_string(), password.text().to_string()];\n\n        match MonitoringApp::new(args) {\n            Ok(mut monitoring_app) =\u003e {\n                elements_container.foreach(|widget| {\n                    elements_container.remove(widget);\n                });\n\n                let _ = monitoring_app.run_client();\n\n                // Create the horizontal box to hold the map and the panel\n                let hbox = gtk::Box::new(gtk::Orientation::Horizontal, 5);\n                elements_container.pack_start(\u0026hbox, true, true, 0);\n\n                // Create a new image widget\n                let image = gtk::Image::from_file(\"src/monitoring/Map.png\");\n\n                // Create a new event box\n                let event_box = gtk::EventBox::new();\n                event_box.add(\u0026image);\n\n                // Add the event box to the horizontal box\n                hbox.add(\u0026event_box);\n\n                // Create a vertical box to hold buttons for the panel\n                let vbox = gtk::Box::new(gtk::Orientation::Vertical, 0);\n\n                // Create a button for adding a camera\n                let add_camera_button = gtk::Button::with_label(\"Add Camera\");\n                vbox.add(\u0026add_camera_button);\n\n                // Create a button for adding an incident\n                let add_incident_button = gtk::Button::with_label(\"Add Incident\");\n                vbox.add(\u0026add_incident_button);\n\n                // Create the panel for camera list and buttons\n                let panel = gtk::Box::new(gtk::Orientation::Vertical, 5);\n                hbox.pack_start(\u0026panel, false, false, 0);\n\n                let add_camera_btn = gtk::Button::with_label(\"Add camera\");\n                panel.pack_start(\u0026add_camera_btn, false, false, 0);\n\n                let add_incident_btn = gtk::Button::with_label(\"Add incident\");\n                panel.pack_start(\u0026add_incident_btn, false, false, 0);\n\n                // Create the camera list panel\n                let camera_list_box = gtk::Box::new(gtk::Orientation::Vertical, 5);\n                panel.pack_start(\u0026camera_list_box, true, true, 0);\n                let camera_list_box = Rc::new(RefCell::new(camera_list_box));\n\n                let incident_list_box = gtk::Box::new(gtk::Orientation::Vertical, 5);\n                panel.pack_start(\u0026incident_list_box, true, true, 0);\n                let incident_list_box = Rc::new(RefCell::new(incident_list_box));\n\n                let monitoring_app_ref = Rc::new(RefCell::new(monitoring_app));\n\n                let (x, y) = (0.0, 0.0);\n                let x_ref = Rc::new(RefCell::new(x));\n                let y_ref = Rc::new(RefCell::new(y));\n                event_box.connect_button_press_event({\n                    let x_ref = Rc::clone(\u0026x_ref);\n                    let y_ref = Rc::clone(\u0026y_ref);\n                    move |_, event| {\n                        x_ref.replace(event.position().0);\n                        y_ref.replace(event.position().1);\n                        println!(\"Image clicked at coordinates {},{}\", x_ref.borrow(), y_ref.borrow());\n                        false.into() // Ensure you return the correct type here\n                    }\n                });\n\n                add_camera_btn.connect_clicked({\n                    let x_ref = Rc::clone(\u0026x_ref);\n                    let y_ref = Rc::clone(\u0026y_ref);\n                    let monitoring_app_ref = Rc::clone(\u0026monitoring_app_ref);\n                    let camera_list_box = Rc::clone(\u0026camera_list_box);\n                    move |_| {\n                        on_add_camera_clicked(Rc::clone(\u0026y_ref), Rc::clone(\u0026x_ref), Rc::clone(\u0026monitoring_app_ref), Rc::clone(\u0026camera_list_box));\n                    }\n                });\n\n                add_incident_btn.connect_clicked({\n                    let x_ref = Rc::clone(\u0026x_ref);\n                    let y_ref = Rc::clone(\u0026y_ref);\n                    let monitoring_app_ref = Rc::clone(\u0026monitoring_app_ref);\n                    let incident_list_box = Rc::clone(\u0026incident_list_box);\n                    move |_| {\n                        on_add_incident_clicked(Rc::clone(\u0026y_ref), Rc::clone(\u0026x_ref), Rc::clone(\u0026monitoring_app_ref), Rc::clone(\u0026incident_list_box));\n                    }\n                });\n\n\n                // add_incident_btn.connect_clicked({\n                //     let x_ref = Rc::clone(\u0026x_ref);\n                //     let y_ref = Rc::clone(\u0026y_ref);\n                //     let monitoring_app_ref = Rc::clone(\u0026monitoring_app_ref);\n                //     move |_| {\n                //         on_add_incident_clicked(Rc::clone(\u0026y_ref), Rc::clone(\u0026x_ref), Rc::clone(\u0026monitoring_app_ref));\n                //     }\n                // });\n\n                elements_container.add(\u0026hbox);\n\n                elements_container.show_all();\n\n                // Initial call to populate the camera list\n                update_camera_list(\u0026camera_list_box.borrow(), \u0026monitoring_app_ref);\n            },\n            Err(_) =\u003e {\n                println!(\"Error: intenta conectarte de nuevo\");\n\n                handle_connection(\u0026elements_container);\n            },\n        }\n        }));\n}\n\n#[cfg(not(test))]\nfn get_connect_form() -\u003e (gtk::Box, Entry, Entry, Entry, Entry, gtk::Button) {\n    let vbox = Box::new(Orientation::Vertical, 5);\n\n    let label = Label::new(Some(\"Ingrese al servidor\"));\n\n    let host = Entry::new();\n    host.set_placeholder_text(Some(\"Host: \"));\n\n    let port = Entry::new();\n    port.set_placeholder_text(Some(\"Port: \"));\n\n    let user = Entry::new();\n    user.set_placeholder_text(Some(\"Username: \"));\n\n    let password = Entry::new();\n    password.set_placeholder_text(Some(\"Password: \"));\n\n    let connect_btn = Button::with_label(\"Conectarse\");\n    vbox.pack_start(\u0026label, false, false, 0);\n    vbox.pack_start(\u0026host, false, false, 0);\n    vbox.pack_start(\u0026port, false, false, 0);\n    vbox.pack_start(\u0026user, false, false, 0);\n    vbox.pack_start(\u0026password, false, false, 0);\n    vbox.pack_start(\u0026connect_btn, false, false, 0);\n\n    (vbox, host, port, user, password, connect_btn)\n}\n#[cfg(not(test))]\n\nfn update_camera_list(camera_list_box: \u0026gtk::Box, monitoring_app_ref: \u0026Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e) {\n    // Clear the existing list\n    camera_list_box.foreach(|widget| {\n        camera_list_box.remove(widget);\n    });\n\n    // Fetch the list of cameras from the monitoring app\n    let cameras = monitoring_app_ref.borrow().get_cameras(); // Assuming you have a method to get the list of cameras\n\n    // Add each camera to the list box\n    for camera in cameras {\n        let location = camera.get_location();\n        let camera_label = gtk::Label::new(Some(\u0026format!(\n            \"Camera at ({}, {})\",\n            location.latitude, location.longitude\n        )));\n        camera_list_box.pack_start(\u0026camera_label, false, false, 0);\n    }\n\n    camera_list_box.show_all();\n}\n\n#[cfg(not(test))]\nfn on_add_camera_clicked(\n    y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n    x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n    monitoring_app_ref: Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n    camera_list_box: Rc\u003cRefCell\u003cgtk::Box\u003e\u003e,\n) {\n    let lat = format!(\"{:.2}\", y.borrow());\n    let long = format!(\"{:.2}\", x.borrow());\n    let camera_location = Location::new(lat, long);\n    monitoring_app_ref.borrow_mut().add_camera(camera_location);\n\n    // Update the camera list panel\n    update_camera_list(\u0026camera_list_box.borrow(), \u0026monitoring_app_ref);\n}\n\n///Se toma la localizacion del click actual, y se crea una incidente nuevo dentro de la app de monitoreo\nfn on_add_incident_clicked(\n    y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n    x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n    monitoring_app_ref: Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n    incident_list_box: Rc\u003cRefCell\u003cgtk::Box\u003e\u003e,\n) {\n    let lat = y.borrow().to_string();\n    let long = x.borrow().to_string();\n    let incident_location = Location::new(lat, long);\n    monitoring_app_ref\n        .borrow_mut()\n        .add_incident(incident_location);\n    update_incident_list(\u0026incident_list_box.borrow(), \u0026monitoring_app_ref);\n}\n\nfn update_incident_list(\n    incident_list_box: \u0026gtk::Box,\n    monitoring_app_ref: \u0026Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n) {\n    // Clear the existing list\n    incident_list_box.foreach(|widget| {\n        incident_list_box.remove(widget);\n    });\n\n    // Fetch the list of incidents from the monitoring app\n    let incidents = monitoring_app_ref.borrow().get_incidents(); // Assuming you have a method to get the list of incidents\n\n    // Add each incident to the list box\n    for incident in incidents {\n        let location = incident.get_location();\n        let incident_label = gtk::Label::new(Some(\u0026format!(\n            \"Incident at ({:.2}, {:.2})\",\n            location.latitude, location.longitude\n        )));\n        incident_list_box.pack_start(\u0026incident_label, false, false, 0);\n    }\n\n    incident_list_box.show_all();\n}\n","traces":[{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":289,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":293,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":315,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":324,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":329,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":330,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":387,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":388,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":389,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":390,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":391,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":400,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":401,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":442,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":443,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":445,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":447,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":448,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":450,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":451,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":453,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":454,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":456,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":457,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":459,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":460,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":461,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":462,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":463,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":464,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":465,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":467,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":473,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":474,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":478,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":481,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":482,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":483,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":484,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":485,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":487,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":490,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":494,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":500,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":501,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":502,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":503,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":506,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":510,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":516,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":517,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":518,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":519,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":521,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":522,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":525,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":530,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":531,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":535,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":538,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":539,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":540,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":541,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":542,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":544,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":547,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":86},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","monitoring","monitoring_app.rs"],"content":"//! Se conecta mediante TCP a la direcci√≥n asignada por argv.\n//! Lee lineas desde stdin y las manda mediante el socket.\n\nuse std::sync::mpsc::{self, Sender};\n\nuse crate::monitoring::incident::Incident;\nuse crate::mqtt::connect_config::ConnectConfig;\nuse crate::mqtt::messages_config::MessagesConfig;\nuse crate::mqtt::publish_config::PublishConfig;\nuse crate::mqtt::publish_properties::{PublishProperties, TopicProperties};\nuse crate::mqtt::{\n    client::Client, connect_properties, protocol_error::ProtocolError, will_properties,\n};\nuse crate::surveilling::camera::Camera;\nuse crate::surveilling::{camera_system::*, location::Location};\n\n#[derive(Debug)]\n#[allow(dead_code)]\npub struct MonitoringApp {\n    send_to_client_channel: Sender\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e,\n    monitoring_app_client: Client,\n    camera_system: CameraSystem,\n    incidents: Vec\u003cIncident\u003e,\n}\n\n#[allow(dead_code)]\nimpl MonitoringApp {\n    ///recibe una addres a la que conectarse\n    /// Crea el cliente de la app de monitoreo y lo conecta al broker\n    /// Crea un sistema de c√°maras y agrega una c√°mara al sistema\n    pub fn new(args: Vec\u003cString\u003e) -\u003e Result\u003cMonitoringApp, ProtocolError\u003e {\n        let will_properties = will_properties::WillProperties::new(\n            1,\n            1,\n            1,\n            \"a\".to_string(),\n            \"a\".to_string(),\n            [1, 2, 3].to_vec(),\n            vec![(\"a\".to_string(), \"a\".to_string())],\n        );\n\n        let connect_properties = connect_properties::ConnectProperties::new(\n            30,\n            1,\n            20,\n            20,\n            true,\n            true,\n            vec![(\"hola\".to_string(), \"chau\".to_string())],\n            \"auth\".to_string(),\n            vec![1, 2, 3],\n        );\n\n        let address = args[0].to_string() + \":\" + \u0026args[1].to_string();\n        let camera_system_args = vec![\n            args[0].clone(),\n            args[1].clone(),\n            \"camera_system\".to_string(),\n            \"CamareandoCamaritas123\".to_string(),\n        ];\n\n        let connect_config = ConnectConfig::new(\n            true,\n            true,\n            1,\n            true,\n            35,\n            connect_properties,\n            \"kvtr33\".to_string(),\n            will_properties,\n            \"camera system\".to_string(),\n            \"soy el monitoring y me desconecte\".to_string(),\n            args[2].clone(),\n            args[3].clone(),\n        );\n\n        let camera_system = CameraSystem::new(camera_system_args)?;\n\n        let (tx, rx) = mpsc::channel();\n\n        let monitoring_app = MonitoringApp {\n            send_to_client_channel: tx,\n            incidents: Vec::new(),\n            camera_system,\n            monitoring_app_client: match Client::new(rx, address, connect_config) {\n                Ok(client) =\u003e client,\n                Err(err) =\u003e return Err(err),\n            },\n        };\n\n        Ok(monitoring_app)\n    }\n\n    pub fn run_client(\u0026mut self) -\u003e Result\u003c(), ProtocolError\u003e {\n        self.monitoring_app_client.client_run()?;\n        self.camera_system.run_client()?;\n        Ok(())\n    }\n\n    pub fn add_camera(\u0026mut self, location: Location) {\n        self.camera_system.add_camera(location);\n    }\n\n    pub fn add_incident(\u0026mut self, location: Location) {\n        let incident = Incident::new(location);\n        self.incidents.push(incident.clone());\n\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let properties = PublishProperties::new(\n            1,\n            10,\n            topic_properties,\n            [1, 2, 3].to_vec(),\n            \"a\".to_string(),\n            1,\n            \"a\".to_string(),\n        );\n\n        let publish_config = PublishConfig::new(\n            1,\n            1,\n            0,\n            \"incidente\".to_string(),\n            \"ayudame loco\".to_string(),\n            properties,\n        );\n\n        let _ = self.send_to_client_channel.send(Box::new(publish_config));\n    }\n\n    pub fn get_cameras(\u0026self) -\u003e Vec\u003cCamera\u003e {\n        self.camera_system.get_cameras().clone()\n    }\n\n    pub fn get_incidents(\u0026self) -\u003e Vec\u003cIncident\u003e {\n        self.incidents.clone()\n    }\n}\n","traces":[{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":45},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","monitoring","monitoring_config.rs"],"content":"pub struct MonitoringConfig {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","broker.rs"],"content":"use std::{\n    collections::HashMap,\n    io::{Read, Write},\n    net::{TcpListener, TcpStream},\n    sync::{Arc, Mutex, RwLock},\n};\n\nuse crate::mqtt::{\n    broker_config::BrokerConfig,\n    broker_message::BrokerMessage,\n    client_message::ClientMessage,\n    protocol_error::ProtocolError,\n    protocol_return::ProtocolReturn,\n    reason_code::{\n        NO_MATCHING_SUBSCRIBERS_HEX, SUB_ID_DUP_HEX, SUCCESS_HEX, UNSPECIFIED_ERROR_HEX,\n    },\n    topic::Topic,\n};\nuse crate::utils::threadpool::ThreadPool;\n\nstatic SERVER_ARGS: usize = 2;\n\nconst THREADPOOL_SIZE: usize = 20;\n\n#[derive(Clone)]\npub struct Broker {\n    address: String,\n\n    ///Contiene a todos los Topics.\n    /// Se identifican con un topic_name unico para cada topic.\n    topics: HashMap\u003cString, Topic\u003e,\n\n    /// El u16 corresponde al packet_id del package, y dentro\n    /// de esa clave se guarda el package.\n    packets: Arc\u003cRwLock\u003cHashMap\u003cu16, ClientMessage\u003e\u003e\u003e,\n\n    subs: Vec\u003cu32\u003e,\n\n    clients_ids: Arc\u003cVec\u003cString\u003e\u003e,\n}\n\nimpl Broker {\n    ///Chequea que el numero de argumentos sea valido.\n    pub fn new(args: Vec\u003cString\u003e) -\u003e Result\u003cBroker, ProtocolError\u003e {\n        if args.len() != SERVER_ARGS {\n            let app_name = \u0026args[0];\n            println!(\"Usage:\\n{:?} \u003cpuerto\u003e\", app_name);\n            return Err(ProtocolError::InvalidNumberOfArguments);\n        }\n\n        let address = \"0.0.0.0:\".to_owned() + \u0026args[1];\n\n        let broker_config = BrokerConfig::new(address)?;\n\n        let (address, topics) = broker_config.get_broker_config();\n\n        let packets = HashMap::new();\n\n        Ok(Broker {\n            address,\n            topics,\n            packets: Arc::new(RwLock::new(packets)),\n            subs: Vec::new(),\n            clients_ids: Arc::new(Vec::new()),\n        })\n    }\n\n    /// Ejecuta el servidor.\n    /// Crea un enlace en la direcci√≥n del broker y, para\n    /// cada conexi√≥n entrante, crea un hilo para manejar el nuevo cliente.\n    pub fn server_run(\u0026mut self) -\u003e std::io::Result\u003c()\u003e {\n        let listener = TcpListener::bind(\u0026self.address)?;\n        println!(\"Broker escuchando en {}\", self.address);\n        let threadpool = ThreadPool::new(THREADPOOL_SIZE);\n\n        for stream in listener.incoming() {\n            match stream {\n                Ok(stream) =\u003e {\n                    let topics_clone = self.topics.clone();\n                    let packets_clone = self.packets.clone();\n                    let subs_clone = self.subs.clone();\n                    let clients_ids_clone = self.clients_ids.clone();\n\n                    threadpool.execute(move || {\n                        // Use the cloned reference\n                        let _ = Broker::handle_client(\n                            stream,\n                            topics_clone,\n                            packets_clone,\n                            subs_clone,\n                            clients_ids_clone,\n                        );\n                    });\n                }\n                Err(err) =\u003e return Err(err),\n            }\n        }\n        Ok(())\n    }\n\n    ///Se encarga del manejo de los mensajes del cliente. Envia los ACKs correspondientes.\n    pub fn handle_client(\n        stream: TcpStream,\n        topics: HashMap\u003cString, Topic\u003e,\n        packets: Arc\u003cRwLock\u003cHashMap\u003cu16, ClientMessage\u003e\u003e\u003e,\n        _subs: Vec\u003cu32\u003e,\n        mut clients_ids: Arc\u003cVec\u003cString\u003e\u003e,\n    ) -\u003e Result\u003c(), ProtocolError\u003e {\n        loop {\n            let cloned_sream = match stream.try_clone() {\n                Ok(stream) =\u003e stream,\n                Err(_) =\u003e return Err(ProtocolError::StreamError),\n            };\n            match handle_messages(\n                cloned_sream,\n                topics.clone(),\n                packets.clone(),\n                _subs.clone(),\n                clients_ids.clone(),\n            ) {\n                Ok(return_val) =\u003e {\n                    if return_val == ProtocolReturn::DisconnectRecieved {\n                        return Ok(());\n                    }\n                }\n                Err(err) =\u003e {\n                    return Err(err);\n                }\n            }\n        }\n    }\n\n    fn handle_subscribe(\n        stream: TcpStream,\n        mut topics: HashMap\u003cString, Topic\u003e,\n        topic_name: String,\n        sub_id: u8,\n    ) -\u003e Result\u003cu8, ProtocolError\u003e {\n        let reason_code;\n        if let Some(topic) = topics.get_mut(\u0026topic_name) {\n            match topic.add_subscriber(stream, sub_id) {\n                0 =\u003e {\n                    println!(\"Subscripcion exitosa\");\n                    reason_code = SUCCESS_HEX;\n                }\n                0x92 =\u003e {\n                    println!(\"SubId duplicado\");\n                    reason_code = SUB_ID_DUP_HEX;\n                }\n                _ =\u003e {\n                    println!(\"Error no especificado\");\n                    reason_code = UNSPECIFIED_ERROR_HEX;\n                }\n            }\n        } else {\n            reason_code = UNSPECIFIED_ERROR_HEX;\n        }\n\n        Ok(reason_code)\n    }\n\n    fn handle_publish(\n        message: ClientMessage,\n        mut topics: HashMap\u003cString, Topic\u003e,\n        topic_name: String,\n    ) -\u003e Result\u003cu8, ProtocolError\u003e {\n        if let Some(topic) = topics.get_mut(\u0026topic_name) {\n            match topic.deliver_message(message) {\n                Ok(reason_code) =\u003e return Ok(reason_code),\n                Err(_) =\u003e return Err(ProtocolError::PublishError),\n            };\n        }\n\n        Ok(0x80_u8) //Unspecified Error reason code\n    }\n\n    fn handle_unsubscribe(\n        mut topics: HashMap\u003cString, Topic\u003e,\n        topic_name: String,\n        sub_id: u8,\n    ) -\u003e Result\u003cu8, ProtocolError\u003e {\n        if sub_id == 0 {\n            return Ok(NO_MATCHING_SUBSCRIBERS_HEX);\n        }\n\n        let reason_code;\n\n        if let Some(topic) = topics.get_mut(\u0026topic_name) {\n            match topic.remove_subscriber(sub_id) {\n                0 =\u003e {\n                    println!(\"Unsubscribe exitoso\");\n                    reason_code = SUCCESS_HEX;\n                }\n                _ =\u003e {\n                    println!(\"Error no especificado\");\n                    reason_code = UNSPECIFIED_ERROR_HEX;\n                }\n            }\n        } else {\n            println!(\"Error no especificado\");\n            reason_code = UNSPECIFIED_ERROR_HEX;\n        }\n        println!(\"reason code {:?}\", reason_code);\n\n        Ok(reason_code)\n    }\n\n    ///Se toma un packet con su respectivo ID y se lo guarda en el hashmap de mensajes que tiene el Broker.\n    fn save_packet(\n        packets: Arc\u003cRwLock\u003cHashMap\u003cu16, ClientMessage\u003e\u003e\u003e,\n        message: ClientMessage,\n        packet_id: u16,\n    ) {\n        let mut lock = packets.write().unwrap();\n\n        lock.insert(packet_id, message);\n    }\n}\n\npub fn handle_messages(\n    mut stream: TcpStream,\n    topics: HashMap\u003cString, Topic\u003e,\n    packets: Arc\u003cRwLock\u003cHashMap\u003cu16, ClientMessage\u003e\u003e\u003e,\n    _subs: Vec\u003cu32\u003e,\n    mut clients_ids: Arc\u003cVec\u003cString\u003e\u003e,\n) -\u003e Result\u003cProtocolReturn, ProtocolError\u003e {\n    let mensaje = match ClientMessage::read_from(\u0026mut stream) {\n        Ok(mensaje) =\u003e mensaje,\n        Err(err) =\u003e return Err(ProtocolError::StreamError),\n    };\n    match mensaje {\n        ClientMessage::Connect {\n            clean_start: _,\n            last_will_flag: _,\n            last_will_qos: _,\n            last_will_retain: _,\n            username: _,\n            password: _,\n            keep_alive: _,\n            properties: _,\n            client_id,\n            will_properties: _,\n            last_will_topic: _,\n            last_will_message: _,\n        } =\u003e {\n            println!(\"Recib√≠ un Connect\");\n\n            if clients_ids.contains(\u0026client_id) {\n                let disconnect = BrokerMessage::Disconnect {\n                    reason_code: 0,\n                    session_expiry_interval: 0,\n                    reason_string: \"El cliente ya est√° conectado\".to_string(),\n                    user_properties: Vec::new(),\n                };\n\n                match disconnect.write_to(\u0026mut stream) {\n                    Ok(_) =\u003e {\n                        println!(\"Disconnect enviado\");\n                        return Ok(ProtocolReturn::DisconnectSent);\n                    }\n                    Err(err) =\u003e println!(\"Error al enviar Disconnect: {:?}\", err),\n                }\n            }\n            Arc::make_mut(\u0026mut clients_ids).push(client_id);\n            let connack = BrokerMessage::Connack {\n                    //session_present: true,\n                    //return_code: 0,\n                };\n            println!(\"Enviando un Connack\");\n            match connack.write_to(\u0026mut stream) {\n                Ok(_) =\u003e return Ok(ProtocolReturn::ConnackSent),\n                Err(err) =\u003e {\n                    println!(\"{:?}\", err);\n                }\n            }\n        }\n        ClientMessage::Publish {\n            packet_id,\n            topic_name,\n            qos,\n            retain_flag,\n            payload,\n            dup_flag,\n            properties,\n        } =\u003e {\n            println!(\"Recib√≠ un Publish\");\n            println!(\"Topic name: {}\", topic_name);\n            println!(\"Payload: {:?}\", payload);\n            let msg = ClientMessage::Publish {\n                packet_id,\n                topic_name: topic_name.clone(),\n                qos,\n                retain_flag,\n                payload: payload.clone(),\n                dup_flag,\n                properties,\n            };\n            Broker::save_packet(packets.clone(), msg.clone(), packet_id);\n\n            let packet_id_bytes: [u8; 2] = packet_id.to_be_bytes();\n\n            let reason_code = Broker::handle_publish(msg, topics.clone(), topic_name)?;\n\n            if qos == 1 {\n                let puback = BrokerMessage::Puback {\n                    packet_id_msb: packet_id_bytes[0],\n                    packet_id_lsb: packet_id_bytes[1],\n                    reason_code,\n                };\n                println!(\"Enviando un Puback\");\n                match puback.write_to(\u0026mut stream) {\n                    Ok(_) =\u003e {\n                        println!(\"Puback enviado\");\n                        return Ok(ProtocolReturn::PubackSent);\n                    }\n                    Err(err) =\u003e println!(\"Error al enviar Puback: {:?}\", err),\n                }\n            }\n        }\n        ClientMessage::Subscribe {\n            packet_id,\n            topic_name,\n            properties,\n        } =\u003e {\n            println!(\"Recibi un Subscribe\");\n            let msg = ClientMessage::Subscribe {\n                packet_id,\n                topic_name: topic_name.clone(),\n                properties: properties.clone(),\n            };\n            Broker::save_packet(packets.clone(), msg, packet_id);\n\n            let packet_id_bytes: [u8; 2] = packet_id.to_be_bytes();\n\n            let stream_for_topic = match stream.try_clone() {\n                Ok(stream) =\u003e stream,\n                Err(_) =\u003e return Err(ProtocolError::StreamError),\n            };\n\n            let reason_code = Broker::handle_subscribe(\n                stream_for_topic,\n                topics.clone(),\n                topic_name,\n                properties.sub_id,\n            )?;\n            match reason_code {\n                0 =\u003e {\n                    println!(\"Enviando un Suback\");\n                    let suback = BrokerMessage::Suback {\n                        packet_id_msb: packet_id_bytes[0],\n                        packet_id_lsb: packet_id_bytes[1],\n                        reason_code: 0,\n                        sub_id: properties.sub_id,\n                    };\n                    match suback.write_to(\u0026mut stream) {\n                        Ok(_) =\u003e {\n                            println!(\"Suback enviado\");\n                            return Ok(ProtocolReturn::SubackSent);\n                        }\n                        Err(err) =\u003e println!(\"Error al enviar suback: {:?}\", err),\n                    }\n                }\n                _ =\u003e {\n                    let suback = BrokerMessage::Suback {\n                        packet_id_msb: packet_id_bytes[0],\n                        packet_id_lsb: packet_id_bytes[1],\n                        reason_code: 0x80,\n                        sub_id: properties.sub_id,\n                    };\n                    println!(\"Enviando un Suback\");\n                    match suback.write_to(\u0026mut stream) {\n                        Ok(_) =\u003e {\n                            println!(\"Suback enviado\");\n                            return Ok(ProtocolReturn::SubackSent);\n                        }\n                        Err(err) =\u003e println!(\"Error al enviar suback: {:?}\", err),\n                    }\n                }\n            }\n            return Ok(ProtocolReturn::SubackSent);\n        }\n        ClientMessage::Unsubscribe {\n            packet_id,\n            topic_name,\n            properties,\n        } =\u003e {\n            println!(\"Recib√≠ un Unsubscribe\");\n\n            let packet_id_bytes: [u8; 2] = packet_id.to_be_bytes();\n\n            let reason_code =\n                Broker::handle_unsubscribe(topics.clone(), topic_name, properties.sub_id)?;\n\n            let unsuback = BrokerMessage::Unsuback {\n                packet_id_msb: packet_id_bytes[0],\n                packet_id_lsb: packet_id_bytes[1],\n                reason_code,\n            };\n\n            println!(\"Enviando un Unsuback\");\n            match unsuback.write_to(\u0026mut stream) {\n                Ok(_) =\u003e {\n                    println!(\"Unsuback enviado\");\n                    return Ok(ProtocolReturn::UnsubackSent);\n                }\n                Err(err) =\u003e println!(\"Error al enviar Unsuback: {:?}\", err),\n            }\n        }\n        ClientMessage::Disconnect {\n            reason_code: _,\n            session_expiry_interval: _,\n            reason_string,\n            user_properties: _,\n        } =\u003e {\n            println!(\n                \"Recib√≠ un Disconnect, razon de desconexi√≥n: {:?}\",\n                reason_string\n            );\n            return Ok(ProtocolReturn::DisconnectRecieved);\n        }\n        ClientMessage::Pingreq =\u003e {\n            println!(\"Recib√≠ un Pingreq\");\n            let pingresp = BrokerMessage::Pingresp;\n            println!(\"Enviando un Pingresp\");\n            match pingresp.write_to(\u0026mut stream) {\n                Ok(_) =\u003e {\n                    println!(\"Pingresp enviado\");\n                    return Ok(ProtocolReturn::PingrespSent);\n                }\n                Err(err) =\u003e println!(\"Error al enviar Pingresp: {:?}\", err),\n            }\n        }\n    }\n    return Err(ProtocolError::UnspecifiedError);\n}\n\n#[cfg(test)]\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::sync::{Arc, RwLock};\n    use std::thread;\n\n    #[test]\n    fn test_handle_client() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        // Spawn a thread to simulate a client.\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            stream.write_all(b\"Hello, world!\").unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        // Write a ClientMessage to the stream.\n        // You'll need to replace this with a real ClientMessage.\n        let mut result: Result\u003c(), ProtocolError\u003e = Err(ProtocolError::UnspecifiedError);\n\n        // Accept the connection and pass the stream to the function.\n        if let Ok((stream, _)) = listener.accept() {\n            // Perform your assertions here\n            result = Broker::handle_client(stream, topics, packets, subs, clients_ids);\n        }\n\n        // Check that the function returned Ok.\n        // You might want to add more checks here, depending on what\n        // handle_client is supposed to do.\n        assert!(result.is_err());\n    }\n}\n","traces":[{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":169,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":203,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":25},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":46},"fn_name":null},{"line":229,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":243,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":252,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":253,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":271,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":294,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":298,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":302,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":311,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":314,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":316,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":321,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":323,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":324,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":329,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":333,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":335,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":337,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":355,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":357,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":360,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":365,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":366,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":368,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":370,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":371,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":373,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":374,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":376,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":384,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":385,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":386,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":387,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":389,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":391,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":392,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":403,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":404,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":406,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":412,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":413,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":414,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":415,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":416,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":417,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":419,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":422,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":423,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":424,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":425,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":427,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":428,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":430,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":434,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":101,"coverable":175},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","broker_config.rs"],"content":"use std::{\n    collections::HashMap,\n    fs::File,\n    io::{BufRead, BufReader},\n};\n\nuse crate::mqtt::{protocol_error::ProtocolError, topic::Topic};\n\n/// Contiene la configuracion del Broker:\n/// Lee el archivo de topics que el usuario quiera manejar, y\n/// guarda el address que usa.\npub struct BrokerConfig {\n    address: String,\n    topics: HashMap\u003cString, Topic\u003e,\n}\n\nimpl BrokerConfig {\n    ///Leo el archivo de topic_config y guardo las lecturas que haga.\n    pub fn new(address: String) -\u003e Result\u003cBrokerConfig, ProtocolError\u003e {\n        let mut topics = HashMap::new();\n        let topic_config_path = \"./src/monitoring/topics.txt\";\n\n        let readings = BrokerConfig::process_topic_config_file(topic_config_path)?;\n\n        for topic in readings {\n            topics.insert(topic, Topic::new());\n        }\n\n        Ok(BrokerConfig { address, topics })\n    }\n\n    /// La idea es que Broker llame a esta funcion y que pueda acceder a su configuracion\n    pub fn get_broker_config(\u0026self) -\u003e (String, HashMap\u003cString, Topic\u003e) {\n        (self.address.clone(), self.topics.clone())\n    }\n\n    fn process_topic_config_file(file_path: \u0026str) -\u003e Result\u003cVec\u003cString\u003e, ProtocolError\u003e {\n        let file = match File::open(file_path) {\n            Ok(file) =\u003e file,\n            Err(_) =\u003e return Err(ProtocolError::ReadingTopicConfigFileError),\n        };\n\n        let readings = BrokerConfig::read_topic_config_file(\u0026file)?;\n\n        Ok(readings)\n    }\n\n    fn read_topic_config_file(file: \u0026File) -\u003e Result\u003cVec\u003cString\u003e, ProtocolError\u003e {\n        let reader = BufReader::new(file).lines();\n        let mut readings = Vec::new();\n\n        for line in reader {\n            match line {\n                Ok(line) =\u003e readings.push(line),\n                Err(_err) =\u003e return Err(ProtocolError::ReadingTopicConfigFileError),\n            }\n        }\n\n        Ok(readings)\n    }\n}\n","traces":[{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":21},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","broker_message.rs"],"content":"use std::io::{BufWriter, Error, Read, Write};\n\nuse crate::utils::{reader::*, writer::*};\n\nconst SESSION_EXPIRY_INTERVAL_ID: u8 = 0x11;\nconst REASON_STRING_ID: u8 = 0x1F;\nconst USER_PROPERTY_ID: u8 = 0x26;\nuse super::publish_properties::PublishProperties;\n\n#[derive(Debug, PartialEq)]\npub enum BrokerMessage {\n    Connack {\n        //session_present: bool,\n        //return_code: u32\n    },\n\n    /// Puback es la respuesta a un Publish packet con QoS 1.\n    Puback {\n        packet_id_msb: u8,\n        packet_id_lsb: u8,\n        reason_code: u8,\n    },\n    /// El Suback se utiliza para confirmar la suscripci√≥n a un topic\n    ///\n    /// reason_code es el c√≥digo de raz√≥n de la confirmaci√≥n\n    /// packet_id_msb y packet_id_lsb son los bytes m√°s significativos y menos significativos del packet_id\n    Suback {\n        /// packet_id_msb es el byte m√°s significativo del packet_id\n        packet_id_msb: u8,\n        /// packet_id_lsb es el byte menos significativo del packet_id\n        packet_id_lsb: u8,\n        /// reason_code es el c√≥digo de raz√≥n de la confirmaci√≥n\n        reason_code: u8,\n        sub_id: u8,\n    },\n    PublishDelivery {\n        packet_id: u16,\n        topic_name: String,\n        qos: usize,\n        retain_flag: usize,\n        payload: String,\n        dup_flag: usize,\n        properties: PublishProperties,\n    },\n    Unsuback {\n        packet_id_msb: u8,\n        packet_id_lsb: u8,\n        reason_code: u8,\n    },\n    Disconnect {\n        reason_code: u8,\n        session_expiry_interval: u32,\n        reason_string: String,\n        user_properties: Vec\u003c(String, String)\u003e,\n    },\n    Pingresp,\n}\n#[allow(dead_code)]\nimpl BrokerMessage {\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e std::io::Result\u003c()\u003e {\n        let mut writer = BufWriter::new(stream);\n        match self {\n            BrokerMessage::Connack {} =\u003e {\n                let byte_1: u8 = 0x10_u8.to_le();\n\n                writer.write_all(\u0026[byte_1])?;\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::Puback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code,\n            } =\u003e {\n                //fixed header\n                let byte_1: u8 = 0x40_u8.to_le(); //01000000\n\n                writer.write_all(\u0026[byte_1])?;\n\n                //variable header\n                //packet_id\n                write_u8(\u0026mut writer, packet_id_msb)?;\n                write_u8(\u0026mut writer, packet_id_lsb)?;\n\n                //reason code\n                write_u8(\u0026mut writer, reason_code)?;\n\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::Suback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code,\n                sub_id,\n            } =\u003e {\n                //fixed header\n                let byte_1: u8 = 0x90_u8.to_le(); //10010000\n\n                writer.write_all(\u0026[byte_1])?;\n\n                //variable header\n                //let byte_2: u8 = 0x00_u8.to_le(); //00000000\n                //writer.write(\u0026[byte_2])?;\n\n                //payload\n                //let byte_3: u8 = 0x01_u8.to_le(); //00000001\n                //writer.write(\u0026[byte_3])?;\n                write_u8(\u0026mut writer, packet_id_msb)?;\n                write_u8(\u0026mut writer, packet_id_lsb)?;\n\n                //reason code\n                write_u8(\u0026mut writer, reason_code)?;\n\n                //sub_id\n                write_u8(\u0026mut writer, sub_id)?;\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::PublishDelivery {\n                packet_id,\n                topic_name,\n                qos,\n                retain_flag,\n                payload,\n                dup_flag,\n                properties,\n            } =\u003e {\n                //fixed header -\u003e es uno de juguete, hay que pensarlo mejor\n                let byte_1: u8 = 0x00_u8.to_le();\n                writer.write_all(\u0026[byte_1])?;\n\n                //variable header\n                //packet_id\n                write_u8(\u0026mut writer, \u0026packet_id.to_be_bytes()[0])?;\n                write_u8(\u0026mut writer, \u0026packet_id.to_be_bytes()[1])?;\n\n                //topic_name\n                write_string(\u0026mut writer, topic_name)?;\n\n                //qos\n                write_u8(\u0026mut writer, \u0026qos.to_be_bytes()[0])?;\n\n                //retain_flag\n                write_u8(\u0026mut writer, \u0026retain_flag.to_be_bytes()[0])?;\n\n                //payload\n                write_string(\u0026mut writer, payload)?;\n\n                //dup_flag\n                write_u8(\u0026mut writer, \u0026dup_flag.to_be_bytes()[0])?;\n\n                //properties\n                properties.write_properties(\u0026mut writer)?;\n\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::Unsuback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code,\n            } =\u003e {\n                //fixed header\n                let byte_1: u8 = 0xB0_u8.to_le(); //10110000\n\n                writer.write_all(\u0026[byte_1])?;\n\n                //variable header\n                //packet_id\n                write_u8(\u0026mut writer, packet_id_msb)?;\n                write_u8(\u0026mut writer, packet_id_lsb)?;\n                write_u8(\u0026mut writer, reason_code)?;\n\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::Disconnect {\n                reason_code,\n                session_expiry_interval,\n                reason_string,\n                user_properties,\n            } =\u003e {\n                //fixed header\n                let header: u8 = 0xE0_u8.to_le(); //11100000\n                write_u8(\u0026mut writer, \u0026header)?;\n                //variable_header\n                write_u8(\u0026mut writer, reason_code)?;\n\n                write_u8(\u0026mut writer, \u0026SESSION_EXPIRY_INTERVAL_ID)?;\n                write_u32(\u0026mut writer, session_expiry_interval)?;\n\n                write_u8(\u0026mut writer, \u0026REASON_STRING_ID)?;\n                write_string(\u0026mut writer, reason_string)?;\n\n                write_u8(\u0026mut writer, \u0026USER_PROPERTY_ID)?;\n                write_string_pairs(\u0026mut writer, user_properties)?;\n                writer.flush()?;\n                Ok(())\n            }\n            BrokerMessage::Pingresp =\u003e {\n                let byte_1: u8 = 0xD0_u8.to_le();\n                writer.write_all(\u0026[byte_1])?;\n                writer.flush()?;\n\n                Ok(())\n            }\n        }\n    }\n\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cBrokerMessage, Error\u003e {\n        let mut header = [0u8; 1];\n        stream.read_exact(\u0026mut header)?;\n        let header = u8::from_le_bytes(header);\n\n        match header {\n            0x00 =\u003e {\n                let packet_id_msb = read_u8(stream)?;\n                let packet_id_lsb = read_u8(stream)?;\n                let topic_name = read_string(stream)?;\n                let qos = read_u8(stream)? as usize;\n                let retain_flag = read_u8(stream)? as usize;\n                let payload = read_string(stream)?;\n                let dup_flag = read_u8(stream)? as usize;\n                let properties = PublishProperties::read_from(stream)?;\n\n                Ok(BrokerMessage::PublishDelivery {\n                    packet_id: u16::from_be_bytes([packet_id_msb, packet_id_lsb]),\n                    topic_name,\n                    qos,\n                    retain_flag,\n                    payload,\n                    dup_flag,\n                    properties,\n                })\n            }\n            0x10 =\u003e Ok(BrokerMessage::Connack {}),\n            0x40 =\u003e {\n                let packet_id_msb = read_u8(stream)?;\n                let packet_id_lsb = read_u8(stream)?;\n                let reason_code = read_u8(stream)?;\n\n                Ok(BrokerMessage::Puback {\n                    packet_id_msb,\n                    packet_id_lsb,\n                    reason_code,\n                })\n            }\n            0x90 =\u003e {\n                let packet_id_msb = read_u8(stream)?;\n                let packet_id_lsb = read_u8(stream)?;\n                let reason_code = read_u8(stream)?;\n                let sub_id = read_u8(stream)?;\n                Ok(BrokerMessage::Suback {\n                    packet_id_msb,\n                    packet_id_lsb,\n                    reason_code,\n                    sub_id,\n                })\n            }\n            0xB0 =\u003e {\n                let packet_id_msb = read_u8(stream)?;\n                let packet_id_lsb = read_u8(stream)?;\n                let reason_code = read_u8(stream)?;\n\n                Ok(BrokerMessage::Unsuback {\n                    packet_id_msb,\n                    packet_id_lsb,\n                    reason_code,\n                })\n            }\n            0xE0 =\u003e {\n                let reason_code = read_u8(stream)?;\n                let session_expiry_interval_id = read_u8(stream)?;\n                if session_expiry_interval_id != SESSION_EXPIRY_INTERVAL_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid session expiry interval id\",\n                    ));\n                }\n                let session_expiry_interval = read_u32(stream)?;\n\n                let reason_string_id = read_u8(stream)?;\n                if reason_string_id != REASON_STRING_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid reason string id\",\n                    ));\n                }\n                let reason_string = read_string(stream)?;\n\n                let user_property_id = read_u8(stream)?;\n                if user_property_id != USER_PROPERTY_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid user property id\",\n                    ));\n                }\n                let user_properties = read_string_pairs(stream)?;\n\n                Ok(BrokerMessage::Disconnect {\n                    reason_code,\n                    session_expiry_interval,\n                    reason_string,\n                    user_properties,\n                })\n            }\n            0xD0 =\u003e Ok(BrokerMessage::Pingresp),\n            _ =\u003e Err(Error::new(std::io::ErrorKind::Other, \"Invalid header\")),\n        }\n    }\n\n    pub fn analize_packet_id(\u0026self, packet_id: u16) -\u003e bool {\n        match self {\n            BrokerMessage::Connack {} =\u003e true,\n            BrokerMessage::Puback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code: _,\n            } =\u003e {\n                let bytes = packet_id.to_be_bytes();\n\n                bytes[0] == *packet_id_msb \u0026\u0026 bytes[1] == *packet_id_lsb\n            }\n            BrokerMessage::Suback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code: _,\n                sub_id: _,\n            } =\u003e {\n                let bytes = packet_id.to_be_bytes();\n\n                bytes[0] == *packet_id_msb \u0026\u0026 bytes[1] == *packet_id_lsb\n            }\n            BrokerMessage::PublishDelivery {\n                packet_id: _,\n                topic_name: _,\n                qos: _,\n                retain_flag: _,\n                dup_flag: _,\n                properties: _,\n                payload: _,\n            } =\u003e true,\n            BrokerMessage::Unsuback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code: _,\n            } =\u003e {\n                let bytes = packet_id.to_be_bytes();\n\n                bytes[0] == *packet_id_msb \u0026\u0026 bytes[1] == *packet_id_lsb\n            }\n            BrokerMessage::Pingresp =\u003e true,\n            BrokerMessage::Disconnect {\n                reason_code: _,\n                session_expiry_interval: _,\n                reason_string: _,\n                user_properties: _,\n            } =\u003e true,\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_02_analizing_packet_ids_ok() {\n        let suback = BrokerMessage::Suback {\n            reason_code: 1,\n            packet_id_msb: 2,\n            packet_id_lsb: 1,\n            sub_id: 1,\n        };\n\n        let puback = BrokerMessage::Puback {\n            packet_id_msb: 1,\n            packet_id_lsb: 5,\n            reason_code: 1,\n        };\n\n        assert!(suback.analize_packet_id(513));\n        assert!(puback.analize_packet_id(261));\n    }\n\n    #[test]\n    fn test_03_unsuback_ok() {\n        let unsuback = BrokerMessage::Unsuback {\n            packet_id_msb: 1,\n            packet_id_lsb: 1,\n            reason_code: 1,\n        };\n\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match unsuback.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(err) =\u003e {\n                println!(\"Error: {:?}\", err);\n                panic!();\n            }\n        }\n        cursor.set_position(0);\n        let read_unsuback = match BrokerMessage::read_from(\u0026mut cursor) {\n            Ok(unsuback) =\u003e unsuback,\n            Err(err) =\u003e {\n                println!(\"Error: {:?}\", err);\n\n                panic!()\n            }\n        };\n        assert_eq!(unsuback, read_unsuback);\n    }\n}\n","traces":[{"line":60,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":169,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":195,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":196,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":198,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":202,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":203,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":204,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":211,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":217,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":221,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":229,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":263,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":268,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":271,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":274,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":299,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":301,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":309,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":314,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":318,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":323,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":324,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":326,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":332,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":333,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":334,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":335,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":336,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":338,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":348,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":352,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":354,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":356,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":364,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":89,"coverable":175},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","client.rs"],"content":"use rand::Rng;\nuse std::{\n    collections::HashMap,\n    net::TcpStream,\n    sync::{\n        mpsc::{self, Receiver, Sender},\n        Arc, Mutex,\n    },\n};\n\nuse crate::{\n    mqtt::{\n        broker_message::BrokerMessage, client_message::ClientMessage,\n        connect_config::ConnectConfig, error::ClientError, messages_config::MessagesConfig,\n        protocol_error::ProtocolError,\n    },\n    utils::threadpool::ThreadPool,\n};\n\n#[derive(Debug)]\npub struct Client {\n    receiver_channel: Arc\u003cMutex\u003cReceiver\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e\u003e\u003e,\n\n    // stream es el socket que se conecta al broker\n    stream: TcpStream,\n    // las subscriptions son un hashmap de topic y sub_id\n    pub subscriptions: Arc\u003cMutex\u003cHashMap\u003cString, u8\u003e\u003e\u003e,\n    // pending_messages es un vector de packet_id\n    pending_messages: Vec\u003cu16\u003e,\n    // user_id: u32,\n}\n\nimpl Client {\n    #[allow(clippy::too_many_arguments)]\n    pub fn new(\n        receiver_channel: Receiver\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e,\n        address: String,\n        connect_config: ConnectConfig,\n    ) -\u003e Result\u003cClient, ProtocolError\u003e {\n        let mut stream = match TcpStream::connect(address) {\n            Ok(stream) =\u003e stream,\n            Err(_) =\u003e return Err(ProtocolError::ConectionError),\n        };\n\n        let connect = ClientMessage::Connect {\n            clean_start: connect_config.clean_start,\n            last_will_flag: connect_config.last_will_flag,\n            last_will_qos: connect_config.last_will_qos,\n            last_will_retain: connect_config.last_will_retain,\n            username: connect_config.username,\n            password: connect_config.password,\n            keep_alive: connect_config.keep_alive,\n            properties: connect_config.properties,\n            client_id: connect_config.client_id,\n            will_properties: connect_config.will_properties,\n            last_will_topic: connect_config.last_will_topic,\n            last_will_message: connect_config.last_will_message,\n        };\n\n        println!(\"Enviando connect message to broker\");\n        match connect.write_to(\u0026mut stream) {\n            Ok(()) =\u003e println!(\"Connect message enviado\"),\n            Err(_) =\u003e println!(\"Error al enviar connect message\"),\n        }\n\n        if let Ok(message) = BrokerMessage::read_from(\u0026mut stream) {\n            match message {\n                BrokerMessage::Connack {\n                   //session_present,\n                    //return_code,\n                } =\u003e {\n                    println!(\"Recib√≠ un Connack\");\n                },\n                _ =\u003e println!(\"no recibi un Connack :(\"),\n\n            }\n        } else {\n            println!(\"soy el client y no pude leer el mensaje\");\n        };\n\n        let _user_id = Client::assign_user_id();\n\n        Ok(Client {\n            receiver_channel: Arc::new(Mutex::new(receiver_channel)),\n            stream,\n            subscriptions: Arc::new(Mutex::new(HashMap::new())),\n            pending_messages: Vec::new(),\n        })\n    }\n\n    /// Publica un mensaje en un topic determinado.\n    pub fn publish_message(\n        message: ClientMessage,\n        mut stream: TcpStream,\n        packet_id: u16,\n    ) -\u003e Result\u003cu16, ClientError\u003e {\n        match message.write_to(\u0026mut stream) {\n            Ok(()) =\u003e Ok(packet_id),\n            Err(_) =\u003e Err(ClientError::new(\"Error al enviar mensaje\")),\n        }\n    }\n\n    pub fn subscribe(\n        message: ClientMessage,\n        packet_id: u16,\n        topic: \u0026str,\n        mut stream: TcpStream,\n        subscriptions: Arc\u003cMutex\u003cHashMap\u003cString, u8\u003e\u003e\u003e,\n    ) -\u003e Result\u003cu16, ClientError\u003e {\n        let sub_id = Client::assign_subscription_id();\n        let topic = topic.to_string();\n\n        let subscriptions = subscriptions.clone();\n\n        subscriptions.lock().unwrap().insert(topic.clone(), sub_id);\n\n        match message.write_to(\u0026mut stream) {\n            Ok(()) =\u003e Ok(packet_id),\n            Err(_) =\u003e Err(ClientError::new(\"Error al enviar mensaje\")),\n        }\n    }\n\n    fn assign_subscription_id() -\u003e u8 {\n        let mut rng = rand::thread_rng();\n\n        let sub_id: u8 = rng.gen();\n\n        sub_id\n    }\n\n    fn assign_user_id() -\u003e u32 {\n        //let mut rng = rand::thread_rng();\n\n        //let user_id: u32 = rng.gen();\n\n        1111\n    }\n\n    pub fn unsubscribe(\n        message: ClientMessage,\n        mut stream: TcpStream,\n        packet_id: u16,\n    ) -\u003e Result\u003cu16, ClientError\u003e {\n        match message.write_to(\u0026mut stream) {\n            Ok(()) =\u003e Ok(packet_id),\n            Err(_) =\u003e Err(ClientError::new(\"Error al enviar mensaje\")),\n        }\n    }\n\n    ///recibe un string que indica la raz√≥n de la desconexi√≥n y un stream y envia un disconnect message al broker\n    /// segun el str reason recibido, modifica el reason_code y el reason_string del mensaje\n    ///\n    /// devuelve el packet_id del mensaje enviado o un ClientError en caso de error\n    pub fn disconnect(reason: \u0026str, mut stream: TcpStream) -\u003e Result\u003cu16, ClientError\u003e {\n        let packet_id = 1;\n        let reason_code: u8;\n        let reason_string: String;\n        match reason {\n            \"normal\" =\u003e {\n                reason_code = 0x00;\n                reason_string =\n                    \"Close the connection normally. Do not send the Will Message.\".to_string();\n            }\n            \"with_will\" =\u003e {\n                reason_code = 0x04;\n                reason_string = \"The Client wishes to disconnect but requires that the Server also publishes its Will Message\"\n                    .to_string();\n            }\n            _ =\u003e {\n                reason_code = 0x80;\n                reason_string = \"The Connection is closed but the sender either does not wish to reveal reason or none of the other Reason Codes apply. \"\n                    .to_string();\n            }\n        }\n        let disconnect = ClientMessage::Disconnect {\n            reason_code,\n            session_expiry_interval: 0,\n            reason_string,\n            user_properties: vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        };\n\n        match disconnect.write_to(\u0026mut stream) {\n            Ok(()) =\u003e Ok(packet_id),\n            Err(_) =\u003e Err(ClientError::new(\"Error al enviar mensaje\")),\n        }\n    }\n\n    /// Se encarga de que el cliente este funcionando correctamente.\n    /// El Client debe encargarse de dos tareas: leer mensajes que le lleguen del Broker.\n    /// Estos mensajes pueden ser tanto acks (Connack, Puback, etc.)\n    /// como pubs que vengan por parte otros clientes (mediante el broker)\n    /// a cuyos topics est√© subscrito.\n    ///\n    /// Su segunda tarea es enviar mensajes:\n    /// puede enviar mensajes como Publish, Suscribe, etc.\n    ///\n    /// Las dos tareas del Client se deben ejecutar concurrentemente,\n    /// por eso su tilizan dos threads(uno de lectura y otro de escritura),\n    /// ambos threads deben compaten el recurso TcpStream.\n    ///\n    /// El thread de escritura (write_messages) recibe por consola los mensajes a enviar.\n    /// Si logra enviar los mensajes correctamente, envia el pacjet id mediante el channel\n    ///\n    /// El thread de lectura (read_messages) se encarga de leer los mensajes que le llegan del broker.\n    pub fn client_run(\u0026mut self) -\u003e Result\u003c(), ProtocolError\u003e {\n        let (sender, receiver) = mpsc::channel();\n\n        let receiver_channel = self.receiver_channel.clone();\n\n        let desconectar = false;\n\n        let pending_messages_clone_one = self.pending_messages.clone();\n\n        let stream_clone_one = match self.stream.try_clone() {\n            Ok(stream) =\u003e stream,\n            Err(_) =\u003e return Err(ProtocolError::StreamError),\n        };\n        let stream_clone_two = match self.stream.try_clone() {\n            Ok(stream) =\u003e stream,\n            Err(_) =\u003e return Err(ProtocolError::StreamError),\n        };\n\n        let threadpool = ThreadPool::new(5);\n\n        let subscriptions_clone = self.subscriptions.clone();\n\n        let _write_messages = threadpool.execute(move || {\n            let pending_messages = pending_messages_clone_one.clone();\n\n            Client::write_messages(\n                stream_clone_one,\n                pending_messages,\n                receiver_channel,\n                desconectar,\n                sender,\n                subscriptions_clone,\n            )\n        });\n\n        let subscriptions_clone = self.subscriptions.clone();\n        let _read_messages = threadpool.execute(move || {\n            Client::receive_messages(stream_clone_two, receiver, subscriptions_clone)\n        });\n\n        Ok(())\n    }\n\n    fn receive_messages(\n        stream: TcpStream,\n        receiver: Receiver\u003cu16\u003e,\n        subscriptions_clone: Arc\u003cMutex\u003cHashMap\u003cString, u8\u003e\u003e\u003e,\n    ) -\u003e Result\u003c(), ProtocolError\u003e {\n        let mut pending_messages = Vec::new();\n\n        loop {\n            if let Ok(packet) = receiver.try_recv() {\n                pending_messages.push(packet);\n            }\n\n            if let Ok(mut stream_clone) = stream.try_clone() {\n                if let Ok(message) = BrokerMessage::read_from(\u0026mut stream_clone) {\n                    match message {\n                        BrokerMessage::Connack {} =\u003e todo!(),\n                        BrokerMessage::Puback {\n                            packet_id_msb,\n                            packet_id_lsb,\n                            reason_code,\n                        } =\u003e {\n                            for pending_message in \u0026pending_messages {\n                                let packet_id_bytes: [u8; 2] = pending_message.to_be_bytes();\n                                if packet_id_bytes[0] == packet_id_msb\n                                    \u0026\u0026 packet_id_bytes[1] == packet_id_lsb\n                                {\n                                    println!(\n                                        \"puback con id {} {} {} recibido\",\n                                        packet_id_msb, packet_id_lsb, reason_code\n                                    );\n                                }\n                            }\n                            println!(\"puback {:?}\", message);\n                        }\n                        BrokerMessage::Disconnect {\n                            reason_code: _,\n                            session_expiry_interval: _,\n                            reason_string,\n                            user_properties: _,\n                        } =\u003e {\n                            println!(\n                                \"Recib√≠ un Disconnect, razon de desconexi√≥n: {:?}\",\n                                reason_string\n                            );\n                            break;\n                        }\n                        BrokerMessage::Suback {\n                            packet_id_msb,\n                            packet_id_lsb,\n                            reason_code: _,\n                            sub_id,\n                        } =\u003e {\n                            for pending_message in \u0026pending_messages {\n                                let packet_id_bytes: [u8; 2] = pending_message.to_be_bytes();\n\n                                if packet_id_bytes[0] == packet_id_msb\n                                    \u0026\u0026 packet_id_bytes[1] == packet_id_lsb\n                                {\n                                    println!(\n                                        \"suback con id {} {} recibido\",\n                                        packet_id_msb, packet_id_lsb\n                                    );\n                                }\n                            }\n\n                            //busca el sub_id 1 en el hash de subscriptions\n                            //si lo encuentra, lo reemplaza por el sub_id que llega en el mensaje\n                            let mut topic = String::new();\n                            let mut lock = subscriptions_clone.lock().unwrap();\n                            for (key, value) in lock.iter() {\n                                if *value == 1 {\n                                    topic.clone_from(key);\n                                }\n                            }\n                            lock.remove(\u0026topic);\n                            lock.insert(topic, sub_id);\n\n                            println!(\"Recibi un mensaje {:?}\", message);\n                        }\n                        BrokerMessage::PublishDelivery {\n                            packet_id,\n                            topic_name: _,\n                            qos: _,\n                            retain_flag: _,\n                            dup_flag: _,\n                            properties: _,\n                            payload,\n                        } =\u003e {\n                            println!(\n                                \"PublishDelivery con id {} recibido, payload: {}\",\n                                packet_id, payload\n                            );\n                        }\n                        BrokerMessage::Unsuback {\n                            packet_id_msb,\n                            packet_id_lsb,\n                            reason_code: _,\n                        } =\u003e {\n                            for pending_message in \u0026pending_messages {\n                                let packet_id_bytes: [u8; 2] = pending_message.to_be_bytes();\n                                if packet_id_bytes[0] == packet_id_msb\n                                    \u0026\u0026 packet_id_bytes[1] == packet_id_lsb\n                                {\n                                    println!(\n                                        \"Unsuback con id {} {} recibido\",\n                                        packet_id_msb, packet_id_lsb\n                                    );\n                                }\n                            }\n\n                            println!(\"Recibi un mensaje {:?}\", message);\n                        }\n                        BrokerMessage::Pingresp =\u003e {\n                            println!(\"Recibi un mensaje {:?}\", message)\n                        }\n                    }\n                }\n            } else {\n                println!(\"Error al clonar el stream\");\n            }\n        }\n        Ok(())\n    }\n\n    fn write_messages(\n        stream: TcpStream,\n        mut pending_messages: Vec\u003cu16\u003e,\n        receiver_channel: Arc\u003cMutex\u003cReceiver\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e\u003e\u003e,\n        mut desconectar: bool,\n        sender: Sender\u003cu16\u003e,\n        subscriptions_clone: Arc\u003cMutex\u003cHashMap\u003cString, u8\u003e\u003e\u003e,\n    ) -\u003e Result\u003c(), ProtocolError\u003e {\n        while !desconectar {\n            loop {\n                let lock = receiver_channel.lock().unwrap();\n                if let Ok(message_config) = lock.recv() {\n                    let packet_id = Client::assign_packet_id(pending_messages.clone());\n\n                    let message = message_config.parse_message(packet_id);\n\n                    match message {\n                        ClientMessage::Connect {\n                            clean_start: _,\n                            last_will_flag: _,\n                            last_will_qos: _,\n                            last_will_retain: _,\n                            keep_alive: _,\n                            properties: _,\n                            client_id: _,\n                            will_properties: _,\n                            last_will_topic: _,\n                            last_will_message: _,\n                            username: _,\n                            password: _,\n                        } =\u003e todo!(),\n                        ClientMessage::Publish {\n                            packet_id,\n                            topic_name,\n                            qos,\n                            retain_flag,\n                            payload,\n                            dup_flag,\n                            properties,\n                        } =\u003e match stream.try_clone() {\n                            Ok(stream_clone) =\u003e {\n                                let publish = ClientMessage::Publish {\n                                    packet_id,\n                                    topic_name,\n                                    qos,\n                                    retain_flag,\n                                    payload,\n                                    dup_flag,\n                                    properties,\n                                };\n\n                                if let Ok(packet_id) =\n                                    Client::publish_message(publish, stream_clone, packet_id)\n                                {\n                                    pending_messages.push(packet_id);\n                                    match sender.send(packet_id) {\n                                        Ok(_) =\u003e continue,\n                                        Err(_) =\u003e {\n                                            println!(\n                                                \"Error al enviar packet_id de puback al receiver\"\n                                            )\n                                        }\n                                    }\n                                }\n                            }\n                            Err(_) =\u003e {\n                                return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                            }\n                        },\n\n                        ClientMessage::Subscribe {\n                            packet_id,\n                            topic_name,\n                            properties,\n                        } =\u003e {\n                            if subscriptions_clone\n                                .lock()\n                                .unwrap()\n                                .contains_key(\u0026topic_name.to_string())\n                            {\n                                println!(\"Ya estoy subscrito a este topic\");\n                            }\n\n                            match stream.try_clone() {\n                                Ok(stream_clone) =\u003e {\n                                    let subscribe = ClientMessage::Subscribe {\n                                        packet_id,\n                                        topic_name: topic_name.clone(),\n                                        properties,\n                                    };\n                                    if let Ok(packet_id) = Client::subscribe(\n                                        subscribe,\n                                        packet_id,\n                                        \u0026topic_name,\n                                        stream_clone,\n                                        subscriptions_clone.clone(),\n                                    ) {\n                                        match sender.send(packet_id) {\n                                            Ok(_) =\u003e {\n                                                let provitional_sub_id = 1;\n                                                let topic_new = topic_name.to_string();\n                                                subscriptions_clone\n                                                    .lock()\n                                                    .unwrap()\n                                                    .insert(topic_new, provitional_sub_id);\n                                            }\n                                            Err(_) =\u003e {\n                                                println!(\n                                                    \"Error al enviar el packet_id del suback al receiver\"\n                                                )\n                                            }\n                                        }\n                                    }\n                                }\n                                Err(_) =\u003e {\n                                    return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                                }\n                            }\n                        }\n                        ClientMessage::Unsubscribe {\n                            packet_id,\n                            topic_name,\n                            properties,\n                        } =\u003e match stream.try_clone() {\n                            Ok(stream_clone) =\u003e {\n                                let unsubscribe = ClientMessage::Unsubscribe {\n                                    packet_id,\n                                    topic_name: topic_name.clone(),\n                                    properties,\n                                };\n\n                                if let Ok(packet_id) =\n                                    Client::unsubscribe(unsubscribe, stream_clone, packet_id)\n                                {\n                                    match sender.send(packet_id) {\n                                        Ok(_) =\u003e {\n                                            let topic_new = topic_name.to_string();\n                                            subscriptions_clone.lock().unwrap().remove(\u0026topic_new);\n                                        }\n                                        Err(_) =\u003e {\n                                            println!(\n                                                    \"Error al enviar el packet_id del unsuback al receiver\"\n                                                )\n                                        }\n                                    }\n                                }\n                            }\n                            Err(_) =\u003e {\n                                return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                            }\n                        },\n\n                        ClientMessage::Disconnect {\n                            reason_code: _,\n                            session_expiry_interval: _,\n                            reason_string: _,\n                            user_properties: _,\n                        } =\u003e {\n                            let reason = \"normal\";\n\n                            match stream.try_clone() {\n                                Ok(stream_clone) =\u003e {\n                                    if let Ok(packet_id) = Client::disconnect(reason, stream_clone)\n                                    {\n                                        match sender.send(packet_id) {\n                                            Ok(_) =\u003e continue,\n                                            Err(_) =\u003e {\n                                                println!(\n                                                    \"Error al enviar packet_id de puback al receiver\"\n                                                )\n                                            }\n                                        }\n                                        desconectar = true;\n                                        break;\n                                    }\n                                }\n                                Err(_) =\u003e {\n                                    return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                                }\n                            }\n                            break;\n                        }\n\n                        ClientMessage::Pingreq =\u003e {\n                            match stream.try_clone() {\n                                Ok(mut stream_clone) =\u003e {\n                                    let pingreq = ClientMessage::Pingreq;\n                                    match pingreq.write_to(\u0026mut stream_clone) {\n                                        //chequear esto\n                                        Ok(()) =\u003e println!(\"Pingreq enviado\"),\n                                        Err(_) =\u003e println!(\"Error al enviar pingreq\"),\n                                    }\n                                }\n                                Err(_) =\u003e {\n                                    return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        Ok(())\n    }\n\n    ///Asigna un id al packet que ingresa como parametro.\n    ///Guarda el packet en el hashmap de paquetes.\n    fn assign_packet_id(packets: Vec\u003cu16\u003e) -\u003e u16 {\n        let mut rng = rand::thread_rng();\n\n        let mut packet_id: u16;\n        loop {\n            packet_id = rng.gen();\n            if packet_id != 0 \u0026\u0026 !packets.contains(\u0026packet_id) {\n                break;\n            }\n        }\n        packet_id\n    }\n}\n","traces":[{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":169,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":253,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":274,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":289,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":298,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":315,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":316,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":317,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":318,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":323,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":329,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":330,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":332,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":333,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":334,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":335,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":336,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":337,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":338,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":342,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":343,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":346,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":349,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":352,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":361,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":366,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":369,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":372,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":381,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":382,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":404,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":405,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":406,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":407,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":408,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":409,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":412,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":423,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":428,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":430,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":438,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":443,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":444,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":445,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":446,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":447,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":450,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":452,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":455,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":456,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":459,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":470,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":472,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":473,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":476,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":479,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":487,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":492,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":493,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":494,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":495,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":496,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":499,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":503,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":507,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":508,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":509,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":512,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":520,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":530,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":532,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":533,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":534,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":537,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":539,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":544,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":545,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":549,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":552,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":556,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":557,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":558,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":559,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":561,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":562,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":566,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":574,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":579,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":580,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":583,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":584,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":585,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":586,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":215},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","client_message.rs"],"content":"use crate::mqtt::subscribe_properties::SubscribeProperties;\nuse std::io::{BufWriter, Error, Read, Write};\n\nuse crate::mqtt::connect_properties::ConnectProperties;\nuse crate::mqtt::publish_properties::{PublishProperties, TopicProperties};\nuse crate::mqtt::will_properties::*;\nuse crate::utils::{reader::*, writer::*};\n\n//use self::quality_of_service::QualityOfService;\nconst PROTOCOL_VERSION: u8 = 5;\nconst SESSION_EXPIRY_INTERVAL_ID: u8 = 0x11;\nconst REASON_STRING_ID: u8 = 0x1F;\nconst USER_PROPERTY_ID: u8 = 0x26;\n\n#[derive(Debug, PartialEq, Clone)]\npub enum ClientMessage {\n    ///El Connect Message es el primer menasje que el cliente envia cuando se conecta al broker. Este contiene toda la informacion necesaria para que el broker identifique al cliente y pueda establecer una sesion con los parametros establecidos.\n    ///\n    /// clean_start especifica si se debe limpiar la sesion previa del cliente y arrancar una nueva limpia y desde cero.\n    ///\n    /// last_will_flag especifica si el will message se debe guardar asociado a la sesion, last_will_qos especifica el QoS level utilizado cuando se publique el will message, last_will_retain especifica si el will message se retiene despues de ser publicado.\n    ///\n    /// keep_alive especifica el tiempo en segundos que el broker debe esperar entre mensajes del cliente antes de desconectarlo.\n    ///\n    /// Si el will flag es true, se escriben el will topic y el will message.\n    ///\n    /// finalmente, si el cliente envia un username y un password, estos se escriben en el payload.\n    Connect {\n        clean_start: bool,\n        last_will_flag: bool,\n        last_will_qos: u8,\n        last_will_retain: bool,\n        keep_alive: u16,\n        properties: ConnectProperties,\n        client_id: String,\n        will_properties: WillProperties,\n        last_will_topic: String,\n        last_will_message: String,\n        username: String,\n        password: String,\n    },\n\n    /// El paquete Publish es enviado desde un cliente al servidor, o desde un servidor al cliente para transportar un mensaje de aplicacion.\n    Publish {\n        packet_id: u16,\n\n        ///Identifica el canal de informacion por el cual el Payload data se va a publicar.\n        topic_name: String,\n\n        ///Indica el nivel de garantia de delivery de un application message.\n        qos: usize,\n\n        /// Si vale 1, el server debe reemplazar cualquier retained message para ese topic\n        /// y guardar este application message.\n        retain_flag: usize,\n\n        ///Es el application message que se esta publicando.\n        ///El contenido y formato de la data es especificado por la aplicacion.\n        payload: String,\n\n        ///Dup flag indica si fue la primera ocasion que el client o el servidor intento enviar este packete.\n        /// Debe ser 0 para todos los mensajes con QoS 0.\n        /// Debe valer 1 para indicar que es el segundo intento de envio del packete.\n        dup_flag: usize,\n\n        /// Una property es un identificador que define el uso y tipos de data, seguido de un valor.\n        properties: PublishProperties,\n    },\n\n    /// El Subscribe Message se utiliza para suscribirse a uno o m√°s topics. El cliente puede enviar un mensaje de subscribe con un packet id y una lista de topics a los que se quiere suscribir. El broker responde con un mensaje de suback con el mismo packet id y una lista de return codes que indican si la suscripcion fue exitosa o no.\n    Subscribe {\n        packet_id: u16,\n        /// topic_name es el nombre del topic al que se quiere suscribir.\n        topic_name: String,\n        /// properties es un struct que contiene las propiedades del mensaje de subscribe.\n        properties: SubscribeProperties,\n    },\n    Unsubscribe {\n        packet_id: u16,\n        topic_name: String,\n        properties: SubscribeProperties,\n    },\n    /// Es el ultimo mensaje que el cliente envia antes de desconectarse, este mensaje contiene informacion sobre la razon de la desconexi√≥n y propiedades adicionales.\n    /// reason_code es el codigo de la razon de la desconexi√≥n.\n    /// session_expiry_interval es el tiempo en segundos que el broker debe mantener la sesion del cliente activa despues de que este se desconecte.\n    /// reason_string es un mensaje de texto que describe la razon de la desconexi√≥n.\n    /// user_properties es un conjunto de propiedades adicionales que el cliente puede enviar.\n    Disconnect {\n        reason_code: u8,\n        session_expiry_interval: u32,\n        reason_string: String,\n        user_properties: Vec\u003c(String, String)\u003e,\n    },\n    Pingreq,\n}\n\n#[allow(dead_code)]\nimpl ClientMessage {\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e std::io::Result\u003c()\u003e {\n        let mut writer = BufWriter::new(stream);\n        match self {\n            ClientMessage::Connect {\n                client_id,\n                clean_start,\n                last_will_flag,\n                last_will_qos,\n                last_will_retain,\n                keep_alive,\n                properties,\n                will_properties,\n                last_will_topic,\n                last_will_message,\n                username,\n                password,\n            } =\u003e {\n                //fixed header\n                self.write_first_packet_byte(\u0026mut writer)?;\n\n                //TODO: aca deberia ir el remaining lenght field\n                //protocol name\n                let protocol_name = \"MQTT\";\n                write_string(\u0026mut writer, protocol_name)?;\n\n                //protocol version\n                let protocol_version: u8 = 0x05;\n                writer.write_all(\u0026[protocol_version])?;\n\n                //connection flags\n                let mut connect_flags: u8 = 0x00;\n                if *clean_start {\n                    connect_flags |= 1 \u003c\u003c 1; //set bit 1 to 1\n                }\n\n                if *last_will_flag {\n                    connect_flags |= 1 \u003c\u003c 2;\n                }\n                if *last_will_qos \u003e 3 {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid last will qos\",\n                    ));\n                }\n                connect_flags |= (last_will_qos \u0026 0b11) \u003c\u003c 3;\n\n                if *last_will_retain {\n                    connect_flags |= 1 \u003c\u003c 5;\n                }\n\n                if !password.is_empty() {\n                    connect_flags |= 1 \u003c\u003c 6;\n                }\n\n                if !username.is_empty() {\n                    connect_flags |= 1 \u003c\u003c 7;\n                }\n\n                writer.write_all(\u0026[connect_flags])?;\n\n                //keep alive\n                write_u16(\u0026mut writer, keep_alive)?;\n                write_string(\u0026mut writer, client_id)?;\n\n                will_properties.write_to(\u0026mut writer)?;\n\n                if *last_will_flag {\n                    write_string(\u0026mut writer, last_will_topic)?;\n                    write_string(\u0026mut writer, last_will_message)?;\n                }\n\n                if !username.is_empty() {\n                    write_string(\u0026mut writer, username)?;\n                }\n                if !password.is_empty() {\n                    write_string(\u0026mut writer, password)?;\n                }\n                properties.write_to(\u0026mut writer)?;\n\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Publish {\n                packet_id: _,\n                topic_name: _,\n                qos: _,\n                retain_flag: _,\n                payload,\n                dup_flag: _,\n                properties: _,\n            } =\u003e {\n                //fixed header\n                self.write_first_packet_byte(\u0026mut writer)?;\n\n                //Remaining Length\n                self.write_packet_properties(\u0026mut writer)?;\n\n                //Payload\n                write_string(\u0026mut writer, payload)?;\n\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Subscribe {\n                packet_id: _,\n                topic_name: _,\n                properties: _,\n            } =\u003e {\n                self.write_first_packet_byte(\u0026mut writer)?;\n                self.write_packet_properties(\u0026mut writer)?;\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Unsubscribe {\n                packet_id: _,\n                topic_name: _,\n                properties: _,\n            } =\u003e {\n                self.write_first_packet_byte(\u0026mut writer)?;\n                self.write_packet_properties(\u0026mut writer)?;\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Disconnect {\n                reason_code,\n                session_expiry_interval,\n                reason_string,\n                user_properties,\n            } =\u003e {\n                //fixed header\n                let header: u8 = 0xE0_u8.to_le(); //11100000\n                write_u8(\u0026mut writer, \u0026header)?;\n\n                //variable_header\n                write_u8(\u0026mut writer, reason_code)?;\n\n                write_u8(\u0026mut writer, \u0026SESSION_EXPIRY_INTERVAL_ID)?;\n                write_u32(\u0026mut writer, session_expiry_interval)?;\n\n                write_u8(\u0026mut writer, \u0026REASON_STRING_ID)?;\n                write_string(\u0026mut writer, reason_string)?;\n\n                write_u8(\u0026mut writer, \u0026USER_PROPERTY_ID)?;\n                write_string_pairs(\u0026mut writer, user_properties)?;\n\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Pingreq =\u003e {\n                let byte_1: u8 = 0xC0_u8;\n                writer.write_all(\u0026[byte_1])?;\n                writer.flush()?;\n                Ok(())\n            }\n        }\n    }\n\n    fn write_first_packet_byte(\n        \u0026self,\n        writer: \u0026mut BufWriter\u003c\u0026mut dyn Write\u003e,\n    ) -\u003e std::io::Result\u003c()\u003e {\n        match self {\n            ClientMessage::Connect {\n                clean_start: _,\n                last_will_flag: _,\n                last_will_qos: _,\n                last_will_retain: _,\n                keep_alive: _,\n                properties: _,\n                client_id: _,\n                will_properties: _,\n                last_will_topic: _,\n                last_will_message: _,\n                username: _,\n                password: _,\n            } =\u003e {\n                let byte_1: u8 = 0x10_u8.to_le(); //00010000\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Publish {\n                packet_id: _,\n                topic_name: _,\n                qos,\n                retain_flag,\n                payload: _,\n                dup_flag,\n                properties: _,\n            } =\u003e {\n                let mut byte_1 = 0x30_u8;\n\n                if *retain_flag == 1 {\n                    //we must replace any existing retained message for this topic and store\n                    //the app message.\n                    byte_1 |= 1 \u003c\u003c 0;\n                }\n\n                if *qos == 1 {\n                    byte_1 |= 1 \u003c\u003c 1;\n                    byte_1 |= 0 \u003c\u003c 2;\n                } else if *qos != 0x00 \u0026\u0026 *qos != 0x01 {\n                    //we should throw a DISCONNECT with reason code 0x81(Malformed packet).\n                    println!(\"Qos inv√°lido\");\n                }\n\n                if *dup_flag == 1 {\n                    byte_1 |= 1 \u003c\u003c 3;\n                }\n\n                //Dup flag must be set to 0 for all QoS 0 messages.\n                if *qos == 0x00 {\n                    byte_1 |= 0 \u003c\u003c 3;\n                }\n\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Subscribe {\n                packet_id: _,\n                topic_name: _,\n                properties: _,\n            } =\u003e {\n                let byte_1: u8 = 0x82_u8;\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Unsubscribe {\n                packet_id: _,\n                topic_name: _,\n                properties: _,\n            } =\u003e {\n                let byte_1: u8 = 0xA2_u8;\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Disconnect {\n                reason_code: _,\n                session_expiry_interval: _,\n                reason_string: _,\n                user_properties: _,\n            } =\u003e {\n                let byte_1: u8 = 0xE0_u8;\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Pingreq =\u003e {\n                let byte_1: u8 = 0xC0_u8;\n                writer.write_all(\u0026[byte_1])?;\n            }\n        }\n        Ok(())\n    }\n\n    fn write_packet_properties(\n        \u0026self,\n        writer: \u0026mut BufWriter\u003c\u0026mut dyn Write\u003e,\n    ) -\u003e std::io::Result\u003c()\u003e {\n        match self {\n            ClientMessage::Connect {\n                clean_start: _,\n                last_will_flag: _,\n                last_will_qos: _,\n                last_will_retain: _,\n                keep_alive: _,\n                properties: _,\n                client_id: _,\n                will_properties: _,\n                last_will_topic: _,\n                last_will_message: _,\n                username: _,\n                password: _,\n            } =\u003e todo!(),\n            ClientMessage::Publish {\n                packet_id,\n                topic_name,\n                qos: _,\n                retain_flag: _,\n                payload: _,\n                dup_flag: _,\n                properties,\n            } =\u003e {\n                write_u16(writer, packet_id)?;\n\n                write_string(writer, topic_name)?;\n\n                //Properties\n                properties.write_properties(writer)?;\n            }\n            ClientMessage::Subscribe {\n                packet_id,\n                topic_name,\n                properties,\n            } =\u003e {\n                write_u16(writer, packet_id)?;\n\n                write_string(writer, topic_name)?;\n\n                //Properties\n                properties.write_properties(writer)?;\n            }\n            ClientMessage::Unsubscribe {\n                packet_id,\n                topic_name,\n                properties,\n            } =\u003e {\n                write_u16(writer, packet_id)?;\n\n                write_string(writer, topic_name)?;\n\n                //Properties\n                properties.write_properties(writer)?;\n            }\n            ClientMessage::Disconnect {\n                reason_code,\n                session_expiry_interval,\n                reason_string,\n                user_properties,\n            } =\u003e {\n                //fixed header\n                let header: u8 = 0xE0_u8.to_le(); //11100000\n                write_u8(writer, \u0026header)?;\n                //variable_header\n                write_u8(writer, reason_code)?;\n\n                write_u8(writer, \u0026SESSION_EXPIRY_INTERVAL_ID)?;\n                write_u32(writer, session_expiry_interval)?;\n\n                write_u8(writer, \u0026REASON_STRING_ID)?;\n                write_string(writer, reason_string)?;\n\n                write_u8(writer, \u0026USER_PROPERTY_ID)?;\n                write_string_pairs(writer, user_properties)?;\n                writer.flush()?;\n            }\n            ClientMessage::Pingreq =\u003e {\n                let byte_1: u8 = 0xC0_u8;\n                writer.write_all(\u0026[byte_1])?;\n                writer.flush()?;\n            }\n        }\n\n        Ok(())\n    }\n\n    pub fn read_from(stream: \u0026mut impl Read) -\u003e Result\u003cClientMessage, Error\u003e {\n        let mut header = [0u8; 1];\n        stream.read_exact(\u0026mut header)?;\n\n        let mut header = u8::from_le_bytes(header);\n        let (mut dup_flag, mut qos, mut retain_flag) = (0, 0, 0);\n\n        let first_header_digits = header \u003e\u003e 4;\n        if first_header_digits == 0x3 {\n            let mask = 0b00001111;\n            let last_header_digits = header \u0026 mask;\n\n            header = 0x30_u8.to_le();\n\n            if last_header_digits \u0026 0b00000001 == 0b00000001 {\n                retain_flag = 1;\n            }\n            if last_header_digits \u0026 0b00000010 == 0b00000010 {\n                qos = 1;\n            }\n            if (last_header_digits \u003e\u003e 3) == 1 {\n                dup_flag = 1;\n            }\n        }\n\n        match header {\n            0x10 =\u003e {\n                //leo el protocol name\n\n                let protocol_name = read_string(stream)?;\n\n                if protocol_name != \"MQTT\" {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Nombre de protocolo inv√°lido\",\n                    ));\n                }\n                //protocol version\n                let protocol_version = read_u8(stream)?;\n\n                if protocol_version != PROTOCOL_VERSION {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Version de protocol inv√°lido\",\n                    ));\n                }\n\n                //connect flags\n                let connect_flags = read_u8(stream)?;\n                let clean_start = (connect_flags \u0026 (1 \u003c\u003c 1)) != 0;\n                let last_will_flag = (connect_flags \u0026 (1 \u003c\u003c 2)) != 0;\n                let last_will_qos = (connect_flags \u003e\u003e 3) \u0026 0b11;\n                let last_will_retain = (connect_flags \u0026 (1 \u003c\u003c 5)) != 0;\n\n                //keep alive\n                let keep_alive = read_u16(stream)?;\n                //properties\n                //payload\n                //client ID\n                let client_id = read_string(stream)?;\n                let will_properties = WillProperties::read_from(stream)?;\n\n                let mut last_will_topic = String::new();\n                let mut will_message = String::new();\n                if last_will_flag {\n                    last_will_topic = read_string(stream)?;\n                    will_message = read_string(stream)?;\n                }\n\n                let hay_user = (connect_flags \u0026 (1 \u003c\u003c 7)) != 0;\n                let mut user = String::new();\n                if hay_user {\n                    user = read_string(stream)?;\n                }\n\n                let hay_pass = (connect_flags \u0026 (1 \u003c\u003c 6)) != 0;\n                let mut pass = String::new();\n                if hay_pass {\n                    pass = read_string(stream)?;\n                }\n\n                let properties: ConnectProperties = ConnectProperties::read_from(stream)?;\n                Ok(ClientMessage::Connect {\n                    client_id: client_id.to_string(),\n                    clean_start,\n                    last_will_flag,\n                    last_will_qos,\n                    last_will_retain,\n                    keep_alive,\n                    properties,\n                    will_properties,\n                    last_will_topic: last_will_topic.to_string(),\n                    last_will_message: will_message.to_string(),\n                    username: user.to_string(),\n                    password: pass.to_string(),\n                })\n            }\n            0x30 =\u003e {\n                let topic_properties = TopicProperties {\n                    topic_alias: 10,\n                    response_topic: \"String\".to_string(),\n                };\n\n                let properties = PublishProperties::new(\n                    1,\n                    10,\n                    topic_properties,\n                    [1, 2, 3].to_vec(),\n                    \"a\".to_string(),\n                    1,\n                    \"a\".to_string(),\n                );\n                let packet_id = read_u16(stream)?;\n                let topic_name = read_string(stream)?;\n                PublishProperties::read_from(stream)?;\n                let message = read_string(stream)?;\n                Ok(ClientMessage::Publish {\n                    packet_id,\n                    topic_name,\n                    qos,\n                    retain_flag,\n                    payload: message,\n                    dup_flag,\n                    properties,\n                })\n            }\n            0x82 =\u003e {\n                let packet_id = read_u16(stream)?;\n                let topic = read_string(stream)?;\n                let properties = SubscribeProperties::read_properties(stream)?;\n                Ok(ClientMessage::Subscribe {\n                    packet_id,\n                    topic_name: topic,\n                    properties,\n                })\n            }\n            0xA2 =\u003e {\n                let packet_id = read_u16(stream)?;\n                let topic = read_string(stream)?;\n                let properties = SubscribeProperties::read_properties(stream)?;\n                Ok(ClientMessage::Unsubscribe {\n                    packet_id,\n                    topic_name: topic,\n                    properties,\n                })\n            }\n            0xE0 =\u003e {\n                let reason_code = read_u8(stream)?;\n                let session_expiry_interval_id = read_u8(stream)?;\n                if session_expiry_interval_id != SESSION_EXPIRY_INTERVAL_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid session expiry interval id\",\n                    ));\n                }\n                let session_expiry_interval = read_u32(stream)?;\n\n                let reason_string_id = read_u8(stream)?;\n                if reason_string_id != REASON_STRING_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid reason string id\",\n                    ));\n                }\n                let reason_string = read_string(stream)?;\n\n                let user_property_id = read_u8(stream)?;\n                if user_property_id != USER_PROPERTY_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid user property id\",\n                    ));\n                }\n                let user_properties = read_string_pairs(stream)?;\n\n                Ok(ClientMessage::Disconnect {\n                    reason_code,\n                    session_expiry_interval,\n                    reason_string,\n                    user_properties,\n                })\n            }\n            0xC0 =\u003e Ok(ClientMessage::Pingreq),\n            _ =\u003e Err(Error::new(std::io::ErrorKind::Other, \"Invalid header\")),\n        }\n    }\n\n    // pub fn analize_packet_id(\u0026self, packet: u16) -\u003e bool {\n    //     match self {\n    //         ClientMessage::Connect { clean_start, last_will_flag, last_will_qos, last_will_retain, keep_alive, properties, client_id, will_properties, last_will_topic, last_will_message, username, password } =\u003e todo!(),\n    //         ClientMessage::Publish { packet_id, topic_name, qos, retain_flag, payload, dup_flag, properties } =\u003e {\n    //             if *packet_id == packet {\n    //                 return true;\n    //             }\n    //             false\n    //         },\n    //         ClientMessage::Subscribe { packet_id, topic_name, properties } =\u003e {\n    //             if *packet_id == packet {\n    //                 return true;\n    //             }\n    //             false\n    //         },\n    //     }\n    // }\n}\n\n#[cfg(test)]\nmod tests {\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_01_connect_message_ok() {\n        let connect_propierties = ConnectProperties {\n            session_expiry_interval: 1,\n            receive_maximum: 2,\n            maximum_packet_size: 10,\n            topic_alias_maximum: 99,\n            request_response_information: true,\n            request_problem_information: false,\n            user_properties: vec![\n                (\"Hola\".to_string(), \"Mundo\".to_string()),\n                (\"Chau\".to_string(), \"Mundo\".to_string()),\n            ],\n            authentication_method: \"test\".to_string(),\n            authentication_data: vec![1_u8, 2_u8, 3_u8, 4_u8, 5_u8],\n        };\n        let will_properties = WillProperties::new(\n            120,\n            1,\n            30,\n            \"plain\".to_string(),\n            \"topic\".to_string(),\n            vec![1, 2, 3, 4, 5],\n            vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        );\n        let connect = ClientMessage::Connect {\n            clean_start: true,\n            last_will_flag: true,\n            last_will_qos: 1,\n            last_will_retain: true,\n            keep_alive: 35,\n            properties: connect_propierties,\n            client_id: \"kvtr33\".to_string(),\n            will_properties,\n            last_will_topic: \"topic\".to_string(),\n            last_will_message: \"chauchis\".to_string(),\n            username: \"prueba\".to_string(),\n            password: \"\".to_string(),\n        };\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match connect.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n\n        cursor.set_position(0);\n\n        match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(read_connect) =\u003e {\n                assert_eq!(connect, read_connect);\n            }\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        }\n    }\n\n    #[test]\n    fn test_02_connect_without_props_err() {\n        let connect_properties = ConnectProperties {\n            session_expiry_interval: 0,\n            receive_maximum: 0,\n            maximum_packet_size: 0,\n            topic_alias_maximum: 0,\n            request_response_information: false,\n            request_problem_information: false,\n            user_properties: vec![],\n            authentication_method: \"\".to_string(),\n            authentication_data: vec![],\n        };\n\n        let connect = ClientMessage::Connect {\n            clean_start: true,\n            last_will_flag: true,\n            last_will_qos: 1,\n            last_will_retain: true,\n            keep_alive: 35,\n            properties: connect_properties,\n            client_id: \"kvtr33\".to_string(),\n            will_properties: WillProperties::new(\n                0,\n                1,\n                0,\n                \"\".to_string(),\n                \"\".to_string(),\n                vec![],\n                vec![],\n            ),\n            last_will_topic: \"topic\".to_string(),\n            last_will_message: \"chauchis\".to_string(),\n            username: \"prueba\".to_string(),\n            password: \"\".to_string(),\n        };\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match connect.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n        cursor.set_position(0);\n\n        match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(read_connect) =\u003e {\n                assert_eq!(connect, read_connect);\n            }\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        }\n    }\n\n    #[test]\n    fn test_03_publish_message_ok() {\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let properties = PublishProperties::new(\n            1,\n            10,\n            topic_properties,\n            [1, 2, 3].to_vec(),\n            \"a\".to_string(),\n            1,\n            \"a\".to_string(),\n        );\n\n        let publish = ClientMessage::Publish {\n            packet_id: 1,\n            topic_name: \"mensajes para juan\".to_string(),\n            qos: 1,\n            retain_flag: 1,\n            payload: \"hola soy juan\".to_string(),\n            dup_flag: 1,\n            properties,\n        };\n\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match publish.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n        cursor.set_position(0);\n\n        match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(read_publish) =\u003e {\n                println!(\"{:?}\", read_publish);\n                assert_eq!(publish, read_publish);\n            }\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        }\n    }\n\n    #[test]\n    fn test_04_subscribe_ok() {\n        let sub = ClientMessage::Subscribe {\n            packet_id: 1,\n            topic_name: \"topico\".to_string(),\n            properties: SubscribeProperties::new(\n                1,\n                vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n                vec![0, 1, 2, 3],\n            ),\n        };\n\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match sub.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n        cursor.set_position(0);\n        let read_sub = match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(sub) =\u003e sub,\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        };\n        assert_eq!(sub, read_sub);\n    }\n\n    #[test]\n    fn test_05_disconnect_ok() {\n        let disconect = ClientMessage::Disconnect {\n            reason_code: 1,\n            session_expiry_interval: 1,\n            reason_string: \"hola\".to_string(),\n            user_properties: vec![(\"hola\".to_string(), \"mundo\".to_string())],\n        };\n\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match disconect.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n        cursor.set_position(0);\n        let read_disconect = match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(disconect) =\u003e disconect,\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        };\n        assert_eq!(disconect, read_disconect);\n    }\n}\n","traces":[{"line":99,"address":[],"length":0,"stats":{"Line":26},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":26},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":26},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":194,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":197,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":217,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":229,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":289,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":298,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":303,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":309,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":312,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":327,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":336,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":337,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":340,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":341,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":344,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":347,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":367,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":368,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":369,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":370,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":371,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":372,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":373,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":374,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":375,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":377,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":384,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":385,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":386,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":387,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":389,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":392,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":395,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":396,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":397,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":398,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":399,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":401,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":404,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":407,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":408,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":409,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":413,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":414,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":416,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":418,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":419,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":421,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":422,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":424,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":425,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":426,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":429,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":430,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":431,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":435,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":438,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":439,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":440,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":442,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":443,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":445,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":446,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":447,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":448,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":450,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":452,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":453,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":455,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":456,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":458,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":459,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":463,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":467,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":470,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":472,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":476,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":479,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":480,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":481,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":486,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":493,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":497,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":498,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":503,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":504,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":507,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":508,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":509,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":510,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":513,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":514,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":515,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":516,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":519,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":520,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":521,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":522,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":523,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":524,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":525,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":526,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":527,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":528,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":529,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":530,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":531,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":532,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":538,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":544,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":545,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":546,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":548,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":550,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":551,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":552,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":553,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":554,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":555,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":556,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":557,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":558,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":559,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":560,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":561,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":565,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":566,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":567,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":568,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":569,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":570,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":571,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":575,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":576,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":577,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":578,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":579,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":580,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":581,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":585,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":586,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":588,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":589,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":590,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":593,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":595,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":597,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":598,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":599,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":602,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":604,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":606,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":607,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":608,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":611,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":613,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":614,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":615,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":616,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":617,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":620,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":621,"address":[],"length":0,"stats":{"Line":4},"fn_name":null}],"covered":227,"coverable":273},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","connack_properties.rs"],"content":"use crate::mqtt::reader::*;\nuse crate::mqtt::writer::*;\nuse std::io::{BufReader, BufWriter, Error, ErrorKind, Read, Write};\n\n#[derive(Debug, PartialEq)]\npub struct ConnackProperties {\n    session_expiry_interval: u32,\n    receive_maximum: u16,\n    maximum_qos: bool,\n    retain_available: bool,\n    maximum_packet_size: u32,\n    assigned_client_identifier: String,\n    topic_alias_maximum: u16,\n    reason_string: String,\n    user_properties: Vec\u003c(String, String)\u003e,\n    wildcard_subscription_available: bool,\n    subscription_identifier_available: bool,\n    shared_subscription_available: bool,\n    server_keep_alive: u16,\n    response_information: String,\n    server_reference: String,\n    authentication_method: String,\n    authentication_data: Vec\u003cu8\u003e,\n}\n\nimpl ConnackProperties {\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e Result\u003c(), Error\u003e {\n        let mut writer = BufWriter::new(stream);\n\n        let session_expiry_interval_id: u8 = 0x11_u8; //17\n        print!(\n            \"session_expiry_interval_id: {:?}\",\n            session_expiry_interval_id\n        );\n        writer.write_all(\u0026[session_expiry_interval_id])?;\n        write_u32(\u0026mut writer, \u0026self.session_expiry_interval)?;\n\n        let assigned_client_identifier_id: u8 = 0x12_u8; //18\n        print!(\n            \"assigned_client_identifier_id: {:?}\",\n            assigned_client_identifier_id\n        );\n        writer.write_all(\u0026[assigned_client_identifier_id])?;\n        write_string(\u0026mut writer, \u0026self.assigned_client_identifier)?;\n\n        let authentication_method_id: u8 = 0x15_u8; //21\n        print!(\"authentication_method_id: {:?}\", authentication_method_id);\n        writer.write_all(\u0026[authentication_method_id])?;\n        write_string(\u0026mut writer, \u0026self.authentication_method)?;\n\n        let authentication_data_id: u8 = 0x16_u8; //22\n        print!(\"authentication_data_id: {:?}\", authentication_data_id);\n        writer.write_all(\u0026[authentication_data_id])?;\n        write_bin_vec(\u0026mut writer, \u0026self.authentication_data)?;\n\n        let response_information_id: u8 = 0x1A_u8; //26\n        print!(\"response_information_id: {:?}\", response_information_id);\n        writer.write_all(\u0026[response_information_id])?;\n        write_string(\u0026mut writer, \u0026self.response_information)?;\n\n        let server_reference_id: u8 = 0x1C_u8; //28\n        print!(\"server_reference_id: {:?}\", server_reference_id);\n        writer.write_all(\u0026[server_reference_id])?;\n        write_string(\u0026mut writer, \u0026self.server_reference)?;\n\n        let reason_string_id: u8 = 0x1F_u8; //31\n        print!(\"reason_string_id: {:?}\", reason_string_id);\n        writer.write_all(\u0026[reason_string_id])?;\n        write_string(\u0026mut writer, \u0026self.reason_string)?;\n\n        let receive_maximum_id: u8 = 0x21_u8; //33\n        print!(\"receive_maximum_id: {:?}\", receive_maximum_id);\n        writer.write_all(\u0026[receive_maximum_id])?;\n        write_u16(\u0026mut writer, \u0026self.receive_maximum)?;\n\n        let topic_alias_maximum_id: u8 = 0x22_u8; //34\n        print!(\"topic_alias_maximum_id: {:?}\", topic_alias_maximum_id);\n        writer.write_all(\u0026[topic_alias_maximum_id])?;\n        write_u16(\u0026mut writer, \u0026self.topic_alias_maximum)?;\n\n        let maximum_qos_id: u8 = 0x24_u8; //36\n        print!(\"maximum_qos_id: {:?}\", maximum_qos_id);\n        writer.write_all(\u0026[maximum_qos_id])?;\n        write_bool(\u0026mut writer, \u0026self.maximum_qos)?;\n\n        let retain_available_id: u8 = 0x25_u8; //37\n        print!(\"retain_available_id: {:?}\", retain_available_id);\n        writer.write_all(\u0026[retain_available_id])?;\n        write_bool(\u0026mut writer, \u0026self.retain_available)?;\n\n        let user_properties_id: u8 = 0x26_u8; //38\n        print!(\"user_properties_id: {:?}\", user_properties_id);\n        writer.write_all(\u0026[user_properties_id])?;\n        write_tuple_vec(\u0026mut writer, \u0026self.user_properties)?;\n\n        let maximum_packet_size_id: u8 = 0x27_u8; //39\n        print!(\"maximum_packet_size_id: {:?}\", maximum_packet_size_id);\n        writer.write_all(\u0026[maximum_packet_size_id])?;\n        write_u32(\u0026mut writer, \u0026self.maximum_packet_size)?;\n\n        let wildcard_subscription_available_id: u8 = 0x28_u8; //40\n        print!(\n            \"wildcard_subscription_available_id: {:?}\",\n            wildcard_subscription_available_id\n        );\n        writer.write_all(\u0026[wildcard_subscription_available_id])?;\n        write_bool(\u0026mut writer, \u0026self.wildcard_subscription_available)?;\n\n        let subscription_identifier_available_id: u8 = 0x29_u8; //41\n        print!(\n            \"subscription_identifier_available_id: {:?}\",\n            subscription_identifier_available_id\n        );\n        writer.write_all(\u0026[subscription_identifier_available_id])?;\n        write_bool(\u0026mut writer, \u0026self.subscription_identifier_available)?;\n\n        let shared_subscription_available_id: u8 = 0x2A_u8; //42\n        print!(\n            \"shared_subscription_available_id: {:?}\",\n            shared_subscription_available_id\n        );\n        writer.write_all(\u0026[shared_subscription_available_id])?;\n        write_bool(\u0026mut writer, \u0026self.shared_subscription_available)?;\n\n        let server_keep_alive_id: u8 = 0x2D_u8; //45\n        print!(\"server_keep_alive_id: {:?}\", server_keep_alive_id);\n        writer.write_all(\u0026[server_keep_alive_id])?;\n        write_u16(\u0026mut writer, \u0026self.server_keep_alive)?;\n\n        Ok(())\n    }\n\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cConnackProperties, Error\u003e {\n        let mut reader = BufReader::new(stream);\n\n        let mut session_expiry_interval: Option\u003cu32\u003e = None;\n        let mut receive_maximum: Option\u003cu16\u003e = None;\n        let mut maximum_qos: Option\u003cbool\u003e = None;\n        let mut retain_available: Option\u003cbool\u003e = None;\n        let mut maximum_packet_size: Option\u003cu32\u003e = None;\n        let mut assigned_client_identifier: Option\u003cString\u003e = None;\n        let mut topic_alias_maximum: Option\u003cu16\u003e = None;\n        let mut reason_string: Option\u003cString\u003e = None;\n        let mut user_properties: Option\u003cVec\u003c(String, String)\u003e\u003e = None;\n        let mut wildcard_subscription_available: Option\u003cbool\u003e = None;\n        let mut subscription_identifier_available: Option\u003cbool\u003e = None;\n        let mut shared_subscription_available: Option\u003cbool\u003e = None;\n        let mut server_keep_alive: Option\u003cu16\u003e = None;\n        let mut response_information: Option\u003cString\u003e = None;\n        let mut server_reference: Option\u003cString\u003e = None;\n        let mut authentication_method: Option\u003cString\u003e = None;\n        let mut authentication_data: Option\u003cVec\u003cu8\u003e\u003e = None;\n\n        let mut count = 0;\n        while let Ok(property_id) = read_u8(\u0026mut reader) {\n            match property_id {\n                0x11 =\u003e {\n                    let value = read_u32(\u0026mut reader)?;\n                    session_expiry_interval = Some(value);\n                }\n                0x12 =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    assigned_client_identifier = Some(value);\n                }\n                0x15 =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    authentication_method = Some(value);\n                }\n                0x16 =\u003e {\n                    let value = read_bin_vec(\u0026mut reader)?;\n                    authentication_data = Some(value);\n                }\n                0x1A =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    response_information = Some(value);\n                }\n                0x1C =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    server_reference = Some(value);\n                }\n                0x1F =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    reason_string = Some(value);\n                }\n                0x21 =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    receive_maximum = Some(value);\n                }\n                0x22 =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    topic_alias_maximum = Some(value);\n                }\n                0x24 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    maximum_qos = Some(value);\n                }\n                0x25 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    retain_available = Some(value);\n                }\n                0x26 =\u003e {\n                    let value = read_tuple_vec(\u0026mut reader)?;\n                    user_properties = Some(value);\n                }\n                0x27 =\u003e {\n                    let value = read_u32(\u0026mut reader)?;\n                    maximum_packet_size = Some(value);\n                }\n                0x28 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    wildcard_subscription_available = Some(value);\n                }\n                0x29 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    subscription_identifier_available = Some(value);\n                }\n                0x2A =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    shared_subscription_available = Some(value);\n                }\n                0x2D =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    server_keep_alive = Some(value);\n                }\n                _ =\u003e {\n                    return Err(Error::new(\n                        ErrorKind::InvalidData,\n                        format!(\"Invalid property id: {:?}\", property_id),\n                    ));\n                }\n            }\n            count += 1;\n            if count == 17 {\n                break;\n            }\n        }\n\n        Ok(ConnackProperties {\n            session_expiry_interval: session_expiry_interval.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing session_expiry_interval property\",\n            ))?,\n            receive_maximum: receive_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing receive_maximum property\",\n            ))?,\n            maximum_packet_size: maximum_packet_size.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_packet_size property\",\n            ))?,\n            topic_alias_maximum: topic_alias_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing topic_alias_maximum property\",\n            ))?,\n            user_properties: user_properties.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing user_properties property\",\n            ))?,\n            authentication_method: authentication_method.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_method property\",\n            ))?,\n            authentication_data: authentication_data.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_data property\",\n            ))?,\n            maximum_qos: maximum_qos.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_qos property\",\n            ))?,\n            retain_available: retain_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing retain_available property\",\n            ))?,\n            assigned_client_identifier: assigned_client_identifier.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing assigned_client_identifier property\",\n            ))?,\n            reason_string: reason_string.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing reason_string property\",\n            ))?,\n            wildcard_subscription_available: wildcard_subscription_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing wildcard_subscription_available property\",\n            ))?,\n            subscription_identifier_available: subscription_identifier_available.ok_or(\n                Error::new(\n                    ErrorKind::InvalidData,\n                    \"Missing subscription_identifier_available property\",\n                ),\n            )?,\n            shared_subscription_available: shared_subscription_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing shared_subscription_available property\",\n            ))?,\n            server_keep_alive: server_keep_alive.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing server_keep_alive property\",\n            ))?,\n            response_information: response_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing response_information property\",\n            ))?,\n            server_reference: server_reference.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing server_reference property\",\n            ))?,\n        })\n    }\n}\n\npub struct ConnackPropertiesBuilder {\n    session_expiry_interval: Option\u003cu32\u003e,\n    receive_maximum: Option\u003cu16\u003e,\n    maximum_qos: Option\u003cbool\u003e,\n    retain_available: Option\u003cbool\u003e,\n    maximum_packet_size: Option\u003cu32\u003e,\n    assigned_client_identifier: Option\u003cString\u003e,\n    topic_alias_maximum: Option\u003cu16\u003e,\n    reason_string: Option\u003cString\u003e,\n    user_properties: Option\u003cVec\u003c(String, String)\u003e\u003e,\n    wildcard_subscription_available: Option\u003cbool\u003e,\n    subscription_identifier_available: Option\u003cbool\u003e,\n    shared_subscription_available: Option\u003cbool\u003e,\n    server_keep_alive: Option\u003cu16\u003e,\n    response_information: Option\u003cString\u003e,\n    server_reference: Option\u003cString\u003e,\n    authentication_method: Option\u003cString\u003e,\n    authentication_data: Option\u003cVec\u003cu8\u003e\u003e,\n}\n\nimpl Default for ConnackPropertiesBuilder {\n    fn default() -\u003e Self {\n        ConnackPropertiesBuilder::new()\n    }\n}\n\nimpl ConnackPropertiesBuilder {\n    pub fn new() -\u003e ConnackPropertiesBuilder {\n        ConnackPropertiesBuilder {\n            session_expiry_interval: None,\n            receive_maximum: None,\n            maximum_qos: None,\n            retain_available: None,\n            maximum_packet_size: None,\n            assigned_client_identifier: None,\n            topic_alias_maximum: None,\n            reason_string: None,\n            user_properties: None,\n            wildcard_subscription_available: None,\n            subscription_identifier_available: None,\n            shared_subscription_available: None,\n            server_keep_alive: None,\n            response_information: None,\n            server_reference: None,\n            authentication_method: None,\n            authentication_data: None,\n        }\n    }\n\n    pub fn session_expiry_interval(mut self, value: u32) -\u003e Self {\n        self.session_expiry_interval = Some(value);\n        self\n    }\n\n    pub fn receive_maximum(mut self, value: u16) -\u003e Self {\n        self.receive_maximum = Some(value);\n        self\n    }\n\n    pub fn maximum_qos(mut self, value: bool) -\u003e Self {\n        self.maximum_qos = Some(value);\n        self\n    }\n\n    pub fn retain_available(mut self, value: bool) -\u003e Self {\n        self.retain_available = Some(value);\n        self\n    }\n\n    pub fn maximum_packet_size(mut self, value: u32) -\u003e Self {\n        self.maximum_packet_size = Some(value);\n        self\n    }\n\n    pub fn assigned_client_identifier(mut self, value: String) -\u003e Self {\n        self.assigned_client_identifier = Some(value);\n        self\n    }\n\n    pub fn topic_alias_maximum(mut self, value: u16) -\u003e Self {\n        self.topic_alias_maximum = Some(value);\n        self\n    }\n\n    pub fn reason_string(mut self, value: String) -\u003e Self {\n        self.reason_string = Some(value);\n        self\n    }\n\n    pub fn user_properties(mut self, value: Vec\u003c(String, String)\u003e) -\u003e Self {\n        self.user_properties = Some(value);\n        self\n    }\n\n    pub fn wildcard_subscription_available(mut self, value: bool) -\u003e Self {\n        self.wildcard_subscription_available = Some(value);\n        self\n    }\n\n    pub fn subscription_identifier_available(mut self, value: bool) -\u003e Self {\n        self.subscription_identifier_available = Some(value);\n        self\n    }\n\n    pub fn shared_subscription_available(mut self, value: bool) -\u003e Self {\n        self.shared_subscription_available = Some(value);\n        self\n    }\n\n    pub fn server_keep_alive(mut self, value: u16) -\u003e Self {\n        self.server_keep_alive = Some(value);\n        self\n    }\n\n    pub fn response_information(mut self, value: String) -\u003e Self {\n        self.response_information = Some(value);\n        self\n    }\n\n    pub fn server_reference(mut self, value: String) -\u003e Self {\n        self.server_reference = Some(value);\n        self\n    }\n\n    pub fn authentication_method(mut self, value: String) -\u003e Self {\n        self.authentication_method = Some(value);\n        self\n    }\n\n    pub fn authentication_data(mut self, value: Vec\u003cu8\u003e) -\u003e Self {\n        self.authentication_data = Some(value);\n        self\n    }\n\n    pub fn build(self) -\u003e Result\u003cConnackProperties, Error\u003e {\n        Ok(ConnackProperties {\n            session_expiry_interval: self.session_expiry_interval.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing session_expiry_interval property\",\n            ))?,\n            receive_maximum: self.receive_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing receive_maximum property\",\n            ))?,\n            maximum_qos: self.maximum_qos.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_qos property\",\n            ))?,\n            retain_available: self.retain_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing retain_available property\",\n            ))?,\n            maximum_packet_size: self.maximum_packet_size.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_packet_size property\",\n            ))?,\n            assigned_client_identifier: self.assigned_client_identifier.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing assigned_client_identifier property\",\n            ))?,\n            topic_alias_maximum: self.topic_alias_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing topic_alias_maximum property\",\n            ))?,\n            reason_string: self.reason_string.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing reason_string property\",\n            ))?,\n            user_properties: self.user_properties.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing user_properties property\",\n            ))?,\n            wildcard_subscription_available: self.wildcard_subscription_available.ok_or(\n                Error::new(\n                    ErrorKind::InvalidData,\n                    \"Missing wildcard_subscription_available property\",\n                ),\n            )?,\n            subscription_identifier_available: self.subscription_identifier_available.ok_or(\n                Error::new(\n                    ErrorKind::InvalidData,\n                    \"Missing subscription_identifier_available property\",\n                ),\n            )?,\n            shared_subscription_available: self.shared_subscription_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing shared_subscription_available property\",\n            ))?,\n            server_keep_alive: self.server_keep_alive.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing server_keep_alive property\",\n            ))?,\n            response_information: self.response_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing response_information property\",\n            ))?,\n            server_reference: self.server_reference.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing server_reference property\",\n            ))?,\n            authentication_method: self.authentication_method.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_method property\",\n            ))?,\n            authentication_data: self.authentication_data.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_data property\",\n            ))?,\n        })\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","connect_config.rs"],"content":"use crate::mqtt::{connect_properties::ConnectProperties, will_properties::WillProperties};\n\nuse super::{client_message::ClientMessage, messages_config::MessagesConfig};\n\npub struct ConnectConfig {\n    pub(crate) clean_start: bool,\n    pub(crate) last_will_flag: bool,\n    pub(crate) last_will_qos: u8,\n    pub(crate) last_will_retain: bool,\n    pub(crate) keep_alive: u16,\n    pub(crate) properties: ConnectProperties,\n    pub(crate) client_id: String,\n    pub(crate) will_properties: WillProperties,\n    pub(crate) last_will_topic: String,\n    pub(crate) last_will_message: String,\n    pub(crate) username: String,\n    pub(crate) password: String,\n}\n\nimpl MessagesConfig for ConnectConfig {\n    fn parse_message(\u0026self, _packet_id: u16) -\u003e ClientMessage {\n        ClientMessage::Connect {\n            clean_start: self.clean_start,\n            last_will_flag: self.last_will_flag,\n            last_will_qos: self.last_will_qos,\n            last_will_retain: self.last_will_retain,\n            keep_alive: self.keep_alive,\n            properties: self.properties.clone(),\n            client_id: self.client_id.clone(),\n            will_properties: self.will_properties.clone(),\n            last_will_topic: self.last_will_topic.clone(),\n            last_will_message: self.last_will_message.clone(),\n            username: self.username.clone(),\n            password: self.password.clone(),\n        }\n    }\n}\n\nimpl ConnectConfig {\n    #[allow(clippy::too_many_arguments)]\n    pub fn new(\n        clean_start: bool,\n        last_will_flag: bool,\n        last_will_qos: u8,\n        last_will_retain: bool,\n        keep_alive: u16,\n        properties: ConnectProperties,\n        client_id: String,\n        will_properties: WillProperties,\n        last_will_topic: String,\n        last_will_message: String,\n        username: String,\n        password: String,\n    ) -\u003e ConnectConfig {\n        ConnectConfig {\n            clean_start,\n            last_will_flag,\n            last_will_qos,\n            last_will_retain,\n            keep_alive,\n            properties,\n            client_id,\n            will_properties,\n            last_will_topic,\n            last_will_message,\n            username,\n            password,\n        }\n    }\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":14},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","connect_properties.rs"],"content":"use crate::utils::{reader::*, writer::*};\n\nuse std::io::{BufReader, BufWriter, Error, ErrorKind, Read, Write};\n\n#[derive(Debug, PartialEq, Clone)]\npub struct ConnectProperties {\n    pub session_expiry_interval: u32,\n    pub receive_maximum: u16,\n    pub maximum_packet_size: u32,\n    pub topic_alias_maximum: u16,\n    pub request_response_information: bool,\n    pub request_problem_information: bool,\n    pub user_properties: Vec\u003c(String, String)\u003e,\n    pub authentication_method: String,\n    pub authentication_data: Vec\u003cu8\u003e,\n}\n\nimpl ConnectProperties {\n    #[allow(clippy::too_many_arguments)]\n    pub fn new(\n        session_expiry_interval: u32,\n        receive_maximum: u16,\n        maximum_packet_size: u32,\n        topic_alias_maximum: u16,\n        request_response_information: bool,\n        request_problem_information: bool,\n        user_properties: Vec\u003c(String, String)\u003e,\n        authentication_method: String,\n        authentication_data: Vec\u003cu8\u003e,\n    ) -\u003e ConnectProperties {\n        ConnectProperties {\n            session_expiry_interval,\n            receive_maximum,\n            maximum_packet_size,\n            topic_alias_maximum,\n            request_response_information,\n            request_problem_information,\n            user_properties,\n            authentication_method,\n            authentication_data,\n        }\n    }\n\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e Result\u003c(), Error\u003e {\n        let mut writer = BufWriter::new(stream);\n\n        let session_expiry_interval_id: u8 = 0x11_u8;\n\n        writer.write_all(\u0026[session_expiry_interval_id])?;\n        write_u32(\u0026mut writer, \u0026self.session_expiry_interval)?;\n\n        let authentication_method_id: u8 = 0x15_u8;\n        writer.write_all(\u0026[authentication_method_id])?;\n        write_string(\u0026mut writer, \u0026self.authentication_method)?;\n\n        let authentication_data_id: u8 = 0x16_u8;\n        writer.write_all(\u0026[authentication_data_id])?;\n        write_bin_vec(\u0026mut writer, \u0026self.authentication_data)?;\n\n        let request_problem_information_id: u8 = 0x17_u8;\n        writer.write_all(\u0026[request_problem_information_id])?;\n        write_bool(\u0026mut writer, \u0026self.request_problem_information)?;\n\n        let request_response_information_id: u8 = 0x19_u8; // 25\n\n        writer.write_all(\u0026[request_response_information_id])?;\n        write_bool(\u0026mut writer, \u0026self.request_response_information)?;\n\n        let receive_maximum_id: u8 = 0x21_u8; // 33\n        writer.write_all(\u0026[receive_maximum_id])?;\n        write_u16(\u0026mut writer, \u0026self.receive_maximum)?;\n\n        let topic_alias_maximum_id: u8 = 0x22_u8; // 34\n        writer.write_all(\u0026[topic_alias_maximum_id])?;\n        write_u16(\u0026mut writer, \u0026self.topic_alias_maximum)?;\n\n        let user_properties_id: u8 = 0x26_u8; // 38\n        writer.write_all(\u0026[user_properties_id])?;\n        write_tuple_vec(\u0026mut writer, \u0026self.user_properties)?;\n\n        let maximum_packet_size_id: u8 = 0x27_u8; // 39\n        writer.write_all(\u0026[maximum_packet_size_id])?;\n        write_u32(\u0026mut writer, \u0026self.maximum_packet_size)?;\n\n        Ok(())\n    }\n\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cConnectProperties, Error\u003e {\n        let mut reader = BufReader::new(stream);\n\n        let mut session_expiry_interval: Option\u003cu32\u003e = None;\n        let mut receive_maximum: Option\u003cu16\u003e = None;\n        let mut maximum_packet_size: Option\u003cu32\u003e = None;\n        let mut topic_alias_maximum: Option\u003cu16\u003e = None;\n        let mut request_response_information: Option\u003cbool\u003e = None;\n        let mut request_problem_information: Option\u003cbool\u003e = None;\n        let mut user_properties: Option\u003cVec\u003c(String, String)\u003e\u003e = None;\n        let mut authentication_method: Option\u003cString\u003e = None;\n        let mut authentication_data: Option\u003cVec\u003cu8\u003e\u003e = None;\n        let mut count = 0;\n        while let Ok(property_id) = read_u8(\u0026mut reader) {\n            match property_id {\n                0x11 =\u003e {\n                    let value = read_u32(\u0026mut reader)?;\n                    session_expiry_interval = Some(value);\n                }\n                0x15 =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    authentication_method = Some(value);\n                }\n                0x16 =\u003e {\n                    let value = read_bin_vec(\u0026mut reader)?;\n                    authentication_data = Some(value);\n                }\n                0x17 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    request_problem_information = Some(value);\n                }\n                0x19 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    request_response_information = Some(value);\n                }\n                0x21 =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    receive_maximum = Some(value);\n                }\n                0x22 =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    topic_alias_maximum = Some(value);\n                }\n                0x26 =\u003e {\n                    let value = read_tuple_vec(\u0026mut reader)?;\n                    user_properties = Some(value);\n                }\n                0x27 =\u003e {\n                    let value = read_u32(\u0026mut reader)?;\n                    maximum_packet_size = Some(value);\n                }\n                _ =\u003e {\n                    return Err(Error::new(ErrorKind::InvalidData, \"Property ID inv√°lido\"));\n                }\n            }\n            count += 1;\n            if count == 9 {\n                break;\n            }\n        }\n\n        Ok(ConnectProperties {\n            session_expiry_interval: session_expiry_interval.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing session_expiry_interval property\",\n            ))?,\n            receive_maximum: receive_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing receive_maximum property\",\n            ))?,\n            maximum_packet_size: maximum_packet_size.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_packet_size property\",\n            ))?,\n            topic_alias_maximum: topic_alias_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing topic_alias_maximum property\",\n            ))?,\n            request_response_information: request_response_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing request_response_information property\",\n            ))?,\n            request_problem_information: request_problem_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing request_problem_information property\",\n            ))?,\n            user_properties: user_properties.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing user_properties property\",\n            ))?,\n            authentication_method: authentication_method.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_method property\",\n            ))?,\n            authentication_data: authentication_data.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_data property\",\n            ))?,\n        })\n    }\n}\n\n#[derive(Default)]\npub struct ConnectPropertiesBuilder {\n    session_expiry_interval: Option\u003cu32\u003e,\n    receive_maximum: Option\u003cu16\u003e,\n    maximum_packet_size: Option\u003cu32\u003e,\n    topic_alias_maximum: Option\u003cu16\u003e,\n    request_response_information: Option\u003cbool\u003e,\n    request_problem_information: Option\u003cbool\u003e,\n    user_properties: Option\u003cVec\u003c(String, String)\u003e\u003e,\n    authentication_method: Option\u003cString\u003e,\n    authentication_data: Option\u003cVec\u003cu8\u003e\u003e,\n}\n\nimpl ConnectPropertiesBuilder {\n    pub fn create(self) -\u003e Result\u003cConnectProperties, Error\u003e {\n        Ok(ConnectProperties {\n            session_expiry_interval: self.session_expiry_interval.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing session_expiry_interval property\",\n            ))?,\n            receive_maximum: self.receive_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing receive_maximum property\",\n            ))?,\n            maximum_packet_size: self.maximum_packet_size.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_packet_size property\",\n            ))?,\n            topic_alias_maximum: self.topic_alias_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing topic_alias_maximum property\",\n            ))?,\n            request_response_information: self.request_response_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing request_response_information property\",\n            ))?,\n            request_problem_information: self.request_problem_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing request_problem_information property\",\n            ))?,\n            user_properties: self.user_properties.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing user_properties property\",\n            ))?,\n            authentication_method: self.authentication_method.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_method property\",\n            ))?,\n            authentication_data: self.authentication_data.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_data property\",\n            ))?,\n        })\n    }\n\n    pub fn session_expiry_interval(mut self, value: u32) -\u003e Self {\n        self.session_expiry_interval = Some(value);\n        self\n    }\n\n    pub fn receive_maximum(mut self, value: u16) -\u003e Self {\n        self.receive_maximum = Some(value);\n        self\n    }\n\n    pub fn maximum_packet_size(mut self, value: u32) -\u003e Self {\n        self.maximum_packet_size = Some(value);\n        self\n    }\n\n    pub fn topic_alias_maximum(mut self, value: u16) -\u003e Self {\n        self.topic_alias_maximum = Some(value);\n        self\n    }\n\n    pub fn request_response_information(mut self, value: bool) -\u003e Self {\n        self.request_response_information = Some(value);\n        self\n    }\n\n    pub fn request_problem_information(mut self, value: bool) -\u003e Self {\n        self.request_problem_information = Some(value);\n        self\n    }\n\n    pub fn user_properties(mut self, value: Vec\u003c(String, String)\u003e) -\u003e Self {\n        self.user_properties = Some(value);\n        self\n    }\n\n    pub fn authentication_method(mut self, value: String) -\u003e Self {\n        self.authentication_method = Some(value);\n        self\n    }\n\n    pub fn authentication_data(mut self, value: Vec\u003cu8\u003e) -\u003e Self {\n        self.authentication_data = Some(value);\n        self\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use core::panic;\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_01_connect_properties_ok() {\n        let mut buffer = Cursor::new(Vec::new());\n        let connect_properties = ConnectProperties {\n            session_expiry_interval: 1,\n            receive_maximum: 2,\n            maximum_packet_size: 10,\n            topic_alias_maximum: 99,\n            request_response_information: true,\n            request_problem_information: false,\n            user_properties: vec![\n                (\"Hola\".to_string(), \"Mundo\".to_string()),\n                (\"Chau\".to_string(), \"Mundo\".to_string()),\n            ],\n            authentication_method: \"test\".to_string(),\n            authentication_data: vec![1_u8, 2_u8, 3_u8, 4_u8, 5_u8],\n        };\n\n        match connect_properties.write_to(\u0026mut buffer) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                println!(\"Error: {:?}\", e);\n                panic!();\n            }\n        }\n        buffer.set_position(0);\n\n        let connect_properties_read = match ConnectProperties::read_from(\u0026mut buffer) {\n            Ok(properties) =\u003e properties,\n            Err(e) =\u003e {\n                println!(\"Error: {:?}\", e);\n\n                panic!();\n            }\n        };\n        assert_eq!(connect_properties, connect_properties_read);\n    }\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":162},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":81},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":81},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":168,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":204,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":215,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":252,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":271,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":91,"coverable":149},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","error.rs"],"content":"#[derive(Debug)]\npub struct ClientError {\n    message: String,\n}\n\nimpl ClientError {\n    pub fn new(message: \u0026str) -\u003e Self {\n        Self {\n            message: message.to_string(),\n        }\n    }\n}\n\nimpl std::fmt::Display for ClientError {\n    fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n        write!(f, \"{}\", self.message)\n    }\n}\n\nimpl std::error::Error for ClientError {}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":9,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":16,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":4},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","incident.rs"],"content":"pub struct Incident {\n    location: (f64, f64),\n    time: String,\n    incident_type: String,\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","messages_config.rs"],"content":"use crate::mqtt::client_message::ClientMessage;\n\npub trait MessagesConfig {\n    fn parse_message(\u0026self, packet_id: u16) -\u003e ClientMessage;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","mod.rs"],"content":"pub mod client;\n\npub mod broker;\n\npub mod broker_message;\n\npub mod client_message;\n\npub mod publish_properties;\n\npub mod reason_code;\n\npub mod protocol_error;\n\npub mod protocol_return;\n\npub mod connect_properties;\n\npub mod quality_of_service;\n\npub mod reader;\n\npub mod subscribe_properties;\npub mod writer;\n\npub mod will_properties;\n\npub mod connack_properties;\npub mod topic;\n\npub mod error;\n\npub mod incident;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","protocol_error.rs"],"content":"use std::fmt;\n\n///Here are detailed all the errors that the protocol is capable of throwing.\n/// Unspecified se usa de placeholder para los results de los tests\n#[derive(Debug)]\npub enum ProtocolError {\n    ConectionError,\n    InvalidQOS,\n    InvalidNumberOfArguments,\n    StreamError,\n    ReadingTopicConfigFileError,\n    LockError,\n    PublishError,\n    SubscribeError,\n    UnsubscribeError,\n    UnspecifiedError,\n}\n\nimpl fmt::Display for ProtocolError {\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter) -\u003e fmt::Result {\n        match *self {\n            ProtocolError::ConectionError =\u003e write!(f, \"Error al conectar al broker.\"),\n            ProtocolError::InvalidQOS =\u003e write!(f, \"Error: Valor de QoS inv√°lido. Debe ser 0 o 1.\"),\n            ProtocolError::InvalidNumberOfArguments =\u003e {\n                write!(f, \"Error: n√∫mero de argumentos inv√°lido\")\n            }\n            ProtocolError::StreamError =\u003e write!(f, \"Error: Error en la creaci√≥n de un stream.\"),\n            ProtocolError::LockError =\u003e write!(f, \"Error en Lock.\"),\n            ProtocolError::PublishError =\u003e write!(f, \"Error al realizar un publish.\"),\n            ProtocolError::SubscribeError =\u003e write!(f, \"Error al realizar la subscripcion.\"),\n            ProtocolError::UnsubscribeError =\u003e write!(f, \"Error al desuscribirse.\"),\n\n            ProtocolError::ReadingTopicConfigFileError =\u003e {\n                write!(f, \"Error al leer el archivo de configuraci√≥n de t√≥picos\")\n            }\n            ProtocolError::UnspecifiedError =\u003e {\n                write!(f, \"Error no especificado\")\n            }\n        }\n    }\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":12},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","protocol_return.rs"],"content":"use std::fmt;\n\n#[derive(Debug, PartialEq)]\npub enum ProtocolReturn {\n    ConnackSent,\n    SubackSent,\n    PubackSent,\n    PingrespSent,\n    UnsubackSent,\n    DisconnectRecieved,\n    PlaceHolder,\n    DisconnectSent,\n}\n\nimpl fmt::Display for ProtocolReturn {\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter) -\u003e fmt::Result {\n        match *self {\n            ProtocolReturn::ConnackSent =\u003e write!(f, \"Connack Enviado.\"),\n            ProtocolReturn::SubackSent =\u003e write!(f, \"Suback Enviado.\"),\n            ProtocolReturn::PubackSent =\u003e write!(f, \"Puback Enviado.\"),\n            ProtocolReturn::PingrespSent =\u003e write!(f, \"Pingresp Enviado.\"),\n            ProtocolReturn::UnsubackSent =\u003e write!(f, \"Unsuback Enviado.\"),\n            ProtocolReturn::DisconnectRecieved =\u003e write!(f, \"Disconnect Recibido.\"),\n            ProtocolReturn::PlaceHolder =\u003e write!(f, \"Placeholder.\"),\n            ProtocolReturn::DisconnectSent =\u003e write!(f, \"Disconnect Enviado.\"),\n        }\n    }\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":17,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":10},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","publish_config.rs"],"content":"use crate::mqtt::{\n    client_message::ClientMessage, messages_config::MessagesConfig,\n    publish_properties::PublishProperties,\n};\n\npub struct PublishConfig {\n    pub(crate) dup_flag: usize,\n    pub(crate) qos: usize,\n    pub(crate) retain_flag: usize,\n    pub(crate) topic_name: String,\n    pub(crate) payload: String,\n    pub(crate) publish_properties: PublishProperties,\n}\n\nimpl MessagesConfig for PublishConfig {\n    fn parse_message(\u0026self, packet_id: u16) -\u003e ClientMessage {\n        ClientMessage::Publish {\n            packet_id,\n            topic_name: self.topic_name.clone(),\n            qos: self.qos,\n            retain_flag: self.retain_flag,\n            payload: self.payload.clone(),\n            dup_flag: self.dup_flag,\n            properties: self.publish_properties.clone(),\n        }\n    }\n}\n\nimpl PublishConfig {\n    pub fn new(\n        dup_flag: usize,\n        qos: usize,\n        retain_flag: usize,\n        topic_name: String,\n        payload: String,\n        publish_properties: PublishProperties,\n    ) -\u003e PublishConfig {\n        PublishConfig {\n            dup_flag,\n            qos,\n            retain_flag,\n            topic_name,\n            payload,\n            publish_properties,\n        }\n    }\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":8},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","publish_properties.rs"],"content":"use std::io::{Error, Read, Write};\n\nuse crate::utils::{reader::*, writer::*};\n\n//PROPERTIES IDs\nconst PAYLOAD_FORMAT_INDICATOR_ID: u8 = 0x01;\nconst MESSAGE_EXPIRY_INTERVAL_ID: u8 = 0x02;\nconst TOPIC_ALIAS_ID: u8 = 0x23;\nconst RESPONSE_TOPIC_ID: u8 = 0x08;\nconst CORRELATION_DATA_ID: u8 = 0x09;\nconst USER_PROPERTY_ID: u8 = 0x26;\nconst SUBSCRIPTION_IDENTIFIER_ID: u8 = 0x0B;\nconst CONTENT_TYPE_ID: u8 = 0x03;\n\n#[derive(Debug, PartialEq, Clone)]\npub struct PublishProperties {\n    /// Si vale 0, indica que el payload tiene bytes unspecified -\u003e es equivalente a no enviar un payload format indicator.\n    /// Si vale 1 indica que el payload esta encodeado en UTF-8\n    pub payload_format_indicator: u8,\n\n    ///Indica el lifetime del application message en segundos.\n    ///Si este intervalo expira y el servidor no ha hecho el delivery, se debe eliminar la copia del mensaje para ese subscriptor.\n    pub message_expiry_interval: u32,\n    pub topic_properties: TopicProperties,\n    pub correlation_data: Vec\u003cu8\u003e,\n    pub user_property: String,\n    pub subscription_identifier: u32,\n    pub content_type: String,\n}\n\n#[derive(Debug, PartialEq, Clone)]\npub struct TopicProperties {\n    pub topic_alias: u16,\n    pub response_topic: String,\n}\n\nimpl PublishProperties {\n    pub fn new(\n        payload_format_indicator: u8,\n        message_expiry_interval: u32,\n        topic_properties: TopicProperties,\n        correlation_data: Vec\u003cu8\u003e,\n        user_property: String,\n        subscription_identifier: u32,\n        content_type: String,\n    ) -\u003e PublishProperties {\n        PublishProperties {\n            payload_format_indicator,\n            message_expiry_interval,\n            topic_properties,\n            correlation_data,\n            user_property,\n            subscription_identifier,\n            content_type,\n        }\n    }\n\n    pub fn write_properties(\u0026self, stream: \u0026mut dyn Write) -\u003e std::io::Result\u003c()\u003e {\n        //payload format indicator\n        write_u8(stream, \u0026PAYLOAD_FORMAT_INDICATOR_ID)?;\n        write_u8(stream, \u0026self.payload_format_indicator)?;\n\n        //message expiry interval\n        write_u8(stream, \u0026MESSAGE_EXPIRY_INTERVAL_ID)?;\n        write_u32(stream, \u0026self.message_expiry_interval)?;\n\n        //topic alias\n        write_u8(stream, \u0026TOPIC_ALIAS_ID)?;\n        write_u16(stream, \u0026self.topic_properties.topic_alias)?;\n\n        //response topic\n        write_u8(stream, \u0026RESPONSE_TOPIC_ID)?;\n        write_string(stream, \u0026self.topic_properties.response_topic)?;\n\n        //correlation data\n        write_u8(stream, \u0026CORRELATION_DATA_ID)?;\n        write_bin_vec(stream, \u0026self.correlation_data)?;\n\n        //user property\n        write_u8(stream, \u0026USER_PROPERTY_ID)?;\n        write_string(stream, \u0026self.user_property)?;\n\n        //subscription identifier\n        write_u8(stream, \u0026SUBSCRIPTION_IDENTIFIER_ID)?;\n        write_u32(stream, \u0026self.subscription_identifier)?;\n\n        //content type\n        write_u8(stream, \u0026CONTENT_TYPE_ID)?;\n        write_string(stream, \u0026self.content_type)?;\n\n        Ok(())\n    }\n    #[allow(dead_code)]\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cPublishProperties, Error\u003e {\n        //payload format indicator\n        let _payload_format_indicator_id = read_u8(stream)?;\n        let payload_format_indicator = read_u8(stream)?;\n\n        //message expiry interval\n        let _message_expiry_interval_id = read_u8(stream)?;\n        let message_expiry_interval = read_u32(stream)?;\n\n        //topic alias\n        let _topic_alias_id = read_u8(stream)?;\n        let topic_alias = read_u16(stream)?;\n\n        //response topic\n        let _response_topic_id = read_u8(stream)?;\n        let response_topic = read_string(stream)?;\n\n        let topic_properties = TopicProperties {\n            topic_alias,\n            response_topic,\n        };\n\n        //correlation data\n        let _correlation_data_id = read_u8(stream)?;\n        let correlation_data = read_bin_vec(stream)?;\n\n        //user property\n        let _user_property_id = read_u8(stream)?;\n        let user_property = read_string(stream)?;\n\n        //subscription identifier\n        let _subscription_identifier_id = read_u8(stream)?;\n        let subscription_identifier = read_u32(stream)?;\n\n        //content type\n        let _content_type_id = read_u8(stream)?;\n        let content_type = read_string(stream)?;\n\n        Ok(PublishProperties {\n            payload_format_indicator,\n            message_expiry_interval,\n            topic_properties,\n            correlation_data,\n            user_property,\n            subscription_identifier,\n            content_type,\n        })\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_01_publish_properties_ok() {\n        let mut buffer = Cursor::new(Vec::new());\n\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let properties = PublishProperties::new(\n            1,\n            10,\n            topic_properties,\n            [1, 2, 3].to_vec(),\n            \"a\".to_string(),\n            1,\n            \"a\".to_string(),\n        );\n\n        match properties.write_properties(\u0026mut buffer) {\n            Ok(_) =\u003e (),\n            Err(err) =\u003e panic!(\"Error writing properties: {:?}\", err),\n        }\n        buffer.set_position(0);\n\n        let publish_properties_read = match PublishProperties::read_from(\u0026mut buffer) {\n            Ok(properties) =\u003e properties,\n            Err(err) =\u003e panic!(\"Error reading properties: {:?}\", err),\n        };\n        assert_eq!(properties, publish_properties_read);\n    }\n}\n","traces":[{"line":38,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":5},"fn_name":null}],"covered":44,"coverable":44},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","reason_code.rs"],"content":"use std::io::Error;\n\n///  reason codes in HEX\npub const SUCCESS_HEX: u8 = 0x00;\npub const NO_MATCHING_SUBSCRIBERS_HEX: u8 = 0x10;\npub const UNSPECIFIED_ERROR_HEX: u8 = 0x80;\npub const IMPLEMENTATION_SPECIFIC_ERROR_HEX: u8 = 0x83;\npub const NOT_AUTHORIZED_HEX: u8 = 0x87;\npub const TOPIC_NAME_INVALID_HEX: u8 = 0x90;\npub const PACKET_ID_IN_USE_HEX: u8 = 0x91;\npub const QUOTA_EXCEEDED_HEX: u8 = 0x97;\npub const PAYLOAD_FORMAT_INVALID_HEX: u8 = 0x99;\npub const SUB_ID_DUP_HEX: u8 = 0x85;\n\npub enum ReasonCode {\n    Success { reason_code: u8 },\n    NoMatchingSubscribers { reason_code: u8 },\n    UnspecifiedError { reason_code: u8 },\n    ImplementationSpecificError { reason_code: u8 },\n    NotAuthorized { reason_code: u8 },\n    TopicNameInvalid { reason_code: u8 },\n    PacketIdentifierInUse { reason_code: u8 },\n    QuotaExceeded { reason_code: u8 },\n    PayloadFormatInvalid { reason_code: u8 },\n    SubIdDup { reason_code: u8 },\n}\n\nimpl ReasonCode {\n    pub fn new(\u0026self, reason_code: u8) -\u003e Result\u003cReasonCode, Error\u003e {\n        match reason_code {\n            SUCCESS_HEX =\u003e Ok(ReasonCode::Success { reason_code }),\n            NO_MATCHING_SUBSCRIBERS_HEX =\u003e Ok(ReasonCode::NoMatchingSubscribers { reason_code }),\n            UNSPECIFIED_ERROR_HEX =\u003e Ok(ReasonCode::UnspecifiedError { reason_code }),\n            IMPLEMENTATION_SPECIFIC_ERROR_HEX =\u003e {\n                Ok(ReasonCode::ImplementationSpecificError { reason_code })\n            }\n            NOT_AUTHORIZED_HEX =\u003e Ok(ReasonCode::NotAuthorized { reason_code }),\n            TOPIC_NAME_INVALID_HEX =\u003e Ok(ReasonCode::TopicNameInvalid { reason_code }),\n            PACKET_ID_IN_USE_HEX =\u003e Ok(ReasonCode::PacketIdentifierInUse { reason_code }),\n            QUOTA_EXCEEDED_HEX =\u003e Ok(ReasonCode::QuotaExceeded { reason_code }),\n            PAYLOAD_FORMAT_INVALID_HEX =\u003e Ok(ReasonCode::PayloadFormatInvalid { reason_code }),\n            SUB_ID_DUP_HEX =\u003e Ok(ReasonCode::SubIdDup { reason_code }),\n            _ =\u003e Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Reason code inv√°lido\",\n            )),\n        }\n    }\n}\n","traces":[{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":15},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","run_broker.rs"],"content":"use std::env::args;\n\nuse rustic_city_eye::mqtt::{broker::Broker, protocol_error::ProtocolError};\n\nfn main() -\u003e Result\u003c(), ProtocolError\u003e {\n    let argv = args().collect::\u003cVec\u003cString\u003e\u003e();\n    let mut broker = Broker::new(argv)?;\n    let _ = broker.server_run();\n    Ok(())\n}\n","traces":[{"line":5,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":6,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":7,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":3},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","subscribe_config.rs"],"content":"use crate::mqtt::subscribe_properties::SubscribeProperties;\n\nuse super::{client_message::ClientMessage, messages_config::MessagesConfig};\n\npub struct SubscribeConfig {\n    pub(crate) topic_name: String,\n    pub(crate) properties: SubscribeProperties,\n}\n\nimpl MessagesConfig for SubscribeConfig {\n    fn parse_message(\u0026self, packet_id: u16) -\u003e ClientMessage {\n        ClientMessage::Subscribe {\n            packet_id,\n            topic_name: self.topic_name.clone(),\n            properties: self.properties.clone(),\n        }\n    }\n}\n\nimpl SubscribeConfig {\n    pub fn new(topic_name: String, properties: SubscribeProperties) -\u003e SubscribeConfig {\n        SubscribeConfig {\n            topic_name,\n            properties,\n        }\n    }\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":4},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","subscribe_properties.rs"],"content":"use crate::utils::{reader::*, writer::*};\nuse std::io::{Error, Read, Write};\n\n#[derive(Debug, PartialEq, Clone)]\npub struct SubscribeProperties {\n    pub sub_id: u8,\n    user_properties: Vec\u003c(String, String)\u003e,\n    payload: Vec\u003cu8\u003e,\n}\n\nimpl SubscribeProperties {\n    pub fn new(\n        sub_id: u8,\n        user_properties: Vec\u003c(String, String)\u003e,\n        payload: Vec\u003cu8\u003e,\n    ) -\u003e SubscribeProperties {\n        SubscribeProperties {\n            sub_id,\n            user_properties,\n            payload,\n        }\n    }\n\n    pub fn write_properties(\u0026self, stream: \u0026mut dyn Write) -\u003e Result\u003c(), Error\u003e {\n        write_u8(stream, \u0026self.sub_id)?;\n        write_string_pairs(stream, \u0026self.user_properties)?;\n        write_bin_vec(stream, \u0026self.payload)?;\n        Ok(())\n    }\n\n    pub fn read_properties(stream: \u0026mut dyn Read) -\u003e Result\u003cSubscribeProperties, Error\u003e {\n        let sub_id = read_u8(stream)?;\n        let user_properties = read_string_pairs(stream)?;\n        let payload = read_bin_vec(stream)?;\n        Ok(SubscribeProperties::new(sub_id, user_properties, payload))\n    }\n}\n","traces":[{"line":12,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":7},"fn_name":null}],"covered":11,"coverable":11},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","topic.rs"],"content":"use std::collections::HashMap;\nuse std::fmt::Debug;\nuse std::io::Error;\nuse std::net::TcpStream;\nuse std::sync::{Arc, RwLock};\n\nuse crate::mqtt::broker_message::BrokerMessage;\n\nuse super::client_message::ClientMessage;\n\nuse super::reason_code;\n\n#[derive(Debug, Clone)]\npub struct Topic {\n    /// Hashmap de subscriptores.\n    /// El u32 representa el sub_id, y el valor es el stream del subscriptor.\n    subscribers: Arc\u003cRwLock\u003cHashMap\u003cu8, TcpStream\u003e\u003e\u003e,\n}\n\nimpl Default for Topic {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Topic {\n    pub fn new() -\u003e Self {\n        Self {\n            subscribers: Arc::new(RwLock::new(HashMap::new())),\n        }\n    }\n\n    pub fn add_subscriber(\u0026mut self, stream: TcpStream, sub_id: u8) -\u003e u8 {\n        //verificar si el sub_id ya existe en topic subscribers\n        if self.subscribers.read().unwrap().contains_key(\u0026sub_id) {\n            return reason_code::SUB_ID_DUP_HEX;\n        }\n\n        let mut lock = match self.subscribers.write() {\n            Ok(guard) =\u003e guard,\n            Err(_) =\u003e return reason_code::UNSPECIFIED_ERROR_HEX,\n        };\n\n        lock.insert(sub_id, stream);\n        reason_code::SUCCESS_HEX\n    }\n\n    pub fn remove_subscriber(\u0026mut self, sub_id: u8) -\u003e u8 {\n        let mut lock = match self.subscribers.write() {\n            Ok(guard) =\u003e guard,\n            Err(_) =\u003e return reason_code::UNSPECIFIED_ERROR_HEX,\n        };\n\n        if !lock.contains_key(\u0026sub_id) {\n            println!(\"No se encontr√≥ el sub_id en los subscribers\");\n            return reason_code::NO_MATCHING_SUBSCRIBERS_HEX;\n        }\n\n        lock.remove(\u0026sub_id);\n        reason_code::SUCCESS_HEX\n    }\n\n    pub fn deliver_message(\u0026self, message: ClientMessage) -\u003e Result\u003cu8, Error\u003e {\n        let lock = self.subscribers.read().unwrap();\n        let mut puback_reason_code: u8 = 0x00;\n        match message {\n            ClientMessage::Publish {\n                topic_name,\n                payload,\n                packet_id,\n                qos,\n                retain_flag,\n                dup_flag,\n                properties,\n            } =\u003e {\n                let delivery_message = BrokerMessage::PublishDelivery {\n                    topic_name,\n                    payload,\n                    packet_id,\n                    qos,\n                    retain_flag,\n                    dup_flag,\n                    properties,\n                };\n\n                if lock.is_empty() {\n                    puback_reason_code = 0x10_u8;\n                    return Ok(puback_reason_code);\n                }\n\n                for mut subscriber in lock.iter() {\n                    println!(\"Enviando un PublishDelivery\");\n                    match delivery_message.write_to(\u0026mut subscriber.1) {\n                        Ok(_) =\u003e println!(\"PublishDelivery enviado\"),\n                        Err(err) =\u003e println!(\"Error al enviar PublishDelivery: {:?}\", err),\n                    }\n                }\n            }\n            _ =\u003e {\n                return Ok(0x10);\n            }\n        };\n        Ok(puback_reason_code)\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_01_topic_creation_ok() -\u003e std::io::Result\u003c()\u003e {\n        let _ = Topic::new();\n\n        Ok(())\n    }\n\n    // #[test]\n    // fn test_02_adding_sub_ok() -\u003e std::io::Result\u003c()\u003e {\n    //     let mut topic = Topic::new();\n\n    //     let (tx, _rx) = mpsc::channel();\n    //     topic.add_subscriber(tx);\n\n    //     Ok(())\n    // }\n\n    // #[test]\n    // fn test_03_adding_sub_and_sending_message_ok() {\n    //     let mut topic = Topic::new();\n    //     let (tx, rx) = mpsc::channel();\n    //     topic.add_subscriber(tx);\n\n    //     let _ = topic.send_message(\"holaholahola\");\n\n    //     let message_received = rx.recv().unwrap();\n\n    //     assert_eq!(message_received, \"holaholahola\".to_string());\n    // }\n\n    // #[test]\n    // fn test_04_adding_multiple_subs_and_sending_message_ok() {\n    //     let mut topic = Topic::new();\n    //     let (tx1, rx1) = mpsc::channel();\n    //     let (tx2, rx2) = mpsc::channel();\n    //     let (tx3, rx3) = mpsc::channel();\n\n    //     topic.add_subscriber(tx1);\n    //     topic.add_subscriber(tx2);\n    //     topic.add_subscriber(tx3);\n\n    //     let _ = topic.send_message(\"holaholahola\");\n\n    //     let message_received1 = rx1.recv().unwrap();\n    //     let message_received2 = rx2.recv().unwrap();\n    //     let message_received3 = rx3.recv().unwrap();\n\n    //     assert_eq!(message_received1, \"holaholahola\".to_string());\n    //     assert_eq!(message_received2, \"holaholahola\".to_string());\n    //     assert_eq!(message_received3, \"holaholahola\".to_string());\n    // }\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":2,"coverable":41},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","will_properties.rs"],"content":"use std::io::BufWriter;\nuse std::io::Error;\nuse std::io::Read;\nuse std::io::Write;\n\nuse crate::utils::{reader::*, writer::*};\n\nconst WILL_DELAY_INTERVAL_ID: u8 = 0x18;\nconst PAYLOAD_FORMAT_INDICATOR_ID: u8 = 0x01;\nconst MESSAGE_EXPIRY_INTERVAL_ID: u8 = 0x02;\nconst CONTENT_TYPE_ID: u8 = 0x03;\nconst RESPONSE_TOPIC_ID: u8 = 0x08;\nconst CORRELATION_DATA_ID: u8 = 0x09;\nconst USER_PROPERTIES_ID: u8 = 0x26;\n\n#[derive(Debug, PartialEq, Clone)]\n/// last_will_delay_interval especifica el tiempo en segundos que el broker debe esperar antes de publicar el will message.\n///\n/// payload_format_indicator indica si el payload esta encodado en utf-8 o no.\n/// message_expiry_interval especifica el tiempo en segundos que el broker debe esperar antes de descartar el will message.\n/// content_type especifica el tipo de contenido del will message. (ej json, plain text)\n/// el response_topic es el el topic name que debera usar el mensaje de respuesta. Si hay response_topic, el will message se considera un request message.\n///\n/// `The Correlation Data is used by the sender of the Request Message to identify which request the Response Message is for when it is received`\n///\n/// user_property especifica una propiedad del usuario que se envia en el mensaje, se pueden enviar 0, 1 o m√°s propiedades.\npub struct WillProperties {\n    last_will_delay_interval: u32,\n    payload_format_indicator: u8,\n    message_expiry_interval: u16,\n    content_type: String,\n    response_topic: String,\n    correlation_data: Vec\u003cu8\u003e,\n    user_properties: Vec\u003c(String, String)\u003e,\n}\n\nimpl WillProperties {\n    pub fn new(\n        last_will_delay_interval: u32,\n        payload_format_indicator: u8,\n        message_expiry_interval: u16,\n        content_type: String,\n        response_topic: String,\n        correlation_data: Vec\u003cu8\u003e,\n        user_properties: Vec\u003c(String, String)\u003e,\n    ) -\u003e WillProperties {\n        WillProperties {\n            last_will_delay_interval,\n            payload_format_indicator,\n            message_expiry_interval,\n            content_type,\n            response_topic,\n            correlation_data,\n            user_properties,\n        }\n    }\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e Result\u003c(), Error\u003e {\n        let mut writer = BufWriter::new(stream);\n        //will properties\n        write_u8(\u0026mut writer, \u0026WILL_DELAY_INTERVAL_ID)?;\n\n        write_u32(\u0026mut writer, \u0026self.last_will_delay_interval)?;\n\n        let payload_format_indicator = 0x01_u8;\n        //siempre 1 porque los strings en rust siempre son utf-8\n        write_u8(\u0026mut writer, \u0026PAYLOAD_FORMAT_INDICATOR_ID)?;\n        write_u8(\u0026mut writer, \u0026payload_format_indicator)?;\n\n        write_u8(\u0026mut writer, \u0026MESSAGE_EXPIRY_INTERVAL_ID)?;\n\n        write_u16(\u0026mut writer, \u0026self.message_expiry_interval)?;\n\n        write_u8(\u0026mut writer, \u0026CONTENT_TYPE_ID)?;\n        write_string(\u0026mut writer, \u0026self.content_type)?;\n\n        write_u8(\u0026mut writer, \u0026RESPONSE_TOPIC_ID)?;\n        write_string(\u0026mut writer, \u0026self.response_topic)?;\n\n        write_u8(\u0026mut writer, \u0026CORRELATION_DATA_ID)?;\n        let correlation_data_length = self.correlation_data.len() as u16;\n        write_u16(\u0026mut writer, \u0026correlation_data_length)?;\n        for byte in \u0026self.correlation_data {\n            write_u8(\u0026mut writer, byte)?;\n        }\n        //user property\n\n        write_u8(\u0026mut writer, \u0026USER_PROPERTIES_ID)?;\n        let user_properties_length = self.user_properties.len() as u16;\n        write_u16(\u0026mut writer, \u0026user_properties_length)?;\n        for (key, value) in \u0026self.user_properties {\n            write_string(\u0026mut writer, key)?;\n            write_string(\u0026mut writer, value)?;\n        }\n\n        Ok(())\n    }\n\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cWillProperties, Error\u003e {\n        //will properties\n        let will_delay_interval_id = read_u8(stream)?;\n        if will_delay_interval_id != WILL_DELAY_INTERVAL_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid will delay interval id\",\n            ));\n        }\n        let will_delay_interval = read_u32(stream)?;\n\n        let payload_format_indicator_id = read_u8(stream)?;\n        if payload_format_indicator_id != PAYLOAD_FORMAT_INDICATOR_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid payload format indicator id\",\n            ));\n        }\n        let payload_format_indicator = read_u8(stream)?;\n\n        let message_expiry_interval_id = read_u8(stream)?;\n        if message_expiry_interval_id != MESSAGE_EXPIRY_INTERVAL_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid message expiry interval id\",\n            ));\n        }\n        let message_expiry_interval = read_u16(stream)?;\n        let content_type_id = read_u8(stream)?;\n        if content_type_id != CONTENT_TYPE_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid content type id\",\n            ));\n        }\n        let content_type = read_string(stream)?;\n\n        let response_topic_id = read_u8(stream)?;\n        if response_topic_id != RESPONSE_TOPIC_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid response topic id\",\n            ));\n        }\n        let response_topic = read_string(stream)?;\n\n        let correlation_data_id = read_u8(stream)?;\n        if correlation_data_id != CORRELATION_DATA_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid correlation data id\",\n            ));\n        }\n        let correlation_data_length = read_u16(stream)?;\n        let mut correlation_data = vec![0; correlation_data_length as usize];\n        stream.read_exact(\u0026mut correlation_data)?;\n\n        //user property\n        let user_properties_id = read_u8(stream)?;\n        if user_properties_id != USER_PROPERTIES_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid user properties id\",\n            ));\n        }\n        let mut user_properties = Vec::new();\n        let user_properties_lenght = read_u16(stream)?;\n        for _ in 0..user_properties_lenght {\n            let user_properties_key = read_string(stream)?;\n            let user_properties_value = read_string(stream)?;\n            user_properties.push((user_properties_key, user_properties_value));\n        }\n\n        Ok(WillProperties {\n            last_will_delay_interval: will_delay_interval,\n            payload_format_indicator,\n            message_expiry_interval,\n            content_type,\n            response_topic,\n            correlation_data,\n            user_properties,\n        })\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_01_will_properties_ok() {\n        let will_properties = WillProperties::new(\n            120,\n            1,\n            30,\n            \"plain\".to_string(),\n            \"topic\".to_string(),\n            vec![1, 2, 3, 4, 5],\n            vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        );\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match will_properties.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e (),\n            Err(err) =\u003e panic!(\"Error writing will properties: {:?}\", err),\n        };\n        cursor.set_position(0);\n\n        let read_will_properties = match WillProperties::read_from(\u0026mut cursor) {\n            Ok(properties) =\u003e properties,\n            Err(err) =\u003e panic!(\"Error reading will properties: {:?}\", err),\n        };\n\n        assert_eq!(will_properties, read_will_properties);\n    }\n}\n","traces":[{"line":38,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":89},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":25},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":9},"fn_name":null}],"covered":50,"coverable":74},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","camera.rs"],"content":"use crate::surveilling::location::Location;\n\n#[derive(Debug, Clone)]\n#[allow(dead_code)]\npub struct Camera {\n    location: Location,\n}\n\nimpl Camera {\n    pub fn new(location: Location) -\u003e Camera {\n        Self { location }\n    }\n\n    pub fn get_location(\u0026self) -\u003e Location {\n        self.location.clone()\n    }\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":3},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","camera_system.rs"],"content":"use std::sync::mpsc::{self, Sender};\n\nuse crate::{\n    mqtt::{\n        client::Client, connect_config::ConnectConfig, connect_properties,\n        messages_config::MessagesConfig, protocol_error::ProtocolError,\n        subscribe_config::SubscribeConfig, subscribe_properties::SubscribeProperties,\n        will_properties,\n    },\n    surveilling::{camera::Camera, location::Location},\n};\n#[derive(Debug)]\n#[allow(dead_code)]\npub struct CameraSystem {\n    send_to_client_channel: Sender\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e,\n    camera_system_client: Client,\n    cameras: Vec\u003cCamera\u003e,\n}\n\nimpl CameraSystem {\n    pub fn new(args: Vec\u003cString\u003e) -\u003e Result\u003cCameraSystem, ProtocolError\u003e {\n        let address = args[0].clone() + \":\" + \u0026args[1];\n        let will_properties = will_properties::WillProperties::new(\n            1,\n            1,\n            1,\n            \"a\".to_string(),\n            \"a\".to_string(),\n            [1, 2, 3].to_vec(),\n            vec![(\"a\".to_string(), \"a\".to_string())],\n        );\n\n        let connect_properties = connect_properties::ConnectProperties::new(\n            30,\n            1,\n            20,\n            20,\n            true,\n            true,\n            vec![(\"hola\".to_string(), \"chau\".to_string())],\n            \"auth\".to_string(),\n            vec![1, 2, 3],\n        );\n\n        let connect_config = ConnectConfig::new(\n            true,\n            true,\n            1,\n            true,\n            35,\n            connect_properties,\n            \"juancito\".to_string(),\n            will_properties,\n            \"camera system\".to_string(),\n            \"soy el monitoring y me desconecte\".to_string(),\n            args[2].clone(),\n            args[3].clone(),\n        );\n\n        let (tx, rx) = mpsc::channel();\n\n        let camera_system_client = match Client::new(rx, address, connect_config) {\n            Ok(client) =\u003e client,\n            Err(err) =\u003e return Err(err),\n        };\n\n        let subscribe_config = SubscribeConfig::new(\n            \"incidente\".to_string(),\n            SubscribeProperties::new(\n                0,\n                vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n                vec![0, 1, 2, 3],\n            ),\n        );\n\n        let _ = tx.send(Box::new(subscribe_config));\n\n        Ok(CameraSystem {\n            send_to_client_channel: tx,\n            camera_system_client,\n            cameras: Vec::new(),\n        })\n    }\n\n    pub fn add_camera(\u0026mut self, location: Location) {\n        let camera = Camera::new(location);\n        self.cameras.push(camera);\n    }\n\n    pub fn get_cameras(\u0026self) -\u003e \u0026Vec\u003cCamera\u003e {\n        \u0026self.cameras\n    }\n\n    pub fn run_client(\u0026mut self) -\u003e Result\u003c(), ProtocolError\u003e {\n        self.camera_system_client.client_run()?;\n        Ok(())\n    }\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":27},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","location.rs"],"content":"#[derive(Debug, Clone)]\n#[allow(dead_code)]\npub struct Location {\n    pub longitude: f64,\n    pub latitude: f64,\n}\n\nimpl Location {\n    pub fn new(lat: String, long: String) -\u003e Location {\n        let latitude = lat.parse::\u003cf64\u003e().unwrap();\n        let longitude = long.parse::\u003cf64\u003e().unwrap();\n\n        Location {\n            longitude,\n            latitude,\n        }\n    }\n\n    pub fn parse_to_string(\u0026self) -\u003e String {\n        format!(\"({}, {})\", self.latitude, self.longitude)\n    }\n}\n","traces":[{"line":9,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":10,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","mod.rs"],"content":"pub mod camera;\n\npub mod camera_system;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","run_camera_system.rs"],"content":"use std::{\n    env::args,\n    io::{stdin, Read},\n};\n\nuse rustic_city_eye::{\n    mqtt::protocol_error::ProtocolError, surveilling::camera_system::CameraSystem,\n};\n\nfn main() -\u003e Result\u003c(), ProtocolError\u003e {\n    let argv = args().collect::\u003cVec\u003cString\u003e\u003e();\n\n    let mut _camera_system = CameraSystem::new(argv)?;\n    let _stream: Box\u003cdyn Read + Send\u003e = Box::new(stdin());\n\n    // let _ = camera_system.app_run(stream);\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","utils","mod.rs"],"content":"pub mod reader;\npub mod threadpool;\npub mod writer;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","utils","reader.rs"],"content":"use std::io::{Error, Read};\n\npub fn read_string(stream: \u0026mut dyn Read) -\u003e Result\u003cString, Error\u003e {\n    let string_length = read_u16(stream)?;\n    let mut string_buf = vec![0; string_length as usize];\n    stream.read_exact(\u0026mut string_buf)?;\n\n    let protocol_name = std::str::from_utf8(\u0026string_buf).expect(\"Error al leer protocol_name\");\n    Ok(protocol_name.to_string())\n}\n\npub fn read_u8(stream: \u0026mut dyn Read) -\u003e Result\u003cu8, Error\u003e {\n    let mut buf = [0u8; 1];\n    stream.read_exact(\u0026mut buf)?;\n    Ok(u8::from_be_bytes(buf))\n}\n\npub fn read_u16(stream: \u0026mut dyn Read) -\u003e Result\u003cu16, Error\u003e {\n    let mut buf = [0u8; 2];\n    stream.read_exact(\u0026mut buf)?;\n    Ok(u16::from_be_bytes(buf))\n}\n\npub fn read_u32(stream: \u0026mut dyn Read) -\u003e Result\u003cu32, Error\u003e {\n    let mut buf = [0u8; 4];\n    stream.read_exact(\u0026mut buf)?;\n    Ok(u32::from_be_bytes(buf))\n}\n\npub fn read_string_pairs(stream: \u0026mut dyn Read) -\u003e Result\u003cVec\u003c(String, String)\u003e, Error\u003e {\n    let length = read_u16(stream)?;\n    let mut pairs = Vec::new();\n    for _ in 0..length {\n        let key = read_string(stream)?;\n        let value = read_string(stream)?;\n        pairs.push((key, value));\n    }\n    Ok(pairs)\n}\n\npub fn read_bin_vec(reader: \u0026mut dyn Read) -\u003e Result\u003cVec\u003cu8\u003e, Error\u003e {\n    let length = read_u16(reader)?;\n    let mut buffer = vec![0; length as usize];\n    reader.read_exact(\u0026mut buffer)?;\n    Ok(buffer)\n}\n\npub fn read_tuple_vec(reader: \u0026mut dyn Read) -\u003e Result\u003cVec\u003c(String, String)\u003e, Error\u003e {\n    let length = read_u16(reader)?;\n    let mut vec = Vec::with_capacity(length as usize);\n    for _ in 0..length {\n        let key = read_string(reader)?;\n        let value = read_string(reader)?;\n        vec.push((key, value));\n    }\n    Ok(vec)\n}\npub fn read_bool(stream: \u0026mut dyn Read) -\u003e Result\u003cbool, Error\u003e {\n    let mut buf = [0u8; 1];\n    stream.read_exact(\u0026mut buf)?;\n    Ok(buf[0] != 0)\n}\n","traces":[{"line":3,"address":[],"length":0,"stats":{"Line":171},"fn_name":null},{"line":4,"address":[],"length":0,"stats":{"Line":342},"fn_name":null},{"line":6,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":8,"address":[],"length":0,"stats":{"Line":171},"fn_name":null},{"line":9,"address":[],"length":0,"stats":{"Line":171},"fn_name":null},{"line":12,"address":[],"length":0,"stats":{"Line":240},"fn_name":null},{"line":13,"address":[],"length":0,"stats":{"Line":240},"fn_name":null},{"line":14,"address":[],"length":0,"stats":{"Line":240},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":240},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":281},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":281},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":281},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":281},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":22},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":22},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":42},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":32},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":18},"fn_name":null}],"covered":33,"coverable":35},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","utils","threadpool.rs"],"content":"use std::{\n    sync::{\n        mpsc::{self, channel, Receiver},\n        Arc, Mutex,\n    },\n    thread,\n};\n/// El codigo que estan por ver es un poco falopa, pasa que tiene que ser una interfaz muy generalista\n/// Los workers tienen un thread y un ID, se crean segun el valor que se le pase por parametro al constructor.\n/// Si se ejecuta new(4), se crearan 4 workers.\n/// el sender es el encargado de recibir el nuevo job a ejecutar.\npub struct ThreadPool {\n    workers: Vec\u003cWorker\u003e,\n    sender: mpsc::Sender\u003cJob\u003e,\n}\nstruct Worker {\n    id: usize,\n    thread: thread::JoinHandle\u003c()\u003e,\n}\n\nimpl Worker {\n    fn new(id: usize, receiver: Arc\u003cMutex\u003cmpsc::Receiver\u003cJob\u003e\u003e\u003e) -\u003e Worker {\n        let thread = thread::spawn(move || loop {\n            let job = receiver.lock().unwrap().recv().unwrap();\n\n            job();\n        });\n\n        Worker { id, thread }\n    }\n}\n\ntype Job = Box\u003cdyn FnOnce() + Send + 'static\u003e;\n\nimpl ThreadPool {\n    pub fn new(size: usize) -\u003e ThreadPool {\n        assert!(size \u003e 0);\n\n        let (sender, receiver) = mpsc::channel();\n\n        let receiver = Arc::new(Mutex::new(receiver));\n\n        let mut workers = Vec::with_capacity(size);\n\n        for id in 0..size {\n            workers.push(Worker::new(id, Arc::clone(\u0026receiver)));\n        }\n\n        ThreadPool { workers, sender }\n    }\n\n    /// Esta funcion recibe una funncion F y devuelve un reciever con el resultado de la misma.\n    /// el channel creado internamente es para ejecutar la funcion F y luego retornar el resultado de su ejecuci√≥n\n    /// Se le pide entonces al job que ejecute F y mande su resultado por el channel.\n    /// Luego se le pasa ese job a un worker disponible mediante el self.sender.\n    /// Es en ese momento que la funcion F se ejecuta.\n    pub fn execute\u003cF, R\u003e(\u0026self, f: F) -\u003e Receiver\u003cR\u003e\n    where\n        F: FnOnce() -\u003e R + Send + 'static,\n        R: Send + 'static,\n    {\n        let (tx, rx) = channel();\n        let senderr = self.sender.clone();\n\n        let job = Box::new(move || {\n            let result = f();\n            if let Err(err) = tx.send(result) {\n                println!(\"Failed to send result: {:?}\", err);\n            }\n        });\n\n        if let Err(err) = senderr.send(job) {\n            println!(\"Failed to send job: {:?}\", err);\n        }\n\n        rx\n    }\n}\n","traces":[{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":21},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","utils","writer.rs"],"content":"use std::io::{Error, Write};\n\n// enum Type {\n//     String,\n//     U16,\n//     U32,\n//     Vec,\n//     Bool,\n//     StringTuple,\n// }\n\n///Recibe un string y el stream al que escribir ese stream\n///\n/// Calcula su largo y luego escribe el largo y el string en el stream\npub fn write_string(stream: \u0026mut dyn Write, string: \u0026str) -\u003e Result\u003c(), Error\u003e {\n    let length = string.len() as u16;\n    let length_bytes = length.to_be_bytes();\n    stream.write_all(\u0026length_bytes)?;\n    stream.write_all(string.as_bytes())?;\n    Ok(())\n}\n\npub fn write_tuple_vec(stream: \u0026mut dyn Write, vec: \u0026Vec\u003c(String, String)\u003e) -\u003e Result\u003c(), Error\u003e {\n    let length = vec.len() as u16;\n    let length_bytes = length.to_be_bytes();\n    stream.write_all(\u0026length_bytes)?;\n    for item in vec {\n        write_string_tuple(stream, item)?;\n    }\n    Ok(())\n}\n\n// pub fn write_vec\u003cT\u003e(stream: \u0026mut dyn Write, vec: \u0026Vec\u003cT\u003e, data_type: Type) -\u003e Result\u003c(), Error\u003e {\n//     match data_type {\n//         Type::String =\u003e {\n//             for item in vec {\n//                 write_string(stream, \u0026item.to_string())?;\n//             }\n//         },\n\n//         Type::U16 =\u003e {},\n//         Type::U32 =\u003e todo!(),\n//         Type::Vec =\u003e todo!(),\n//         Type::Bool =\u003e todo!(),\n//         Type::StringTuple =\u003e todo!(),\n//     }\n\n//     Ok(())\n// }\n\npub fn write_bin_vec(stream: \u0026mut dyn Write, vec: \u0026Vec\u003cu8\u003e) -\u003e Result\u003c(), Error\u003e {\n    let length = vec.len() as u16;\n    let length_bytes = length.to_be_bytes();\n    stream.write_all(\u0026length_bytes)?;\n    for byte in vec {\n        stream.write_all(\u0026[*byte])?;\n    }\n    Ok(())\n}\n\npub fn write_string_tuple(stream: \u0026mut dyn Write, value: \u0026(String, String)) -\u003e Result\u003c(), Error\u003e {\n    write_string(stream, \u0026value.0)?;\n    write_string(stream, \u0026value.1)?;\n    Ok(())\n}\n\npub fn write_u8(stream: \u0026mut dyn Write, value: \u0026u8) -\u003e Result\u003c(), Error\u003e {\n    stream.write_all(\u0026[*value])?;\n    Ok(())\n}\n\npub fn write_u16(stream: \u0026mut dyn Write, value: \u0026u16) -\u003e Result\u003c(), Error\u003e {\n    let value_bytes = value.to_be_bytes();\n    stream.write_all(\u0026value_bytes)?;\n    Ok(())\n}\n\npub fn write_u32(stream: \u0026mut dyn Write, value: \u0026u32) -\u003e Result\u003c(), Error\u003e {\n    let value_bytes = value.to_be_bytes();\n    stream.write_all(\u0026value_bytes)?;\n    Ok(())\n}\n\npub fn write_bool(stream: \u0026mut dyn Write, value: \u0026bool) -\u003e Result\u003c(), Error\u003e {\n    let value_bytes = if *value { 1u8 } else { 0u8 };\n    stream.write_all(\u0026[value_bytes])?;\n    Ok(())\n}\n\npub fn write_string_pairs(\n    stream: \u0026mut dyn Write,\n    vec: \u0026Vec\u003c(String, String)\u003e,\n) -\u003e Result\u003c(), Error\u003e {\n    let length = vec.len() as u16;\n    let length_bytes = length.to_be_bytes();\n    stream.write_all(\u0026length_bytes)?;\n    for pair in vec {\n        write_string(stream, \u0026pair.0)?;\n        write_string(stream, \u0026pair.1)?;\n    }\n    Ok(())\n}\n","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":16,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":17,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":187},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":232},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":232},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":232},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":69},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":69},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":69},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":69},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":44},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":44},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":44},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":44},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":54},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":36},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":14},"fn_name":null}],"covered":43,"coverable":47},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","tests","broker_tests.rs"],"content":"#[cfg(test)]\nmod tests {\n    use rustic_city_eye::mqtt::connect_properties::ConnectProperties;\n    use rustic_city_eye::mqtt::publish_properties::{PublishProperties, TopicProperties};\n    use rustic_city_eye::mqtt::subscribe_properties::SubscribeProperties;\n    use rustic_city_eye::mqtt::will_properties::WillProperties;\n    use rustic_city_eye::mqtt::{\n        broker::handle_messages, broker::Broker, client_message::ClientMessage,\n        protocol_error::ProtocolError, protocol_return::ProtocolReturn,\n    };\n\n    use std::collections::HashMap;\n    use std::io::Write;\n    use std::net::{TcpListener, TcpStream};\n    use std::sync::{Arc, RwLock};\n    use std::thread;\n\n    #[test]\n    fn test_mensaje_invalido_da_error() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n\n            stream.write_all(\u0026\"Hola\".as_bytes()).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert!(result.is_err());\n    }\n    #[test]\n    fn test_connect() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        let connect_propierties = ConnectProperties {\n            session_expiry_interval: 1,\n            receive_maximum: 2,\n            maximum_packet_size: 10,\n            topic_alias_maximum: 99,\n            request_response_information: true,\n            request_problem_information: false,\n            user_properties: vec![\n                (\"Hola\".to_string(), \"Mundo\".to_string()),\n                (\"Chau\".to_string(), \"Mundo\".to_string()),\n            ],\n            authentication_method: \"test\".to_string(),\n            authentication_data: vec![1_u8, 2_u8, 3_u8, 4_u8, 5_u8],\n        };\n        let will_properties = WillProperties::new(\n            120,\n            1,\n            30,\n            \"plain\".to_string(),\n            \"topic\".to_string(),\n            vec![1, 2, 3, 4, 5],\n            vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        );\n        let connect = ClientMessage::Connect {\n            clean_start: true,\n            last_will_flag: true,\n            last_will_qos: 1,\n            last_will_retain: true,\n            keep_alive: 35,\n            properties: connect_propierties,\n            client_id: \"kvtr33\".to_string(),\n            will_properties,\n            last_will_topic: \"topic\".to_string(),\n            last_will_message: \"chauchis\".to_string(),\n            username: \"prueba\".to_string(),\n            password: \"\".to_string(),\n        };\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            connect.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::ConnackSent);\n    }\n    #[test]\n    fn test_envio_connect_con_id_repetido_y_desconecta() {\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        let connect_propierties = ConnectProperties {\n            session_expiry_interval: 1,\n            receive_maximum: 2,\n            maximum_packet_size: 10,\n            topic_alias_maximum: 99,\n            request_response_information: true,\n            request_problem_information: false,\n            user_properties: vec![\n                (\"Hola\".to_string(), \"Mundo\".to_string()),\n                (\"Chau\".to_string(), \"Mundo\".to_string()),\n            ],\n            authentication_method: \"test\".to_string(),\n            authentication_data: vec![1_u8, 2_u8, 3_u8, 4_u8, 5_u8],\n        };\n        let will_properties = WillProperties::new(\n            120,\n            1,\n            30,\n            \"plain\".to_string(),\n            \"topic\".to_string(),\n            vec![1, 2, 3, 4, 5],\n            vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        );\n        let connect = ClientMessage::Connect {\n            clean_start: true,\n            last_will_flag: true,\n            last_will_qos: 1,\n            last_will_retain: true,\n            keep_alive: 35,\n            properties: connect_propierties,\n            client_id: \"kvtr33\".to_string(),\n            will_properties,\n            last_will_topic: \"topic\".to_string(),\n            last_will_message: \"chauchis\".to_string(),\n            username: \"prueba\".to_string(),\n            password: \"\".to_string(),\n        };\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            connect.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![\"kvtr33\".to_string()]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(\n                stream,\n                topics.clone(),\n                packets.clone(),\n                subs.clone(),\n                clients_ids.clone(),\n            );\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::DisconnectSent);\n    }\n\n    #[test]\n    fn test_subscribe() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let sub = ClientMessage::Subscribe {\n            packet_id: 1,\n            topic_name: \"topico\".to_string(),\n            properties: SubscribeProperties::new(\n                1,\n                vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n                vec![0, 1, 2, 3],\n            ),\n        };\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            sub.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::SubackSent);\n    }\n    #[test]\n    fn test_publish() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let properties = PublishProperties::new(\n            1,\n            10,\n            topic_properties,\n            [1, 2, 3].to_vec(),\n            \"a\".to_string(),\n            1,\n            \"a\".to_string(),\n        );\n\n        let publish = ClientMessage::Publish {\n            packet_id: 1,\n            topic_name: \"mensajes para juan\".to_string(),\n            qos: 1,\n            retain_flag: 1,\n            payload: \"hola soy juan\".to_string(),\n            dup_flag: 1,\n            properties,\n        };\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            publish.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::PubackSent);\n    }\n\n    #[test]\n    fn test_unsubcribe() {\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        let unsub = ClientMessage::Unsubscribe {\n            packet_id: 1,\n            topic_name: \"topico\".to_string(),\n            properties: SubscribeProperties::new(\n                1,\n                vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n                vec![0, 1, 2, 3],\n            ),\n        };\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            unsub.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::UnsubackSent);\n    }\n\n    #[test]\n    fn test_disconnect() {\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n        let disconnect = ClientMessage::Disconnect {\n            reason_code: 1,\n            session_expiry_interval: 1,\n            reason_string: \"pasaron_cosas\".to_string(),\n            user_properties: vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        };\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            disconnect.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::DisconnectRecieved);\n    }\n\n    #[test]\n    fn test_pingreq() {\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        let pingreq = ClientMessage::Pingreq;\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            pingreq.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::PingrespSent);\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","tests","sub_and_publish.rs"],"content":"// use rustic_city_eye::mqtt::{\n//     broker::Broker, client_message, subscribe_properties::SubscribeProperties,\n// };\n// use std::io::Cursor;\n\n// #[test]\n// fn test_sub_y_pub() -\u003e std::io::Result\u003c()\u003e {\n//     let mut broker = Broker::new(vec![]).unwrap();\n//     let mut subscribe_message = client_message::ClientMessage::Subscribe {\n//         packet_id: 1,\n//         topic_name: \"topico\".to_string(),\n//         properties: SubscribeProperties::new(\n//             1,\n//             vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n//             vec![0, 1, 2, 3],\n//         ),\n//     };\n\n//     let mut stream1 = Cursor::new(Vec::new());\n//     let mut stream2 = Cursor::new(Vec::new());\n\n//     subscribe_message.write_to(\u0026mut stream1).unwrap();\n\n//     broker.handle_client(\u0026mut stream1).unwrap();\n\n//     Ok(())\n// }\n","traces":[],"covered":0,"coverable":0}]};
        var previousData = {"files":[{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","doc","mod.rs"],"content":"\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","drone_system","mod.rs"],"content":"\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","lib.rs"],"content":"pub mod doc;\npub mod drone_system;\nmod utils;\n#[doc = include_str!(\"doc/informe.md\")]\n#[doc = include_str!(\"doc/marco_teorico.md\")]\n\npub mod mqtt {\n    pub mod connect_config;\n    pub mod messages_config;\n    pub mod publish_config;\n    pub mod subscribe_config;\n\n    pub mod broker_message;\n    pub mod client;\n    pub mod client_message;\n    pub mod connect_properties;\n    pub mod protocol_error;\n    pub mod publish_properties;\n    pub mod reason_code;\n    pub mod subscribe_properties;\n    pub mod topic;\n    pub mod will_properties;\n\n    pub mod broker;\n    pub mod broker_config;\n\n    pub mod error;\n    pub mod protocol_return;\n}\n\npub mod monitoring {\n    pub mod incident;\n    pub mod monitoring_app;\n    pub mod monitoring_config;\n}\n\npub mod surveilling {\n    pub mod camera;\n    pub mod camera_system;\n    pub mod location;\n}\n\n// pub mod utils {\n//     pub mod reader;\n//     pub mod threadpool;\n//     pub mod writer;\n// }\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","monitoring","incident.rs"],"content":"use crate::surveilling::location::Location;\n\n#[derive(Debug, Clone)]\n#[allow(dead_code)]\npub struct Incident {\n    location: Location,\n}\n\nimpl Incident {\n    pub fn new(location: Location) -\u003e Incident {\n        Self { location }\n    }\n\n    pub fn parse_to_string(\u0026self) -\u003e String {\n        format!(\"Incident at {}\", self.location.parse_to_string())\n    }\n\n    pub fn from_string(incident: String) -\u003e Incident {\n        let location = incident.split(\" at \").collect::\u003cVec\u003c\u0026str\u003e\u003e()[1];\n        Incident {\n            location: Location::new(\n                location.split(\", \").collect::\u003cVec\u003c\u0026str\u003e\u003e()[0].to_string(),\n                location.split(\", \").collect::\u003cVec\u003c\u0026str\u003e\u003e()[1].to_string(),\n            ),\n        }\n    }\n\n    pub fn get_location(\u0026self) -\u003e Location {\n        self.location.clone()\n    }\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":8},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","monitoring","main.rs"],"content":"// extern crate gtk;\n\n// use gtk::glib::clone;\n// use gtk::{gdk, prelude::*};\n// use gtk::{glib, Window, WindowType};\n// use gtk::{Application, Box, Button, Entry, Label, Orientation};\n// use webkit2gtk::gio;\n// use webkit2gtk::{WebView, WebViewExt};\n\n// use std::cell::RefCell;\n// use std::rc::Rc;\n\n// use rustic_city_eye::monitoring::monitoring_app::MonitoringApp;\n// use rustic_city_eye::mqtt::protocol_error::ProtocolError;\n// use rustic_city_eye::surveilling::location::Location;\n\n// fn main() -\u003e Result\u003c(), ProtocolError\u003e {\n//     let app = Application::builder()\n//         .application_id(\"com.example.RusticCityEye\")\n//         .build();\n\n//     app.connect_activate(|app| {\n//         let home_window = Window::new(WindowType::Toplevel);\n//         home_window.set_title(\"Rustic City Eye\");\n//         home_window.set_default_size(2000, 1500);\n\n//         let vbox = Box::new(Orientation::Vertical, 5);\n\n//         let button = Button::with_label(\"Conectarse a un servidor\");\n//         vbox.pack_start(\u0026button, false, false, 0);\n\n//         let elements_container = Box::new(Orientation::Vertical, 5);\n//         vbox.pack_start(\u0026elements_container, true, true, 0);\n\n//         button.connect_clicked(clone!(@weak button, @weak elements_container =\u003e move |_| {\n//             button.hide();\n\n//             handle_connection(\u0026elements_container);\n\n//             elements_container.show_all();\n//         }));\n\n//         // Agrega la caja a la ventana.\n//         home_window.add(\u0026vbox);\n\n//         // Muestra todos los widgets en la ventana.\n//         home_window.show_all();\n\n//         // Configura la aplicaci√≥n principal.\n//         home_window.set_application(Some(app));\n//     });\n\n//     app.run();\n\n//     Ok(())\n// }\n\n// #[allow(clippy::useless_format)]\n// fn handle_connection(elements_container: \u0026gtk::Box) {\n//     let (connect_form, host, port, user, password, connect_btn) = get_connect_form();\n\n//     elements_container.pack_start(\u0026connect_form, false, false, 0);\n\n//     connect_btn.connect_clicked(clone!(@weak host, @weak port, @weak user, @weak password, @weak elements_container =\u003e move |_| {\n//         let args = vec![host.text().to_string(), port.text().to_string(), user.text().to_string(), password.text().to_string()];\n\n//         match MonitoringApp::new(args) {\n//             Ok(mut monitoring_app) =\u003e {\n//                 elements_container.foreach(|widget| {\n//                     elements_container.remove(widget);\n//                 });\n\n//                 let _ = monitoring_app.run_client();\n\n//                 // Create the horizontal box to hold the map and the panel\n//                 let hbox = Box::new(Orientation::Horizontal, 5);\n//                 elements_container.pack_start(\u0026hbox, true, true, 0);\n\n//                 let webview = WebView::new();\n//                 hbox.pack_start(\u0026webview, true, true, 0);\n\n//                 // Create the panel for camera list and buttons\n//                 let panel = Box::new(Orientation::Vertical, 5);\n//                 hbox.pack_start(\u0026panel, false, false, 0);\n\n//                 let add_camera_btn = Button::with_label(\"Add camera\");\n//                 panel.pack_start(\u0026add_camera_btn, false, false, 0);\n\n//                 let add_incident_btn = Button::with_label(\"Add incident\");\n//                 panel.pack_start(\u0026add_incident_btn, false, false, 0);\n\n//                 // Create the camera list panel\n//                 let camera_list_box = Box::new(Orientation::Vertical, 5);\n//                 panel.pack_start(\u0026camera_list_box, true, true, 0);\n\n//                 // Load Leaflet map\n//                 let html_content = format!(r#\"\n//                     \u003c!DOCTYPE html\u003e\n//                     \u003chtml\u003e\n//                     \u003chead\u003e\n//                         \u003ctitle\u003eMap\u003c/title\u003e\n//                         \u003cmeta charset=\"utf-8\" /\u003e\n//                         \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n//                         \u003clink rel=\"stylesheet\" href=\"https://unpkg.com/leaflet/dist/leaflet.css\" /\u003e\n//                         \u003cscript src=\"https://unpkg.com/leaflet/dist/leaflet.js\"\u003e\u003c/script\u003e\n//                     \u003c/head\u003e\n//                     \u003cbody\u003e\n//                         \u003cdiv id=\"map\" style=\"width: 100%; height: 100vh;\"\u003e\u003c/div\u003e\n//                         \u003cscript\u003e\n//                             var lat = -34.615077;\n//                             var lon = -58.368084;\n//                             var map = L.map('map').setView([lat, lon], 16);\n//                             L.tileLayer('https://{{s}}.tile.openstreetmap.org/{{z}}/{{x}}/{{y}}.png', {{\n//                                     attribution: '\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors'\n//                                 }}).addTo(map);\n//                                 function getLatLngFromPixel(x, y) {{\n//                                         var latlng = map.containerPointToLatLng([x, y]);\n//                                         return {{ lat: latlng.lat, lng: latlng.lng }};\n//                                     }}\n//                         \u003c/script\u003e\n//                     \u003c/body\u003e\n//                     \u003c/html\u003e\n//                 \"#);\n\n//                 webview.load_html(\u0026html_content, None);\n//                 let webview_clone = webview.clone();\n//                 let monitoring_app_ref = Rc::new(RefCell::new(monitoring_app));\n//                 let x = Rc::new(RefCell::new(0.0));\n//                 let y = Rc::new(RefCell::new(0.0));\n//                 add_camera_btn.connect_clicked(clone!(@strong y, @strong x, @strong monitoring_app_ref, @strong camera_list_box =\u003e move |_| {\n//                     on_add_camera_clicked(y.clone(), x.clone(), monitoring_app_ref.clone(), Rc::new(RefCell::new(camera_list_box.clone())));\n//                 }));\n//                 add_incident_btn.connect_clicked(clone!(@strong y, @strong x, @strong monitoring_app_ref =\u003e move |_| {\n//                     on_add_incident_clicked(y.clone(), x.clone(), monitoring_app_ref.clone());\n//                 }));\n\n//                 webview.connect_button_press_event(clone!(@strong x, @strong y, @strong monitoring_app_ref =\u003e move |_, event| {\n//                     on_webview_button_press_event(x.clone(), y.clone(), webview_clone.clone(), event).into()\n//                 }));\n\n//                 elements_container.show_all();\n\n//                 // Initial call to populate the camera list\n//                 update_camera_list(\u0026camera_list_box, \u0026monitoring_app_ref);\n//             },\n//             Err(_) =\u003e {\n//                 println!(\"Error: intenta conectarte de nuevo\");\n\n//                 handle_connection(\u0026elements_container);\n//             },\n//         }\n//     }));\n// }\n\n// fn get_connect_form() -\u003e (gtk::Box, Entry, Entry, Entry, Entry, gtk::Button) {\n//     let vbox = Box::new(Orientation::Vertical, 5);\n\n//     let label = Label::new(Some(\"Ingrese al servidor\"));\n\n//     let host = Entry::new();\n//     host.set_placeholder_text(Some(\"Host: \"));\n\n//     let port = Entry::new();\n//     port.set_placeholder_text(Some(\"Port: \"));\n\n//     let user = Entry::new();\n//     user.set_placeholder_text(Some(\"Username: \"));\n\n//     let password = Entry::new();\n//     password.set_placeholder_text(Some(\"Password: \"));\n\n//     let connect_btn = Button::with_label(\"Conectarse\");\n//     vbox.pack_start(\u0026label, false, false, 0);\n//     vbox.pack_start(\u0026host, false, false, 0);\n//     vbox.pack_start(\u0026port, false, false, 0);\n//     vbox.pack_start(\u0026user, false, false, 0);\n//     vbox.pack_start(\u0026password, false, false, 0);\n//     vbox.pack_start(\u0026connect_btn, false, false, 0);\n\n//     (vbox, host, port, user, password, connect_btn)\n// }\n\n// fn update_camera_list(camera_list_box: \u0026gtk::Box, monitoring_app_ref: \u0026Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e) {\n//     // Clear the existing list\n//     camera_list_box.foreach(|widget| {\n//         camera_list_box.remove(widget);\n//     });\n\n//     // Fetch the list of cameras from the monitoring app\n//     let cameras = monitoring_app_ref.borrow().get_cameras(); // Assuming you have a method to get the list of cameras\n\n//     // Add each camera to the list box\n//     for camera in cameras {\n//         let location = camera.get_location();\n//         let camera_label = Label::new(Some(\u0026format!(\n//             \"Camera at ({}, {})\",\n//             location.latitude, location.longitude\n//         )));\n//         camera_list_box.pack_start(\u0026camera_label, false, false, 0);\n//     }\n\n//     camera_list_box.show_all();\n// }\n\n// fn on_add_camera_clicked(\n//     y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     monitoring_app_ref: Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n//     camera_list_box: Rc\u003cRefCell\u003cgtk::Box\u003e\u003e,\n// ) {\n//     let lat = format!(\"{:.2}\", y.borrow());\n//     let long = format!(\"{:.2}\", x.borrow());\n//     let camera_location = Location::new(lat, long);\n//     monitoring_app_ref.borrow_mut().add_camera(camera_location);\n\n//     // Update the camera list panel\n//     update_camera_list(\u0026camera_list_box.borrow(), \u0026monitoring_app_ref);\n// }\n\n// fn on_webview_button_press_event(\n//     x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     webview_clone: WebView,\n//     event: \u0026gdk::EventButton,\n// ) -\u003e bool {\n//     if event.button() == 1 {\n//         let pos_x = event.position().0;\n//         let pos_y = event.position().1;\n\n//         let _script = format!(\n//             \"var result = getLatLngFromPixel({}, {});\n//              JSON.stringify(result);\",\n//             pos_x, pos_y\n//         );\n\n//         *x.borrow_mut() = pos_x;\n//         *y.borrow_mut() = pos_y;\n\n//         webview_clone.run_javascript(\n//             \u0026format!(\"window.map.setView(window.map.containerPointToLatLng([{}, {}]), window.map.getZoom());\", pos_x, pos_y),\n//             None::\u003c\u0026gio::Cancellable\u003e,\n//             |_result| (),\n//         );\n//     }\n//     false\n// }\n\n// ///Se toma la localizacion del click actual, y se crea una incidente nuevo dentro de la app de monitoreo\n// fn on_add_incident_clicked(\n//     y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n//     monitoring_app_ref: Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n// ) {\n//     let lat = y.borrow().to_string();\n//     let long = x.borrow().to_string();\n//     let incident_location = Location::new(lat, long);\n//     monitoring_app_ref\n//         .borrow_mut()\n//         .add_incident(incident_location);\n// }\n\nextern crate gtk;\n\nuse gtk::glib::clone;\nuse gtk::prelude::*;\nuse gtk::{glib, Window, WindowType};\nuse gtk::{Application, Box, Button, Entry, Label, Orientation};\n\nuse std::cell::RefCell;\nuse std::rc::Rc;\n\nuse rustic_city_eye::monitoring::monitoring_app::MonitoringApp;\nuse rustic_city_eye::mqtt::protocol_error::ProtocolError;\nuse rustic_city_eye::surveilling::location::Location;\n\n#[cfg(not(test))]\nfn main() -\u003e Result\u003c(), ProtocolError\u003e {\n    let app = Application::builder()\n        .application_id(\"com.example.RusticCityEye\")\n        .build();\n\n    app.connect_activate(|app| {\n        let home_window = Window::new(WindowType::Toplevel);\n        home_window.set_title(\"Rustic City Eye\");\n        home_window.set_default_size(2000, 1500);\n\n        let vbox = Box::new(Orientation::Vertical, 5);\n\n        let button = Button::with_label(\"Conectarse a un servidor\");\n        vbox.pack_start(\u0026button, false, false, 0);\n\n        let elements_container = Box::new(Orientation::Vertical, 5);\n        vbox.pack_start(\u0026elements_container, true, true, 0);\n\n        button.connect_clicked(clone!(@weak button, @weak elements_container =\u003e move |_| {\n            button.hide();\n\n            handle_connection(\u0026elements_container);\n\n            elements_container.show_all();\n        }));\n\n        // Agrega la caja a la ventana.\n        home_window.add(\u0026vbox);\n\n        // Muestra todos los widgets en la ventana.\n        home_window.show_all();\n\n        // Configura la aplicaci√≥n principal.\n        home_window.set_application(Some(app));\n    });\n\n    app.run();\n\n    Ok(())\n}\n\n#[cfg(not(test))]\nfn handle_connection(elements_container: \u0026gtk::Box) {\n    let (connect_form, host, port, user, password, connect_btn) = get_connect_form();\n\n    elements_container.pack_start(\u0026connect_form, false, false, 0);\n\n    connect_btn.connect_clicked(clone!(@weak host, @weak port, @weak user, @weak password, @weak elements_container =\u003e move |_| {\n        let args = vec![host.text().to_string(), port.text().to_string(), user.text().to_string(), password.text().to_string()];\n\n        match MonitoringApp::new(args) {\n            Ok(mut monitoring_app) =\u003e {\n                elements_container.foreach(|widget| {\n                    elements_container.remove(widget);\n                });\n\n                let _ = monitoring_app.run_client();\n\n                // Create the horizontal box to hold the map and the panel\n                let hbox = gtk::Box::new(gtk::Orientation::Horizontal, 5);\n                elements_container.pack_start(\u0026hbox, true, true, 0);\n\n                // Create a new image widget\n                let image = gtk::Image::from_file(\"src/monitoring/Map.png\");\n\n                // Create a new event box\n                let event_box = gtk::EventBox::new();\n                event_box.add(\u0026image);\n\n                // Add the event box to the horizontal box\n                hbox.add(\u0026event_box);\n\n                // Create a vertical box to hold buttons for the panel\n                let vbox = gtk::Box::new(gtk::Orientation::Vertical, 0);\n\n                // Create a button for adding a camera\n                let add_camera_button = gtk::Button::with_label(\"Add Camera\");\n                vbox.add(\u0026add_camera_button);\n\n                // Create a button for adding an incident\n                let add_incident_button = gtk::Button::with_label(\"Add Incident\");\n                vbox.add(\u0026add_incident_button);\n\n                // Create the panel for camera list and buttons\n                let panel = gtk::Box::new(gtk::Orientation::Vertical, 5);\n                hbox.pack_start(\u0026panel, false, false, 0);\n\n                let add_camera_btn = gtk::Button::with_label(\"Add camera\");\n                panel.pack_start(\u0026add_camera_btn, false, false, 0);\n\n                let add_incident_btn = gtk::Button::with_label(\"Add incident\");\n                panel.pack_start(\u0026add_incident_btn, false, false, 0);\n\n                // Create the camera list panel\n                let camera_list_box = gtk::Box::new(gtk::Orientation::Vertical, 5);\n                panel.pack_start(\u0026camera_list_box, true, true, 0);\n                let camera_list_box = Rc::new(RefCell::new(camera_list_box));\n\n                let incident_list_box = gtk::Box::new(gtk::Orientation::Vertical, 5);\n                panel.pack_start(\u0026incident_list_box, true, true, 0);\n                let incident_list_box = Rc::new(RefCell::new(incident_list_box));\n\n                let monitoring_app_ref = Rc::new(RefCell::new(monitoring_app));\n\n                let (x, y) = (0.0, 0.0);\n                let x_ref = Rc::new(RefCell::new(x));\n                let y_ref = Rc::new(RefCell::new(y));\n                event_box.connect_button_press_event({\n                    let x_ref = Rc::clone(\u0026x_ref);\n                    let y_ref = Rc::clone(\u0026y_ref);\n                    move |_, event| {\n                        x_ref.replace(event.position().0);\n                        y_ref.replace(event.position().1);\n                        println!(\"Image clicked at coordinates {},{}\", x_ref.borrow(), y_ref.borrow());\n                        false.into() // Ensure you return the correct type here\n                    }\n                });\n\n                add_camera_btn.connect_clicked({\n                    let x_ref = Rc::clone(\u0026x_ref);\n                    let y_ref = Rc::clone(\u0026y_ref);\n                    let monitoring_app_ref = Rc::clone(\u0026monitoring_app_ref);\n                    let camera_list_box = Rc::clone(\u0026camera_list_box);\n                    move |_| {\n                        on_add_camera_clicked(Rc::clone(\u0026y_ref), Rc::clone(\u0026x_ref), Rc::clone(\u0026monitoring_app_ref), Rc::clone(\u0026camera_list_box));\n                    }\n                });\n\n                add_incident_btn.connect_clicked({\n                    let x_ref = Rc::clone(\u0026x_ref);\n                    let y_ref = Rc::clone(\u0026y_ref);\n                    let monitoring_app_ref = Rc::clone(\u0026monitoring_app_ref);\n                    let incident_list_box = Rc::clone(\u0026incident_list_box);\n                    move |_| {\n                        on_add_incident_clicked(Rc::clone(\u0026y_ref), Rc::clone(\u0026x_ref), Rc::clone(\u0026monitoring_app_ref), Rc::clone(\u0026incident_list_box));\n                    }\n                });\n\n\n                // add_incident_btn.connect_clicked({\n                //     let x_ref = Rc::clone(\u0026x_ref);\n                //     let y_ref = Rc::clone(\u0026y_ref);\n                //     let monitoring_app_ref = Rc::clone(\u0026monitoring_app_ref);\n                //     move |_| {\n                //         on_add_incident_clicked(Rc::clone(\u0026y_ref), Rc::clone(\u0026x_ref), Rc::clone(\u0026monitoring_app_ref));\n                //     }\n                // });\n\n                elements_container.add(\u0026hbox);\n\n                elements_container.show_all();\n\n                // Initial call to populate the camera list\n                update_camera_list(\u0026camera_list_box.borrow(), \u0026monitoring_app_ref);\n            },\n            Err(_) =\u003e {\n                println!(\"Error: intenta conectarte de nuevo\");\n\n                handle_connection(\u0026elements_container);\n            },\n        }\n        }));\n}\n\n#[cfg(not(test))]\nfn get_connect_form() -\u003e (gtk::Box, Entry, Entry, Entry, Entry, gtk::Button) {\n    let vbox = Box::new(Orientation::Vertical, 5);\n\n    let label = Label::new(Some(\"Ingrese al servidor\"));\n\n    let host = Entry::new();\n    host.set_placeholder_text(Some(\"Host: \"));\n\n    let port = Entry::new();\n    port.set_placeholder_text(Some(\"Port: \"));\n\n    let user = Entry::new();\n    user.set_placeholder_text(Some(\"Username: \"));\n\n    let password = Entry::new();\n    password.set_placeholder_text(Some(\"Password: \"));\n\n    let connect_btn = Button::with_label(\"Conectarse\");\n    vbox.pack_start(\u0026label, false, false, 0);\n    vbox.pack_start(\u0026host, false, false, 0);\n    vbox.pack_start(\u0026port, false, false, 0);\n    vbox.pack_start(\u0026user, false, false, 0);\n    vbox.pack_start(\u0026password, false, false, 0);\n    vbox.pack_start(\u0026connect_btn, false, false, 0);\n\n    (vbox, host, port, user, password, connect_btn)\n}\n#[cfg(not(test))]\n\nfn update_camera_list(camera_list_box: \u0026gtk::Box, monitoring_app_ref: \u0026Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e) {\n    // Clear the existing list\n    camera_list_box.foreach(|widget| {\n        camera_list_box.remove(widget);\n    });\n\n    // Fetch the list of cameras from the monitoring app\n    let cameras = monitoring_app_ref.borrow().get_cameras(); // Assuming you have a method to get the list of cameras\n\n    // Add each camera to the list box\n    for camera in cameras {\n        let location = camera.get_location();\n        let camera_label = gtk::Label::new(Some(\u0026format!(\n            \"Camera at ({}, {})\",\n            location.latitude, location.longitude\n        )));\n        camera_list_box.pack_start(\u0026camera_label, false, false, 0);\n    }\n\n    camera_list_box.show_all();\n}\n\n#[cfg(not(test))]\nfn on_add_camera_clicked(\n    y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n    x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n    monitoring_app_ref: Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n    camera_list_box: Rc\u003cRefCell\u003cgtk::Box\u003e\u003e,\n) {\n    let lat = format!(\"{:.2}\", y.borrow());\n    let long = format!(\"{:.2}\", x.borrow());\n    let camera_location = Location::new(lat, long);\n    monitoring_app_ref.borrow_mut().add_camera(camera_location);\n\n    // Update the camera list panel\n    update_camera_list(\u0026camera_list_box.borrow(), \u0026monitoring_app_ref);\n}\n\n///Se toma la localizacion del click actual, y se crea una incidente nuevo dentro de la app de monitoreo\nfn on_add_incident_clicked(\n    y: Rc\u003cRefCell\u003cf64\u003e\u003e,\n    x: Rc\u003cRefCell\u003cf64\u003e\u003e,\n    monitoring_app_ref: Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n    incident_list_box: Rc\u003cRefCell\u003cgtk::Box\u003e\u003e,\n) {\n    let lat = y.borrow().to_string();\n    let long = x.borrow().to_string();\n    let incident_location = Location::new(lat, long);\n    monitoring_app_ref\n        .borrow_mut()\n        .add_incident(incident_location);\n    update_incident_list(\u0026incident_list_box.borrow(), \u0026monitoring_app_ref);\n}\n\nfn update_incident_list(\n    incident_list_box: \u0026gtk::Box,\n    monitoring_app_ref: \u0026Rc\u003cRefCell\u003cMonitoringApp\u003e\u003e,\n) {\n    // Clear the existing list\n    incident_list_box.foreach(|widget| {\n        incident_list_box.remove(widget);\n    });\n\n    // Fetch the list of incidents from the monitoring app\n    let incidents = monitoring_app_ref.borrow().get_incidents(); // Assuming you have a method to get the list of incidents\n\n    // Add each incident to the list box\n    for incident in incidents {\n        let location = incident.get_location();\n        let incident_label = gtk::Label::new(Some(\u0026format!(\n            \"Incident at ({:.2}, {:.2})\",\n            location.latitude, location.longitude\n        )));\n        incident_list_box.pack_start(\u0026incident_label, false, false, 0);\n    }\n\n    incident_list_box.show_all();\n}\n","traces":[{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":289,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":293,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":315,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":324,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":329,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":330,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":387,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":388,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":389,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":390,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":391,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":400,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":401,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":442,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":443,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":445,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":447,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":448,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":450,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":451,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":453,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":454,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":456,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":457,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":459,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":460,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":461,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":462,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":463,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":464,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":465,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":467,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":473,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":474,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":478,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":481,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":482,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":483,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":484,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":485,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":487,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":490,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":494,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":500,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":501,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":502,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":503,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":506,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":510,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":516,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":517,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":518,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":519,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":521,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":522,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":525,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":530,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":531,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":535,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":538,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":539,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":540,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":541,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":542,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":544,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":547,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":86},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","monitoring","monitoring_app.rs"],"content":"//! Se conecta mediante TCP a la direcci√≥n asignada por argv.\n//! Lee lineas desde stdin y las manda mediante el socket.\n\nuse std::sync::mpsc::{self, Sender};\n\nuse crate::monitoring::incident::Incident;\nuse crate::mqtt::connect_config::ConnectConfig;\nuse crate::mqtt::messages_config::MessagesConfig;\nuse crate::mqtt::publish_config::PublishConfig;\nuse crate::mqtt::publish_properties::{PublishProperties, TopicProperties};\nuse crate::mqtt::{\n    client::Client, connect_properties, protocol_error::ProtocolError, will_properties,\n};\nuse crate::surveilling::camera::Camera;\nuse crate::surveilling::{camera_system::*, location::Location};\n\n#[derive(Debug)]\n#[allow(dead_code)]\npub struct MonitoringApp {\n    send_to_client_channel: Sender\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e,\n    monitoring_app_client: Client,\n    camera_system: CameraSystem,\n    incidents: Vec\u003cIncident\u003e,\n}\n\n#[allow(dead_code)]\nimpl MonitoringApp {\n    ///recibe una addres a la que conectarse\n    /// Crea el cliente de la app de monitoreo y lo conecta al broker\n    /// Crea un sistema de c√°maras y agrega una c√°mara al sistema\n    pub fn new(args: Vec\u003cString\u003e) -\u003e Result\u003cMonitoringApp, ProtocolError\u003e {\n        let will_properties = will_properties::WillProperties::new(\n            1,\n            1,\n            1,\n            \"a\".to_string(),\n            \"a\".to_string(),\n            [1, 2, 3].to_vec(),\n            vec![(\"a\".to_string(), \"a\".to_string())],\n        );\n\n        let connect_properties = connect_properties::ConnectProperties::new(\n            30,\n            1,\n            20,\n            20,\n            true,\n            true,\n            vec![(\"hola\".to_string(), \"chau\".to_string())],\n            \"auth\".to_string(),\n            vec![1, 2, 3],\n        );\n\n        let address = args[0].to_string() + \":\" + \u0026args[1].to_string();\n        let camera_system_args = vec![\n            args[0].clone(),\n            args[1].clone(),\n            \"camera_system\".to_string(),\n            \"CamareandoCamaritas123\".to_string(),\n        ];\n\n        let connect_config = ConnectConfig::new(\n            true,\n            true,\n            1,\n            true,\n            35,\n            connect_properties,\n            \"kvtr33\".to_string(),\n            will_properties,\n            \"camera system\".to_string(),\n            \"soy el monitoring y me desconecte\".to_string(),\n            args[2].clone(),\n            args[3].clone(),\n        );\n\n        let camera_system = CameraSystem::new(camera_system_args)?;\n\n        let (tx, rx) = mpsc::channel();\n\n        let monitoring_app = MonitoringApp {\n            send_to_client_channel: tx,\n            incidents: Vec::new(),\n            camera_system,\n            monitoring_app_client: match Client::new(rx, address, connect_config) {\n                Ok(client) =\u003e client,\n                Err(err) =\u003e return Err(err),\n            },\n        };\n\n        Ok(monitoring_app)\n    }\n\n    pub fn run_client(\u0026mut self) -\u003e Result\u003c(), ProtocolError\u003e {\n        self.monitoring_app_client.client_run()?;\n        self.camera_system.run_client()?;\n        Ok(())\n    }\n\n    pub fn add_camera(\u0026mut self, location: Location) {\n        self.camera_system.add_camera(location);\n    }\n\n    pub fn add_incident(\u0026mut self, location: Location) {\n        let incident = Incident::new(location);\n        self.incidents.push(incident.clone());\n\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let properties = PublishProperties::new(\n            1,\n            10,\n            topic_properties,\n            [1, 2, 3].to_vec(),\n            \"a\".to_string(),\n            1,\n            \"a\".to_string(),\n        );\n\n        let publish_config = PublishConfig::new(\n            1,\n            1,\n            0,\n            \"incidente\".to_string(),\n            \"ayudame loco\".to_string(),\n            properties,\n        );\n\n        let _ = self.send_to_client_channel.send(Box::new(publish_config));\n    }\n\n    pub fn get_cameras(\u0026self) -\u003e Vec\u003cCamera\u003e {\n        self.camera_system.get_cameras().clone()\n    }\n\n    pub fn get_incidents(\u0026self) -\u003e Vec\u003cIncident\u003e {\n        self.incidents.clone()\n    }\n}\n","traces":[{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":45},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","monitoring","monitoring_config.rs"],"content":"pub struct MonitoringConfig {}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","broker.rs"],"content":"use std::{\n    collections::HashMap,\n    io::{Read, Write},\n    net::{TcpListener, TcpStream},\n    sync::{Arc, Mutex, RwLock},\n};\n\nuse crate::mqtt::{\n    broker_config::BrokerConfig,\n    broker_message::BrokerMessage,\n    client_message::ClientMessage,\n    protocol_error::ProtocolError,\n    protocol_return::ProtocolReturn,\n    reason_code::{\n        NO_MATCHING_SUBSCRIBERS_HEX, SUB_ID_DUP_HEX, SUCCESS_HEX, UNSPECIFIED_ERROR_HEX,\n    },\n    topic::Topic,\n};\nuse crate::utils::threadpool::ThreadPool;\n\nstatic SERVER_ARGS: usize = 2;\n\nconst THREADPOOL_SIZE: usize = 20;\n\n#[derive(Clone)]\npub struct Broker {\n    address: String,\n\n    ///Contiene a todos los Topics.\n    /// Se identifican con un topic_name unico para cada topic.\n    topics: HashMap\u003cString, Topic\u003e,\n\n    /// El u16 corresponde al packet_id del package, y dentro\n    /// de esa clave se guarda el package.\n    packets: Arc\u003cRwLock\u003cHashMap\u003cu16, ClientMessage\u003e\u003e\u003e,\n\n    subs: Vec\u003cu32\u003e,\n\n    clients_ids: Arc\u003cVec\u003cString\u003e\u003e,\n}\n\nimpl Broker {\n    ///Chequea que el numero de argumentos sea valido.\n    pub fn new(args: Vec\u003cString\u003e) -\u003e Result\u003cBroker, ProtocolError\u003e {\n        if args.len() != SERVER_ARGS {\n            let app_name = \u0026args[0];\n            println!(\"Usage:\\n{:?} \u003cpuerto\u003e\", app_name);\n            return Err(ProtocolError::InvalidNumberOfArguments);\n        }\n\n        let address = \"0.0.0.0:\".to_owned() + \u0026args[1];\n\n        let broker_config = BrokerConfig::new(address)?;\n\n        let (address, topics) = broker_config.get_broker_config();\n\n        let packets = HashMap::new();\n\n        Ok(Broker {\n            address,\n            topics,\n            packets: Arc::new(RwLock::new(packets)),\n            subs: Vec::new(),\n            clients_ids: Arc::new(Vec::new()),\n        })\n    }\n\n    /// Ejecuta el servidor.\n    /// Crea un enlace en la direcci√≥n del broker y, para\n    /// cada conexi√≥n entrante, crea un hilo para manejar el nuevo cliente.\n    pub fn server_run(\u0026mut self) -\u003e std::io::Result\u003c()\u003e {\n        let listener = TcpListener::bind(\u0026self.address)?;\n        println!(\"Broker escuchando en {}\", self.address);\n        let threadpool = ThreadPool::new(THREADPOOL_SIZE);\n\n        for stream in listener.incoming() {\n            match stream {\n                Ok(stream) =\u003e {\n                    let topics_clone = self.topics.clone();\n                    let packets_clone = self.packets.clone();\n                    let subs_clone = self.subs.clone();\n                    let clients_ids_clone = self.clients_ids.clone();\n\n                    threadpool.execute(move || {\n                        // Use the cloned reference\n                        let _ = Broker::handle_client(\n                            stream,\n                            topics_clone,\n                            packets_clone,\n                            subs_clone,\n                            clients_ids_clone,\n                        );\n                    });\n                }\n                Err(err) =\u003e return Err(err),\n            }\n        }\n        Ok(())\n    }\n\n    ///Se encarga del manejo de los mensajes del cliente. Envia los ACKs correspondientes.\n    pub fn handle_client(\n        stream: TcpStream,\n        topics: HashMap\u003cString, Topic\u003e,\n        packets: Arc\u003cRwLock\u003cHashMap\u003cu16, ClientMessage\u003e\u003e\u003e,\n        _subs: Vec\u003cu32\u003e,\n        mut clients_ids: Arc\u003cVec\u003cString\u003e\u003e,\n    ) -\u003e Result\u003c(), ProtocolError\u003e {\n        loop {\n            let cloned_sream = match stream.try_clone() {\n                Ok(stream) =\u003e stream,\n                Err(_) =\u003e return Err(ProtocolError::StreamError),\n            };\n            match handle_messages(\n                cloned_sream,\n                topics.clone(),\n                packets.clone(),\n                _subs.clone(),\n                clients_ids.clone(),\n            ) {\n                Ok(return_val) =\u003e {\n                    if return_val == ProtocolReturn::DisconnectRecieved {\n                        return Ok(());\n                    }\n                }\n                Err(err) =\u003e {\n                    return Err(err);\n                }\n            }\n        }\n    }\n\n    fn handle_subscribe(\n        stream: TcpStream,\n        mut topics: HashMap\u003cString, Topic\u003e,\n        topic_name: String,\n        sub_id: u8,\n    ) -\u003e Result\u003cu8, ProtocolError\u003e {\n        let reason_code;\n        if let Some(topic) = topics.get_mut(\u0026topic_name) {\n            match topic.add_subscriber(stream, sub_id) {\n                0 =\u003e {\n                    println!(\"Subscripcion exitosa\");\n                    reason_code = SUCCESS_HEX;\n                }\n                0x92 =\u003e {\n                    println!(\"SubId duplicado\");\n                    reason_code = SUB_ID_DUP_HEX;\n                }\n                _ =\u003e {\n                    println!(\"Error no especificado\");\n                    reason_code = UNSPECIFIED_ERROR_HEX;\n                }\n            }\n        } else {\n            reason_code = UNSPECIFIED_ERROR_HEX;\n        }\n\n        Ok(reason_code)\n    }\n\n    fn handle_publish(\n        message: ClientMessage,\n        mut topics: HashMap\u003cString, Topic\u003e,\n        topic_name: String,\n    ) -\u003e Result\u003cu8, ProtocolError\u003e {\n        if let Some(topic) = topics.get_mut(\u0026topic_name) {\n            match topic.deliver_message(message) {\n                Ok(reason_code) =\u003e return Ok(reason_code),\n                Err(_) =\u003e return Err(ProtocolError::PublishError),\n            };\n        }\n\n        Ok(0x80_u8) //Unspecified Error reason code\n    }\n\n    fn handle_unsubscribe(\n        mut topics: HashMap\u003cString, Topic\u003e,\n        topic_name: String,\n        sub_id: u8,\n    ) -\u003e Result\u003cu8, ProtocolError\u003e {\n        if sub_id == 0 {\n            return Ok(NO_MATCHING_SUBSCRIBERS_HEX);\n        }\n\n        let reason_code;\n\n        if let Some(topic) = topics.get_mut(\u0026topic_name) {\n            match topic.remove_subscriber(sub_id) {\n                0 =\u003e {\n                    println!(\"Unsubscribe exitoso\");\n                    reason_code = SUCCESS_HEX;\n                }\n                _ =\u003e {\n                    println!(\"Error no especificado\");\n                    reason_code = UNSPECIFIED_ERROR_HEX;\n                }\n            }\n        } else {\n            println!(\"Error no especificado\");\n            reason_code = UNSPECIFIED_ERROR_HEX;\n        }\n        println!(\"reason code {:?}\", reason_code);\n\n        Ok(reason_code)\n    }\n\n    ///Se toma un packet con su respectivo ID y se lo guarda en el hashmap de mensajes que tiene el Broker.\n    fn save_packet(\n        packets: Arc\u003cRwLock\u003cHashMap\u003cu16, ClientMessage\u003e\u003e\u003e,\n        message: ClientMessage,\n        packet_id: u16,\n    ) {\n        let mut lock = packets.write().unwrap();\n\n        lock.insert(packet_id, message);\n    }\n}\n\npub fn handle_messages(\n    mut stream: TcpStream,\n    topics: HashMap\u003cString, Topic\u003e,\n    packets: Arc\u003cRwLock\u003cHashMap\u003cu16, ClientMessage\u003e\u003e\u003e,\n    _subs: Vec\u003cu32\u003e,\n    mut clients_ids: Arc\u003cVec\u003cString\u003e\u003e,\n) -\u003e Result\u003cProtocolReturn, ProtocolError\u003e {\n    let mensaje = match ClientMessage::read_from(\u0026mut stream) {\n        Ok(mensaje) =\u003e mensaje,\n        Err(err) =\u003e return Err(ProtocolError::StreamError),\n    };\n    match mensaje {\n        ClientMessage::Connect {\n            clean_start: _,\n            last_will_flag: _,\n            last_will_qos: _,\n            last_will_retain: _,\n            username: _,\n            password: _,\n            keep_alive: _,\n            properties: _,\n            client_id,\n            will_properties: _,\n            last_will_topic: _,\n            last_will_message: _,\n        } =\u003e {\n            println!(\"Recib√≠ un Connect\");\n\n            if clients_ids.contains(\u0026client_id) {\n                let disconnect = BrokerMessage::Disconnect {\n                    reason_code: 0,\n                    session_expiry_interval: 0,\n                    reason_string: \"El cliente ya est√° conectado\".to_string(),\n                    user_properties: Vec::new(),\n                };\n\n                match disconnect.write_to(\u0026mut stream) {\n                    Ok(_) =\u003e {\n                        println!(\"Disconnect enviado\");\n                        return Ok(ProtocolReturn::DisconnectSent);\n                    }\n                    Err(err) =\u003e println!(\"Error al enviar Disconnect: {:?}\", err),\n                }\n            }\n            Arc::make_mut(\u0026mut clients_ids).push(client_id);\n            let connack = BrokerMessage::Connack {\n                    //session_present: true,\n                    //return_code: 0,\n                };\n            println!(\"Enviando un Connack\");\n            match connack.write_to(\u0026mut stream) {\n                Ok(_) =\u003e return Ok(ProtocolReturn::ConnackSent),\n                Err(err) =\u003e {\n                    println!(\"{:?}\", err);\n                }\n            }\n        }\n        ClientMessage::Publish {\n            packet_id,\n            topic_name,\n            qos,\n            retain_flag,\n            payload,\n            dup_flag,\n            properties,\n        } =\u003e {\n            println!(\"Recib√≠ un Publish\");\n            println!(\"Topic name: {}\", topic_name);\n            println!(\"Payload: {:?}\", payload);\n            let msg = ClientMessage::Publish {\n                packet_id,\n                topic_name: topic_name.clone(),\n                qos,\n                retain_flag,\n                payload: payload.clone(),\n                dup_flag,\n                properties,\n            };\n            Broker::save_packet(packets.clone(), msg.clone(), packet_id);\n\n            let packet_id_bytes: [u8; 2] = packet_id.to_be_bytes();\n\n            let reason_code = Broker::handle_publish(msg, topics.clone(), topic_name)?;\n\n            if qos == 1 {\n                let puback = BrokerMessage::Puback {\n                    packet_id_msb: packet_id_bytes[0],\n                    packet_id_lsb: packet_id_bytes[1],\n                    reason_code,\n                };\n                println!(\"Enviando un Puback\");\n                match puback.write_to(\u0026mut stream) {\n                    Ok(_) =\u003e {\n                        println!(\"Puback enviado\");\n                        return Ok(ProtocolReturn::PubackSent);\n                    }\n                    Err(err) =\u003e println!(\"Error al enviar Puback: {:?}\", err),\n                }\n            }\n        }\n        ClientMessage::Subscribe {\n            packet_id,\n            topic_name,\n            properties,\n        } =\u003e {\n            println!(\"Recibi un Subscribe\");\n            let msg = ClientMessage::Subscribe {\n                packet_id,\n                topic_name: topic_name.clone(),\n                properties: properties.clone(),\n            };\n            Broker::save_packet(packets.clone(), msg, packet_id);\n\n            let packet_id_bytes: [u8; 2] = packet_id.to_be_bytes();\n\n            let stream_for_topic = match stream.try_clone() {\n                Ok(stream) =\u003e stream,\n                Err(_) =\u003e return Err(ProtocolError::StreamError),\n            };\n\n            let reason_code = Broker::handle_subscribe(\n                stream_for_topic,\n                topics.clone(),\n                topic_name,\n                properties.sub_id,\n            )?;\n            match reason_code {\n                0 =\u003e {\n                    println!(\"Enviando un Suback\");\n                    let suback = BrokerMessage::Suback {\n                        packet_id_msb: packet_id_bytes[0],\n                        packet_id_lsb: packet_id_bytes[1],\n                        reason_code: 0,\n                        sub_id: properties.sub_id,\n                    };\n                    match suback.write_to(\u0026mut stream) {\n                        Ok(_) =\u003e {\n                            println!(\"Suback enviado\");\n                            return Ok(ProtocolReturn::SubackSent);\n                        }\n                        Err(err) =\u003e println!(\"Error al enviar suback: {:?}\", err),\n                    }\n                }\n                _ =\u003e {\n                    let suback = BrokerMessage::Suback {\n                        packet_id_msb: packet_id_bytes[0],\n                        packet_id_lsb: packet_id_bytes[1],\n                        reason_code: 0x80,\n                        sub_id: properties.sub_id,\n                    };\n                    println!(\"Enviando un Suback\");\n                    match suback.write_to(\u0026mut stream) {\n                        Ok(_) =\u003e {\n                            println!(\"Suback enviado\");\n                            return Ok(ProtocolReturn::SubackSent);\n                        }\n                        Err(err) =\u003e println!(\"Error al enviar suback: {:?}\", err),\n                    }\n                }\n            }\n            return Ok(ProtocolReturn::SubackSent);\n        }\n        ClientMessage::Unsubscribe {\n            packet_id,\n            topic_name,\n            properties,\n        } =\u003e {\n            println!(\"Recib√≠ un Unsubscribe\");\n\n            let packet_id_bytes: [u8; 2] = packet_id.to_be_bytes();\n\n            let reason_code =\n                Broker::handle_unsubscribe(topics.clone(), topic_name, properties.sub_id)?;\n\n            let unsuback = BrokerMessage::Unsuback {\n                packet_id_msb: packet_id_bytes[0],\n                packet_id_lsb: packet_id_bytes[1],\n                reason_code,\n            };\n\n            println!(\"Enviando un Unsuback\");\n            match unsuback.write_to(\u0026mut stream) {\n                Ok(_) =\u003e {\n                    println!(\"Unsuback enviado\");\n                    return Ok(ProtocolReturn::UnsubackSent);\n                }\n                Err(err) =\u003e println!(\"Error al enviar Unsuback: {:?}\", err),\n            }\n        }\n        ClientMessage::Disconnect {\n            reason_code: _,\n            session_expiry_interval: _,\n            reason_string,\n            user_properties: _,\n        } =\u003e {\n            println!(\n                \"Recib√≠ un Disconnect, razon de desconexi√≥n: {:?}\",\n                reason_string\n            );\n            return Ok(ProtocolReturn::DisconnectRecieved);\n        }\n        ClientMessage::Pingreq =\u003e {\n            println!(\"Recib√≠ un Pingreq\");\n            let pingresp = BrokerMessage::Pingresp;\n            println!(\"Enviando un Pingresp\");\n            match pingresp.write_to(\u0026mut stream) {\n                Ok(_) =\u003e {\n                    println!(\"Pingresp enviado\");\n                    return Ok(ProtocolReturn::PingrespSent);\n                }\n                Err(err) =\u003e println!(\"Error al enviar Pingresp: {:?}\", err),\n            }\n        }\n    }\n    return Err(ProtocolError::UnspecifiedError);\n}\n\n#[cfg(test)]\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::sync::{Arc, RwLock};\n    use std::thread;\n\n    #[test]\n    fn test_handle_client() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        // Spawn a thread to simulate a client.\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            stream.write_all(b\"Hello, world!\").unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        // Write a ClientMessage to the stream.\n        // You'll need to replace this with a real ClientMessage.\n        let mut result: Result\u003c(), ProtocolError\u003e = Err(ProtocolError::UnspecifiedError);\n\n        // Accept the connection and pass the stream to the function.\n        if let Ok((stream, _)) = listener.accept() {\n            // Perform your assertions here\n            result = Broker::handle_client(stream, topics, packets, subs, clients_ids);\n        }\n\n        // Check that the function returned Ok.\n        // You might want to add more checks here, depending on what\n        // handle_client is supposed to do.\n        assert!(result.is_err());\n    }\n}\n","traces":[{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":169,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":194,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":195,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":196,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":203,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":25},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":46},"fn_name":null},{"line":229,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":243,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":252,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":253,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":264,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":271,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":294,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":298,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":302,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":311,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":314,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":316,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":321,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":323,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":324,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":329,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":333,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":335,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":337,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":348,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":355,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":357,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":360,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":365,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":366,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":368,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":370,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":371,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":373,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":374,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":376,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":384,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":385,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":386,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":387,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":389,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":391,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":392,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":403,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":404,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":406,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":412,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":413,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":414,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":415,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":416,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":417,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":419,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":422,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":423,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":424,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":425,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":427,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":428,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":430,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":434,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":101,"coverable":175},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","broker_config.rs"],"content":"use std::{\n    collections::HashMap,\n    fs::File,\n    io::{BufRead, BufReader},\n};\n\nuse crate::mqtt::{protocol_error::ProtocolError, topic::Topic};\n\n/// Contiene la configuracion del Broker:\n/// Lee el archivo de topics que el usuario quiera manejar, y\n/// guarda el address que usa.\npub struct BrokerConfig {\n    address: String,\n    topics: HashMap\u003cString, Topic\u003e,\n}\n\nimpl BrokerConfig {\n    ///Leo el archivo de topic_config y guardo las lecturas que haga.\n    pub fn new(address: String) -\u003e Result\u003cBrokerConfig, ProtocolError\u003e {\n        let mut topics = HashMap::new();\n        let topic_config_path = \"./src/monitoring/topics.txt\";\n\n        let readings = BrokerConfig::process_topic_config_file(topic_config_path)?;\n\n        for topic in readings {\n            topics.insert(topic, Topic::new());\n        }\n\n        Ok(BrokerConfig { address, topics })\n    }\n\n    /// La idea es que Broker llame a esta funcion y que pueda acceder a su configuracion\n    pub fn get_broker_config(\u0026self) -\u003e (String, HashMap\u003cString, Topic\u003e) {\n        (self.address.clone(), self.topics.clone())\n    }\n\n    fn process_topic_config_file(file_path: \u0026str) -\u003e Result\u003cVec\u003cString\u003e, ProtocolError\u003e {\n        let file = match File::open(file_path) {\n            Ok(file) =\u003e file,\n            Err(_) =\u003e return Err(ProtocolError::ReadingTopicConfigFileError),\n        };\n\n        let readings = BrokerConfig::read_topic_config_file(\u0026file)?;\n\n        Ok(readings)\n    }\n\n    fn read_topic_config_file(file: \u0026File) -\u003e Result\u003cVec\u003cString\u003e, ProtocolError\u003e {\n        let reader = BufReader::new(file).lines();\n        let mut readings = Vec::new();\n\n        for line in reader {\n            match line {\n                Ok(line) =\u003e readings.push(line),\n                Err(_err) =\u003e return Err(ProtocolError::ReadingTopicConfigFileError),\n            }\n        }\n\n        Ok(readings)\n    }\n}\n","traces":[{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":21},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","broker_message.rs"],"content":"use std::io::{BufWriter, Error, Read, Write};\n\nuse crate::utils::{reader::*, writer::*};\n\nconst SESSION_EXPIRY_INTERVAL_ID: u8 = 0x11;\nconst REASON_STRING_ID: u8 = 0x1F;\nconst USER_PROPERTY_ID: u8 = 0x26;\nuse super::publish_properties::PublishProperties;\n\n#[derive(Debug, PartialEq)]\npub enum BrokerMessage {\n    Connack {\n        //session_present: bool,\n        //return_code: u32\n    },\n\n    /// Puback es la respuesta a un Publish packet con QoS 1.\n    Puback {\n        packet_id_msb: u8,\n        packet_id_lsb: u8,\n        reason_code: u8,\n    },\n    /// El Suback se utiliza para confirmar la suscripci√≥n a un topic\n    ///\n    /// reason_code es el c√≥digo de raz√≥n de la confirmaci√≥n\n    /// packet_id_msb y packet_id_lsb son los bytes m√°s significativos y menos significativos del packet_id\n    Suback {\n        /// packet_id_msb es el byte m√°s significativo del packet_id\n        packet_id_msb: u8,\n        /// packet_id_lsb es el byte menos significativo del packet_id\n        packet_id_lsb: u8,\n        /// reason_code es el c√≥digo de raz√≥n de la confirmaci√≥n\n        reason_code: u8,\n        sub_id: u8,\n    },\n    PublishDelivery {\n        packet_id: u16,\n        topic_name: String,\n        qos: usize,\n        retain_flag: usize,\n        payload: String,\n        dup_flag: usize,\n        properties: PublishProperties,\n    },\n    Unsuback {\n        packet_id_msb: u8,\n        packet_id_lsb: u8,\n        reason_code: u8,\n    },\n    Disconnect {\n        reason_code: u8,\n        session_expiry_interval: u32,\n        reason_string: String,\n        user_properties: Vec\u003c(String, String)\u003e,\n    },\n    Pingresp,\n}\n#[allow(dead_code)]\nimpl BrokerMessage {\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e std::io::Result\u003c()\u003e {\n        let mut writer = BufWriter::new(stream);\n        match self {\n            BrokerMessage::Connack {} =\u003e {\n                let byte_1: u8 = 0x10_u8.to_le();\n\n                writer.write_all(\u0026[byte_1])?;\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::Puback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code,\n            } =\u003e {\n                //fixed header\n                let byte_1: u8 = 0x40_u8.to_le(); //01000000\n\n                writer.write_all(\u0026[byte_1])?;\n\n                //variable header\n                //packet_id\n                write_u8(\u0026mut writer, packet_id_msb)?;\n                write_u8(\u0026mut writer, packet_id_lsb)?;\n\n                //reason code\n                write_u8(\u0026mut writer, reason_code)?;\n\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::Suback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code,\n                sub_id,\n            } =\u003e {\n                //fixed header\n                let byte_1: u8 = 0x90_u8.to_le(); //10010000\n\n                writer.write_all(\u0026[byte_1])?;\n\n                //variable header\n                //let byte_2: u8 = 0x00_u8.to_le(); //00000000\n                //writer.write(\u0026[byte_2])?;\n\n                //payload\n                //let byte_3: u8 = 0x01_u8.to_le(); //00000001\n                //writer.write(\u0026[byte_3])?;\n                write_u8(\u0026mut writer, packet_id_msb)?;\n                write_u8(\u0026mut writer, packet_id_lsb)?;\n\n                //reason code\n                write_u8(\u0026mut writer, reason_code)?;\n\n                //sub_id\n                write_u8(\u0026mut writer, sub_id)?;\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::PublishDelivery {\n                packet_id,\n                topic_name,\n                qos,\n                retain_flag,\n                payload,\n                dup_flag,\n                properties,\n            } =\u003e {\n                //fixed header -\u003e es uno de juguete, hay que pensarlo mejor\n                let byte_1: u8 = 0x00_u8.to_le();\n                writer.write_all(\u0026[byte_1])?;\n\n                //variable header\n                //packet_id\n                write_u8(\u0026mut writer, \u0026packet_id.to_be_bytes()[0])?;\n                write_u8(\u0026mut writer, \u0026packet_id.to_be_bytes()[1])?;\n\n                //topic_name\n                write_string(\u0026mut writer, topic_name)?;\n\n                //qos\n                write_u8(\u0026mut writer, \u0026qos.to_be_bytes()[0])?;\n\n                //retain_flag\n                write_u8(\u0026mut writer, \u0026retain_flag.to_be_bytes()[0])?;\n\n                //payload\n                write_string(\u0026mut writer, payload)?;\n\n                //dup_flag\n                write_u8(\u0026mut writer, \u0026dup_flag.to_be_bytes()[0])?;\n\n                //properties\n                properties.write_properties(\u0026mut writer)?;\n\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::Unsuback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code,\n            } =\u003e {\n                //fixed header\n                let byte_1: u8 = 0xB0_u8.to_le(); //10110000\n\n                writer.write_all(\u0026[byte_1])?;\n\n                //variable header\n                //packet_id\n                write_u8(\u0026mut writer, packet_id_msb)?;\n                write_u8(\u0026mut writer, packet_id_lsb)?;\n                write_u8(\u0026mut writer, reason_code)?;\n\n                writer.flush()?;\n\n                Ok(())\n            }\n            BrokerMessage::Disconnect {\n                reason_code,\n                session_expiry_interval,\n                reason_string,\n                user_properties,\n            } =\u003e {\n                //fixed header\n                let header: u8 = 0xE0_u8.to_le(); //11100000\n                write_u8(\u0026mut writer, \u0026header)?;\n                //variable_header\n                write_u8(\u0026mut writer, reason_code)?;\n\n                write_u8(\u0026mut writer, \u0026SESSION_EXPIRY_INTERVAL_ID)?;\n                write_u32(\u0026mut writer, session_expiry_interval)?;\n\n                write_u8(\u0026mut writer, \u0026REASON_STRING_ID)?;\n                write_string(\u0026mut writer, reason_string)?;\n\n                write_u8(\u0026mut writer, \u0026USER_PROPERTY_ID)?;\n                write_string_pairs(\u0026mut writer, user_properties)?;\n                writer.flush()?;\n                Ok(())\n            }\n            BrokerMessage::Pingresp =\u003e {\n                let byte_1: u8 = 0xD0_u8.to_le();\n                writer.write_all(\u0026[byte_1])?;\n                writer.flush()?;\n\n                Ok(())\n            }\n        }\n    }\n\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cBrokerMessage, Error\u003e {\n        let mut header = [0u8; 1];\n        stream.read_exact(\u0026mut header)?;\n        let header = u8::from_le_bytes(header);\n\n        match header {\n            0x00 =\u003e {\n                let packet_id_msb = read_u8(stream)?;\n                let packet_id_lsb = read_u8(stream)?;\n                let topic_name = read_string(stream)?;\n                let qos = read_u8(stream)? as usize;\n                let retain_flag = read_u8(stream)? as usize;\n                let payload = read_string(stream)?;\n                let dup_flag = read_u8(stream)? as usize;\n                let properties = PublishProperties::read_from(stream)?;\n\n                Ok(BrokerMessage::PublishDelivery {\n                    packet_id: u16::from_be_bytes([packet_id_msb, packet_id_lsb]),\n                    topic_name,\n                    qos,\n                    retain_flag,\n                    payload,\n                    dup_flag,\n                    properties,\n                })\n            }\n            0x10 =\u003e Ok(BrokerMessage::Connack {}),\n            0x40 =\u003e {\n                let packet_id_msb = read_u8(stream)?;\n                let packet_id_lsb = read_u8(stream)?;\n                let reason_code = read_u8(stream)?;\n\n                Ok(BrokerMessage::Puback {\n                    packet_id_msb,\n                    packet_id_lsb,\n                    reason_code,\n                })\n            }\n            0x90 =\u003e {\n                let packet_id_msb = read_u8(stream)?;\n                let packet_id_lsb = read_u8(stream)?;\n                let reason_code = read_u8(stream)?;\n                let sub_id = read_u8(stream)?;\n                Ok(BrokerMessage::Suback {\n                    packet_id_msb,\n                    packet_id_lsb,\n                    reason_code,\n                    sub_id,\n                })\n            }\n            0xB0 =\u003e {\n                let packet_id_msb = read_u8(stream)?;\n                let packet_id_lsb = read_u8(stream)?;\n                let reason_code = read_u8(stream)?;\n\n                Ok(BrokerMessage::Unsuback {\n                    packet_id_msb,\n                    packet_id_lsb,\n                    reason_code,\n                })\n            }\n            0xE0 =\u003e {\n                let reason_code = read_u8(stream)?;\n                let session_expiry_interval_id = read_u8(stream)?;\n                if session_expiry_interval_id != SESSION_EXPIRY_INTERVAL_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid session expiry interval id\",\n                    ));\n                }\n                let session_expiry_interval = read_u32(stream)?;\n\n                let reason_string_id = read_u8(stream)?;\n                if reason_string_id != REASON_STRING_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid reason string id\",\n                    ));\n                }\n                let reason_string = read_string(stream)?;\n\n                let user_property_id = read_u8(stream)?;\n                if user_property_id != USER_PROPERTY_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid user property id\",\n                    ));\n                }\n                let user_properties = read_string_pairs(stream)?;\n\n                Ok(BrokerMessage::Disconnect {\n                    reason_code,\n                    session_expiry_interval,\n                    reason_string,\n                    user_properties,\n                })\n            }\n            0xD0 =\u003e Ok(BrokerMessage::Pingresp),\n            _ =\u003e Err(Error::new(std::io::ErrorKind::Other, \"Invalid header\")),\n        }\n    }\n\n    pub fn analize_packet_id(\u0026self, packet_id: u16) -\u003e bool {\n        match self {\n            BrokerMessage::Connack {} =\u003e true,\n            BrokerMessage::Puback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code: _,\n            } =\u003e {\n                let bytes = packet_id.to_be_bytes();\n\n                bytes[0] == *packet_id_msb \u0026\u0026 bytes[1] == *packet_id_lsb\n            }\n            BrokerMessage::Suback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code: _,\n                sub_id: _,\n            } =\u003e {\n                let bytes = packet_id.to_be_bytes();\n\n                bytes[0] == *packet_id_msb \u0026\u0026 bytes[1] == *packet_id_lsb\n            }\n            BrokerMessage::PublishDelivery {\n                packet_id: _,\n                topic_name: _,\n                qos: _,\n                retain_flag: _,\n                dup_flag: _,\n                properties: _,\n                payload: _,\n            } =\u003e true,\n            BrokerMessage::Unsuback {\n                packet_id_msb,\n                packet_id_lsb,\n                reason_code: _,\n            } =\u003e {\n                let bytes = packet_id.to_be_bytes();\n\n                bytes[0] == *packet_id_msb \u0026\u0026 bytes[1] == *packet_id_lsb\n            }\n            BrokerMessage::Pingresp =\u003e true,\n            BrokerMessage::Disconnect {\n                reason_code: _,\n                session_expiry_interval: _,\n                reason_string: _,\n                user_properties: _,\n            } =\u003e true,\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_02_analizing_packet_ids_ok() {\n        let suback = BrokerMessage::Suback {\n            reason_code: 1,\n            packet_id_msb: 2,\n            packet_id_lsb: 1,\n            sub_id: 1,\n        };\n\n        let puback = BrokerMessage::Puback {\n            packet_id_msb: 1,\n            packet_id_lsb: 5,\n            reason_code: 1,\n        };\n\n        assert!(suback.analize_packet_id(513));\n        assert!(puback.analize_packet_id(261));\n    }\n\n    #[test]\n    fn test_03_unsuback_ok() {\n        let unsuback = BrokerMessage::Unsuback {\n            packet_id_msb: 1,\n            packet_id_lsb: 1,\n            reason_code: 1,\n        };\n\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match unsuback.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(err) =\u003e {\n                println!(\"Error: {:?}\", err);\n                panic!();\n            }\n        }\n        cursor.set_position(0);\n        let read_unsuback = match BrokerMessage::read_from(\u0026mut cursor) {\n            Ok(unsuback) =\u003e unsuback,\n            Err(err) =\u003e {\n                println!(\"Error: {:?}\", err);\n\n                panic!()\n            }\n        };\n        assert_eq!(unsuback, read_unsuback);\n    }\n}\n","traces":[{"line":60,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":169,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":181,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":185,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":190,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":193,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":195,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":196,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":198,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":201,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":202,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":203,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":204,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":211,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":217,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":221,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":229,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":237,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":258,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":259,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":263,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":268,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":271,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":273,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":274,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":278,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":279,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":291,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":299,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":301,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":309,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":310,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":313,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":314,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":318,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":323,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":324,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":326,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":332,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":333,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":334,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":335,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":336,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":338,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":348,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":350,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":352,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":354,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":356,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":364,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":89,"coverable":175},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","client.rs"],"content":"use rand::Rng;\nuse std::{\n    collections::HashMap,\n    net::TcpStream,\n    sync::{\n        mpsc::{self, Receiver, Sender},\n        Arc, Mutex,\n    },\n};\n\nuse crate::{\n    mqtt::{\n        broker_message::BrokerMessage, client_message::ClientMessage,\n        connect_config::ConnectConfig, error::ClientError, messages_config::MessagesConfig,\n        protocol_error::ProtocolError,\n    },\n    utils::threadpool::ThreadPool,\n};\n\n#[derive(Debug)]\npub struct Client {\n    receiver_channel: Arc\u003cMutex\u003cReceiver\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e\u003e\u003e,\n\n    // stream es el socket que se conecta al broker\n    stream: TcpStream,\n    // las subscriptions son un hashmap de topic y sub_id\n    pub subscriptions: Arc\u003cMutex\u003cHashMap\u003cString, u8\u003e\u003e\u003e,\n    // pending_messages es un vector de packet_id\n    pending_messages: Vec\u003cu16\u003e,\n    // user_id: u32,\n}\n\nimpl Client {\n    #[allow(clippy::too_many_arguments)]\n    pub fn new(\n        receiver_channel: Receiver\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e,\n        address: String,\n        connect_config: ConnectConfig,\n    ) -\u003e Result\u003cClient, ProtocolError\u003e {\n        let mut stream = match TcpStream::connect(address) {\n            Ok(stream) =\u003e stream,\n            Err(_) =\u003e return Err(ProtocolError::ConectionError),\n        };\n\n        let connect = ClientMessage::Connect {\n            clean_start: connect_config.clean_start,\n            last_will_flag: connect_config.last_will_flag,\n            last_will_qos: connect_config.last_will_qos,\n            last_will_retain: connect_config.last_will_retain,\n            username: connect_config.username,\n            password: connect_config.password,\n            keep_alive: connect_config.keep_alive,\n            properties: connect_config.properties,\n            client_id: connect_config.client_id,\n            will_properties: connect_config.will_properties,\n            last_will_topic: connect_config.last_will_topic,\n            last_will_message: connect_config.last_will_message,\n        };\n\n        println!(\"Enviando connect message to broker\");\n        match connect.write_to(\u0026mut stream) {\n            Ok(()) =\u003e println!(\"Connect message enviado\"),\n            Err(_) =\u003e println!(\"Error al enviar connect message\"),\n        }\n\n        if let Ok(message) = BrokerMessage::read_from(\u0026mut stream) {\n            match message {\n                BrokerMessage::Connack {\n                   //session_present,\n                    //return_code,\n                } =\u003e {\n                    println!(\"Recib√≠ un Connack\");\n                },\n                _ =\u003e println!(\"no recibi un Connack :(\"),\n\n            }\n        } else {\n            println!(\"soy el client y no pude leer el mensaje\");\n        };\n\n        let _user_id = Client::assign_user_id();\n\n        Ok(Client {\n            receiver_channel: Arc::new(Mutex::new(receiver_channel)),\n            stream,\n            subscriptions: Arc::new(Mutex::new(HashMap::new())),\n            pending_messages: Vec::new(),\n        })\n    }\n\n    /// Publica un mensaje en un topic determinado.\n    pub fn publish_message(\n        message: ClientMessage,\n        mut stream: TcpStream,\n        packet_id: u16,\n    ) -\u003e Result\u003cu16, ClientError\u003e {\n        match message.write_to(\u0026mut stream) {\n            Ok(()) =\u003e Ok(packet_id),\n            Err(_) =\u003e Err(ClientError::new(\"Error al enviar mensaje\")),\n        }\n    }\n\n    pub fn subscribe(\n        message: ClientMessage,\n        packet_id: u16,\n        topic: \u0026str,\n        mut stream: TcpStream,\n        subscriptions: Arc\u003cMutex\u003cHashMap\u003cString, u8\u003e\u003e\u003e,\n    ) -\u003e Result\u003cu16, ClientError\u003e {\n        let sub_id = Client::assign_subscription_id();\n        let topic = topic.to_string();\n\n        let subscriptions = subscriptions.clone();\n\n        subscriptions.lock().unwrap().insert(topic.clone(), sub_id);\n\n        match message.write_to(\u0026mut stream) {\n            Ok(()) =\u003e Ok(packet_id),\n            Err(_) =\u003e Err(ClientError::new(\"Error al enviar mensaje\")),\n        }\n    }\n\n    fn assign_subscription_id() -\u003e u8 {\n        let mut rng = rand::thread_rng();\n\n        let sub_id: u8 = rng.gen();\n\n        sub_id\n    }\n\n    fn assign_user_id() -\u003e u32 {\n        //let mut rng = rand::thread_rng();\n\n        //let user_id: u32 = rng.gen();\n\n        1111\n    }\n\n    pub fn unsubscribe(\n        message: ClientMessage,\n        mut stream: TcpStream,\n        packet_id: u16,\n    ) -\u003e Result\u003cu16, ClientError\u003e {\n        match message.write_to(\u0026mut stream) {\n            Ok(()) =\u003e Ok(packet_id),\n            Err(_) =\u003e Err(ClientError::new(\"Error al enviar mensaje\")),\n        }\n    }\n\n    ///recibe un string que indica la raz√≥n de la desconexi√≥n y un stream y envia un disconnect message al broker\n    /// segun el str reason recibido, modifica el reason_code y el reason_string del mensaje\n    ///\n    /// devuelve el packet_id del mensaje enviado o un ClientError en caso de error\n    pub fn disconnect(reason: \u0026str, mut stream: TcpStream) -\u003e Result\u003cu16, ClientError\u003e {\n        let packet_id = 1;\n        let reason_code: u8;\n        let reason_string: String;\n        match reason {\n            \"normal\" =\u003e {\n                reason_code = 0x00;\n                reason_string =\n                    \"Close the connection normally. Do not send the Will Message.\".to_string();\n            }\n            \"with_will\" =\u003e {\n                reason_code = 0x04;\n                reason_string = \"The Client wishes to disconnect but requires that the Server also publishes its Will Message\"\n                    .to_string();\n            }\n            _ =\u003e {\n                reason_code = 0x80;\n                reason_string = \"The Connection is closed but the sender either does not wish to reveal reason or none of the other Reason Codes apply. \"\n                    .to_string();\n            }\n        }\n        let disconnect = ClientMessage::Disconnect {\n            reason_code,\n            session_expiry_interval: 0,\n            reason_string,\n            user_properties: vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        };\n\n        match disconnect.write_to(\u0026mut stream) {\n            Ok(()) =\u003e Ok(packet_id),\n            Err(_) =\u003e Err(ClientError::new(\"Error al enviar mensaje\")),\n        }\n    }\n\n    /// Se encarga de que el cliente este funcionando correctamente.\n    /// El Client debe encargarse de dos tareas: leer mensajes que le lleguen del Broker.\n    /// Estos mensajes pueden ser tanto acks (Connack, Puback, etc.)\n    /// como pubs que vengan por parte otros clientes (mediante el broker)\n    /// a cuyos topics est√© subscrito.\n    ///\n    /// Su segunda tarea es enviar mensajes:\n    /// puede enviar mensajes como Publish, Suscribe, etc.\n    ///\n    /// Las dos tareas del Client se deben ejecutar concurrentemente,\n    /// por eso su tilizan dos threads(uno de lectura y otro de escritura),\n    /// ambos threads deben compaten el recurso TcpStream.\n    ///\n    /// El thread de escritura (write_messages) recibe por consola los mensajes a enviar.\n    /// Si logra enviar los mensajes correctamente, envia el pacjet id mediante el channel\n    ///\n    /// El thread de lectura (read_messages) se encarga de leer los mensajes que le llegan del broker.\n    pub fn client_run(\u0026mut self) -\u003e Result\u003c(), ProtocolError\u003e {\n        let (sender, receiver) = mpsc::channel();\n\n        let receiver_channel = self.receiver_channel.clone();\n\n        let desconectar = false;\n\n        let pending_messages_clone_one = self.pending_messages.clone();\n\n        let stream_clone_one = match self.stream.try_clone() {\n            Ok(stream) =\u003e stream,\n            Err(_) =\u003e return Err(ProtocolError::StreamError),\n        };\n        let stream_clone_two = match self.stream.try_clone() {\n            Ok(stream) =\u003e stream,\n            Err(_) =\u003e return Err(ProtocolError::StreamError),\n        };\n\n        let threadpool = ThreadPool::new(5);\n\n        let subscriptions_clone = self.subscriptions.clone();\n\n        let _write_messages = threadpool.execute(move || {\n            let pending_messages = pending_messages_clone_one.clone();\n\n            Client::write_messages(\n                stream_clone_one,\n                pending_messages,\n                receiver_channel,\n                desconectar,\n                sender,\n                subscriptions_clone,\n            )\n        });\n\n        let subscriptions_clone = self.subscriptions.clone();\n        let _read_messages = threadpool.execute(move || {\n            Client::receive_messages(stream_clone_two, receiver, subscriptions_clone)\n        });\n\n        Ok(())\n    }\n\n    fn receive_messages(\n        stream: TcpStream,\n        receiver: Receiver\u003cu16\u003e,\n        subscriptions_clone: Arc\u003cMutex\u003cHashMap\u003cString, u8\u003e\u003e\u003e,\n    ) -\u003e Result\u003c(), ProtocolError\u003e {\n        let mut pending_messages = Vec::new();\n\n        loop {\n            if let Ok(packet) = receiver.try_recv() {\n                pending_messages.push(packet);\n            }\n\n            if let Ok(mut stream_clone) = stream.try_clone() {\n                if let Ok(message) = BrokerMessage::read_from(\u0026mut stream_clone) {\n                    match message {\n                        BrokerMessage::Connack {} =\u003e todo!(),\n                        BrokerMessage::Puback {\n                            packet_id_msb,\n                            packet_id_lsb,\n                            reason_code,\n                        } =\u003e {\n                            for pending_message in \u0026pending_messages {\n                                let packet_id_bytes: [u8; 2] = pending_message.to_be_bytes();\n                                if packet_id_bytes[0] == packet_id_msb\n                                    \u0026\u0026 packet_id_bytes[1] == packet_id_lsb\n                                {\n                                    println!(\n                                        \"puback con id {} {} {} recibido\",\n                                        packet_id_msb, packet_id_lsb, reason_code\n                                    );\n                                }\n                            }\n                            println!(\"puback {:?}\", message);\n                        }\n                        BrokerMessage::Disconnect {\n                            reason_code: _,\n                            session_expiry_interval: _,\n                            reason_string,\n                            user_properties: _,\n                        } =\u003e {\n                            println!(\n                                \"Recib√≠ un Disconnect, razon de desconexi√≥n: {:?}\",\n                                reason_string\n                            );\n                            break;\n                        }\n                        BrokerMessage::Suback {\n                            packet_id_msb,\n                            packet_id_lsb,\n                            reason_code: _,\n                            sub_id,\n                        } =\u003e {\n                            for pending_message in \u0026pending_messages {\n                                let packet_id_bytes: [u8; 2] = pending_message.to_be_bytes();\n\n                                if packet_id_bytes[0] == packet_id_msb\n                                    \u0026\u0026 packet_id_bytes[1] == packet_id_lsb\n                                {\n                                    println!(\n                                        \"suback con id {} {} recibido\",\n                                        packet_id_msb, packet_id_lsb\n                                    );\n                                }\n                            }\n\n                            //busca el sub_id 1 en el hash de subscriptions\n                            //si lo encuentra, lo reemplaza por el sub_id que llega en el mensaje\n                            let mut topic = String::new();\n                            let mut lock = subscriptions_clone.lock().unwrap();\n                            for (key, value) in lock.iter() {\n                                if *value == 1 {\n                                    topic.clone_from(key);\n                                }\n                            }\n                            lock.remove(\u0026topic);\n                            lock.insert(topic, sub_id);\n\n                            println!(\"Recibi un mensaje {:?}\", message);\n                        }\n                        BrokerMessage::PublishDelivery {\n                            packet_id,\n                            topic_name: _,\n                            qos: _,\n                            retain_flag: _,\n                            dup_flag: _,\n                            properties: _,\n                            payload,\n                        } =\u003e {\n                            println!(\n                                \"PublishDelivery con id {} recibido, payload: {}\",\n                                packet_id, payload\n                            );\n                        }\n                        BrokerMessage::Unsuback {\n                            packet_id_msb,\n                            packet_id_lsb,\n                            reason_code: _,\n                        } =\u003e {\n                            for pending_message in \u0026pending_messages {\n                                let packet_id_bytes: [u8; 2] = pending_message.to_be_bytes();\n                                if packet_id_bytes[0] == packet_id_msb\n                                    \u0026\u0026 packet_id_bytes[1] == packet_id_lsb\n                                {\n                                    println!(\n                                        \"Unsuback con id {} {} recibido\",\n                                        packet_id_msb, packet_id_lsb\n                                    );\n                                }\n                            }\n\n                            println!(\"Recibi un mensaje {:?}\", message);\n                        }\n                        BrokerMessage::Pingresp =\u003e {\n                            println!(\"Recibi un mensaje {:?}\", message)\n                        }\n                    }\n                }\n            } else {\n                println!(\"Error al clonar el stream\");\n            }\n        }\n        Ok(())\n    }\n\n    fn write_messages(\n        stream: TcpStream,\n        mut pending_messages: Vec\u003cu16\u003e,\n        receiver_channel: Arc\u003cMutex\u003cReceiver\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e\u003e\u003e,\n        mut desconectar: bool,\n        sender: Sender\u003cu16\u003e,\n        subscriptions_clone: Arc\u003cMutex\u003cHashMap\u003cString, u8\u003e\u003e\u003e,\n    ) -\u003e Result\u003c(), ProtocolError\u003e {\n        while !desconectar {\n            loop {\n                let lock = receiver_channel.lock().unwrap();\n                if let Ok(message_config) = lock.recv() {\n                    let packet_id = Client::assign_packet_id(pending_messages.clone());\n\n                    let message = message_config.parse_message(packet_id);\n\n                    match message {\n                        ClientMessage::Connect {\n                            clean_start: _,\n                            last_will_flag: _,\n                            last_will_qos: _,\n                            last_will_retain: _,\n                            keep_alive: _,\n                            properties: _,\n                            client_id: _,\n                            will_properties: _,\n                            last_will_topic: _,\n                            last_will_message: _,\n                            username: _,\n                            password: _,\n                        } =\u003e todo!(),\n                        ClientMessage::Publish {\n                            packet_id,\n                            topic_name,\n                            qos,\n                            retain_flag,\n                            payload,\n                            dup_flag,\n                            properties,\n                        } =\u003e match stream.try_clone() {\n                            Ok(stream_clone) =\u003e {\n                                let publish = ClientMessage::Publish {\n                                    packet_id,\n                                    topic_name,\n                                    qos,\n                                    retain_flag,\n                                    payload,\n                                    dup_flag,\n                                    properties,\n                                };\n\n                                if let Ok(packet_id) =\n                                    Client::publish_message(publish, stream_clone, packet_id)\n                                {\n                                    pending_messages.push(packet_id);\n                                    match sender.send(packet_id) {\n                                        Ok(_) =\u003e continue,\n                                        Err(_) =\u003e {\n                                            println!(\n                                                \"Error al enviar packet_id de puback al receiver\"\n                                            )\n                                        }\n                                    }\n                                }\n                            }\n                            Err(_) =\u003e {\n                                return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                            }\n                        },\n\n                        ClientMessage::Subscribe {\n                            packet_id,\n                            topic_name,\n                            properties,\n                        } =\u003e {\n                            if subscriptions_clone\n                                .lock()\n                                .unwrap()\n                                .contains_key(\u0026topic_name.to_string())\n                            {\n                                println!(\"Ya estoy subscrito a este topic\");\n                            }\n\n                            match stream.try_clone() {\n                                Ok(stream_clone) =\u003e {\n                                    let subscribe = ClientMessage::Subscribe {\n                                        packet_id,\n                                        topic_name: topic_name.clone(),\n                                        properties,\n                                    };\n                                    if let Ok(packet_id) = Client::subscribe(\n                                        subscribe,\n                                        packet_id,\n                                        \u0026topic_name,\n                                        stream_clone,\n                                        subscriptions_clone.clone(),\n                                    ) {\n                                        match sender.send(packet_id) {\n                                            Ok(_) =\u003e {\n                                                let provitional_sub_id = 1;\n                                                let topic_new = topic_name.to_string();\n                                                subscriptions_clone\n                                                    .lock()\n                                                    .unwrap()\n                                                    .insert(topic_new, provitional_sub_id);\n                                            }\n                                            Err(_) =\u003e {\n                                                println!(\n                                                    \"Error al enviar el packet_id del suback al receiver\"\n                                                )\n                                            }\n                                        }\n                                    }\n                                }\n                                Err(_) =\u003e {\n                                    return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                                }\n                            }\n                        }\n                        ClientMessage::Unsubscribe {\n                            packet_id,\n                            topic_name,\n                            properties,\n                        } =\u003e match stream.try_clone() {\n                            Ok(stream_clone) =\u003e {\n                                let unsubscribe = ClientMessage::Unsubscribe {\n                                    packet_id,\n                                    topic_name: topic_name.clone(),\n                                    properties,\n                                };\n\n                                if let Ok(packet_id) =\n                                    Client::unsubscribe(unsubscribe, stream_clone, packet_id)\n                                {\n                                    match sender.send(packet_id) {\n                                        Ok(_) =\u003e {\n                                            let topic_new = topic_name.to_string();\n                                            subscriptions_clone.lock().unwrap().remove(\u0026topic_new);\n                                        }\n                                        Err(_) =\u003e {\n                                            println!(\n                                                    \"Error al enviar el packet_id del unsuback al receiver\"\n                                                )\n                                        }\n                                    }\n                                }\n                            }\n                            Err(_) =\u003e {\n                                return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                            }\n                        },\n\n                        ClientMessage::Disconnect {\n                            reason_code: _,\n                            session_expiry_interval: _,\n                            reason_string: _,\n                            user_properties: _,\n                        } =\u003e {\n                            let reason = \"normal\";\n\n                            match stream.try_clone() {\n                                Ok(stream_clone) =\u003e {\n                                    if let Ok(packet_id) = Client::disconnect(reason, stream_clone)\n                                    {\n                                        match sender.send(packet_id) {\n                                            Ok(_) =\u003e continue,\n                                            Err(_) =\u003e {\n                                                println!(\n                                                    \"Error al enviar packet_id de puback al receiver\"\n                                                )\n                                            }\n                                        }\n                                        desconectar = true;\n                                        break;\n                                    }\n                                }\n                                Err(_) =\u003e {\n                                    return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                                }\n                            }\n                            break;\n                        }\n\n                        ClientMessage::Pingreq =\u003e {\n                            match stream.try_clone() {\n                                Ok(mut stream_clone) =\u003e {\n                                    let pingreq = ClientMessage::Pingreq;\n                                    match pingreq.write_to(\u0026mut stream_clone) {\n                                        //chequear esto\n                                        Ok(()) =\u003e println!(\"Pingreq enviado\"),\n                                        Err(_) =\u003e println!(\"Error al enviar pingreq\"),\n                                    }\n                                }\n                                Err(_) =\u003e {\n                                    return Err::\u003c(), ProtocolError\u003e(ProtocolError::StreamError);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        Ok(())\n    }\n\n    ///Asigna un id al packet que ingresa como parametro.\n    ///Guarda el packet en el hashmap de paquetes.\n    fn assign_packet_id(packets: Vec\u003cu16\u003e) -\u003e u16 {\n        let mut rng = rand::thread_rng();\n\n        let mut packet_id: u16;\n        loop {\n            packet_id = rng.gen();\n            if packet_id != 0 \u0026\u0026 !packets.contains(\u0026packet_id) {\n                break;\n            }\n        }\n        packet_id\n    }\n}\n","traces":[{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":169,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":253,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":269,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":274,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":288,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":289,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":290,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":298,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":306,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":307,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":315,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":316,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":317,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":318,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":322,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":323,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":325,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":329,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":330,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":331,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":332,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":333,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":334,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":335,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":336,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":337,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":338,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":342,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":343,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":346,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":349,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":352,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":353,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":358,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":361,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":366,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":369,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":372,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":381,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":382,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":404,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":405,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":406,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":407,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":408,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":409,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":412,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":423,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":428,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":430,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":438,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":443,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":444,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":445,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":446,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":447,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":450,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":452,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":455,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":456,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":459,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":470,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":472,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":473,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":476,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":479,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":487,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":492,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":493,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":494,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":495,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":496,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":499,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":503,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":507,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":508,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":509,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":512,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":520,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":530,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":532,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":533,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":534,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":537,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":539,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":544,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":545,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":549,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":552,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":556,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":557,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":558,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":559,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":561,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":562,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":566,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":574,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":579,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":580,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":583,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":584,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":585,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":586,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":215},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","client_message.rs"],"content":"use crate::mqtt::subscribe_properties::SubscribeProperties;\nuse std::io::{BufWriter, Error, Read, Write};\n\nuse crate::mqtt::connect_properties::ConnectProperties;\nuse crate::mqtt::publish_properties::{PublishProperties, TopicProperties};\nuse crate::mqtt::will_properties::*;\nuse crate::utils::{reader::*, writer::*};\n\n//use self::quality_of_service::QualityOfService;\nconst PROTOCOL_VERSION: u8 = 5;\nconst SESSION_EXPIRY_INTERVAL_ID: u8 = 0x11;\nconst REASON_STRING_ID: u8 = 0x1F;\nconst USER_PROPERTY_ID: u8 = 0x26;\n\n#[derive(Debug, PartialEq, Clone)]\npub enum ClientMessage {\n    ///El Connect Message es el primer menasje que el cliente envia cuando se conecta al broker. Este contiene toda la informacion necesaria para que el broker identifique al cliente y pueda establecer una sesion con los parametros establecidos.\n    ///\n    /// clean_start especifica si se debe limpiar la sesion previa del cliente y arrancar una nueva limpia y desde cero.\n    ///\n    /// last_will_flag especifica si el will message se debe guardar asociado a la sesion, last_will_qos especifica el QoS level utilizado cuando se publique el will message, last_will_retain especifica si el will message se retiene despues de ser publicado.\n    ///\n    /// keep_alive especifica el tiempo en segundos que el broker debe esperar entre mensajes del cliente antes de desconectarlo.\n    ///\n    /// Si el will flag es true, se escriben el will topic y el will message.\n    ///\n    /// finalmente, si el cliente envia un username y un password, estos se escriben en el payload.\n    Connect {\n        clean_start: bool,\n        last_will_flag: bool,\n        last_will_qos: u8,\n        last_will_retain: bool,\n        keep_alive: u16,\n        properties: ConnectProperties,\n        client_id: String,\n        will_properties: WillProperties,\n        last_will_topic: String,\n        last_will_message: String,\n        username: String,\n        password: String,\n    },\n\n    /// El paquete Publish es enviado desde un cliente al servidor, o desde un servidor al cliente para transportar un mensaje de aplicacion.\n    Publish {\n        packet_id: u16,\n\n        ///Identifica el canal de informacion por el cual el Payload data se va a publicar.\n        topic_name: String,\n\n        ///Indica el nivel de garantia de delivery de un application message.\n        qos: usize,\n\n        /// Si vale 1, el server debe reemplazar cualquier retained message para ese topic\n        /// y guardar este application message.\n        retain_flag: usize,\n\n        ///Es el application message que se esta publicando.\n        ///El contenido y formato de la data es especificado por la aplicacion.\n        payload: String,\n\n        ///Dup flag indica si fue la primera ocasion que el client o el servidor intento enviar este packete.\n        /// Debe ser 0 para todos los mensajes con QoS 0.\n        /// Debe valer 1 para indicar que es el segundo intento de envio del packete.\n        dup_flag: usize,\n\n        /// Una property es un identificador que define el uso y tipos de data, seguido de un valor.\n        properties: PublishProperties,\n    },\n\n    /// El Subscribe Message se utiliza para suscribirse a uno o m√°s topics. El cliente puede enviar un mensaje de subscribe con un packet id y una lista de topics a los que se quiere suscribir. El broker responde con un mensaje de suback con el mismo packet id y una lista de return codes que indican si la suscripcion fue exitosa o no.\n    Subscribe {\n        packet_id: u16,\n        /// topic_name es el nombre del topic al que se quiere suscribir.\n        topic_name: String,\n        /// properties es un struct que contiene las propiedades del mensaje de subscribe.\n        properties: SubscribeProperties,\n    },\n    Unsubscribe {\n        packet_id: u16,\n        topic_name: String,\n        properties: SubscribeProperties,\n    },\n    /// Es el ultimo mensaje que el cliente envia antes de desconectarse, este mensaje contiene informacion sobre la razon de la desconexi√≥n y propiedades adicionales.\n    /// reason_code es el codigo de la razon de la desconexi√≥n.\n    /// session_expiry_interval es el tiempo en segundos que el broker debe mantener la sesion del cliente activa despues de que este se desconecte.\n    /// reason_string es un mensaje de texto que describe la razon de la desconexi√≥n.\n    /// user_properties es un conjunto de propiedades adicionales que el cliente puede enviar.\n    Disconnect {\n        reason_code: u8,\n        session_expiry_interval: u32,\n        reason_string: String,\n        user_properties: Vec\u003c(String, String)\u003e,\n    },\n    Pingreq,\n}\n\n#[allow(dead_code)]\nimpl ClientMessage {\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e std::io::Result\u003c()\u003e {\n        let mut writer = BufWriter::new(stream);\n        match self {\n            ClientMessage::Connect {\n                client_id,\n                clean_start,\n                last_will_flag,\n                last_will_qos,\n                last_will_retain,\n                keep_alive,\n                properties,\n                will_properties,\n                last_will_topic,\n                last_will_message,\n                username,\n                password,\n            } =\u003e {\n                //fixed header\n                self.write_first_packet_byte(\u0026mut writer)?;\n\n                //TODO: aca deberia ir el remaining lenght field\n                //protocol name\n                let protocol_name = \"MQTT\";\n                write_string(\u0026mut writer, protocol_name)?;\n\n                //protocol version\n                let protocol_version: u8 = 0x05;\n                writer.write_all(\u0026[protocol_version])?;\n\n                //connection flags\n                let mut connect_flags: u8 = 0x00;\n                if *clean_start {\n                    connect_flags |= 1 \u003c\u003c 1; //set bit 1 to 1\n                }\n\n                if *last_will_flag {\n                    connect_flags |= 1 \u003c\u003c 2;\n                }\n                if *last_will_qos \u003e 3 {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid last will qos\",\n                    ));\n                }\n                connect_flags |= (last_will_qos \u0026 0b11) \u003c\u003c 3;\n\n                if *last_will_retain {\n                    connect_flags |= 1 \u003c\u003c 5;\n                }\n\n                if !password.is_empty() {\n                    connect_flags |= 1 \u003c\u003c 6;\n                }\n\n                if !username.is_empty() {\n                    connect_flags |= 1 \u003c\u003c 7;\n                }\n\n                writer.write_all(\u0026[connect_flags])?;\n\n                //keep alive\n                write_u16(\u0026mut writer, keep_alive)?;\n                write_string(\u0026mut writer, client_id)?;\n\n                will_properties.write_to(\u0026mut writer)?;\n\n                if *last_will_flag {\n                    write_string(\u0026mut writer, last_will_topic)?;\n                    write_string(\u0026mut writer, last_will_message)?;\n                }\n\n                if !username.is_empty() {\n                    write_string(\u0026mut writer, username)?;\n                }\n                if !password.is_empty() {\n                    write_string(\u0026mut writer, password)?;\n                }\n                properties.write_to(\u0026mut writer)?;\n\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Publish {\n                packet_id: _,\n                topic_name: _,\n                qos: _,\n                retain_flag: _,\n                payload,\n                dup_flag: _,\n                properties: _,\n            } =\u003e {\n                //fixed header\n                self.write_first_packet_byte(\u0026mut writer)?;\n\n                //Remaining Length\n                self.write_packet_properties(\u0026mut writer)?;\n\n                //Payload\n                write_string(\u0026mut writer, payload)?;\n\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Subscribe {\n                packet_id: _,\n                topic_name: _,\n                properties: _,\n            } =\u003e {\n                self.write_first_packet_byte(\u0026mut writer)?;\n                self.write_packet_properties(\u0026mut writer)?;\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Unsubscribe {\n                packet_id: _,\n                topic_name: _,\n                properties: _,\n            } =\u003e {\n                self.write_first_packet_byte(\u0026mut writer)?;\n                self.write_packet_properties(\u0026mut writer)?;\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Disconnect {\n                reason_code,\n                session_expiry_interval,\n                reason_string,\n                user_properties,\n            } =\u003e {\n                //fixed header\n                let header: u8 = 0xE0_u8.to_le(); //11100000\n                write_u8(\u0026mut writer, \u0026header)?;\n\n                //variable_header\n                write_u8(\u0026mut writer, reason_code)?;\n\n                write_u8(\u0026mut writer, \u0026SESSION_EXPIRY_INTERVAL_ID)?;\n                write_u32(\u0026mut writer, session_expiry_interval)?;\n\n                write_u8(\u0026mut writer, \u0026REASON_STRING_ID)?;\n                write_string(\u0026mut writer, reason_string)?;\n\n                write_u8(\u0026mut writer, \u0026USER_PROPERTY_ID)?;\n                write_string_pairs(\u0026mut writer, user_properties)?;\n\n                writer.flush()?;\n                Ok(())\n            }\n            ClientMessage::Pingreq =\u003e {\n                let byte_1: u8 = 0xC0_u8;\n                writer.write_all(\u0026[byte_1])?;\n                writer.flush()?;\n                Ok(())\n            }\n        }\n    }\n\n    fn write_first_packet_byte(\n        \u0026self,\n        writer: \u0026mut BufWriter\u003c\u0026mut dyn Write\u003e,\n    ) -\u003e std::io::Result\u003c()\u003e {\n        match self {\n            ClientMessage::Connect {\n                clean_start: _,\n                last_will_flag: _,\n                last_will_qos: _,\n                last_will_retain: _,\n                keep_alive: _,\n                properties: _,\n                client_id: _,\n                will_properties: _,\n                last_will_topic: _,\n                last_will_message: _,\n                username: _,\n                password: _,\n            } =\u003e {\n                let byte_1: u8 = 0x10_u8.to_le(); //00010000\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Publish {\n                packet_id: _,\n                topic_name: _,\n                qos,\n                retain_flag,\n                payload: _,\n                dup_flag,\n                properties: _,\n            } =\u003e {\n                let mut byte_1 = 0x30_u8;\n\n                if *retain_flag == 1 {\n                    //we must replace any existing retained message for this topic and store\n                    //the app message.\n                    byte_1 |= 1 \u003c\u003c 0;\n                }\n\n                if *qos == 1 {\n                    byte_1 |= 1 \u003c\u003c 1;\n                    byte_1 |= 0 \u003c\u003c 2;\n                } else if *qos != 0x00 \u0026\u0026 *qos != 0x01 {\n                    //we should throw a DISCONNECT with reason code 0x81(Malformed packet).\n                    println!(\"Qos inv√°lido\");\n                }\n\n                if *dup_flag == 1 {\n                    byte_1 |= 1 \u003c\u003c 3;\n                }\n\n                //Dup flag must be set to 0 for all QoS 0 messages.\n                if *qos == 0x00 {\n                    byte_1 |= 0 \u003c\u003c 3;\n                }\n\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Subscribe {\n                packet_id: _,\n                topic_name: _,\n                properties: _,\n            } =\u003e {\n                let byte_1: u8 = 0x82_u8;\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Unsubscribe {\n                packet_id: _,\n                topic_name: _,\n                properties: _,\n            } =\u003e {\n                let byte_1: u8 = 0xA2_u8;\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Disconnect {\n                reason_code: _,\n                session_expiry_interval: _,\n                reason_string: _,\n                user_properties: _,\n            } =\u003e {\n                let byte_1: u8 = 0xE0_u8;\n                writer.write_all(\u0026[byte_1])?;\n            }\n            ClientMessage::Pingreq =\u003e {\n                let byte_1: u8 = 0xC0_u8;\n                writer.write_all(\u0026[byte_1])?;\n            }\n        }\n        Ok(())\n    }\n\n    fn write_packet_properties(\n        \u0026self,\n        writer: \u0026mut BufWriter\u003c\u0026mut dyn Write\u003e,\n    ) -\u003e std::io::Result\u003c()\u003e {\n        match self {\n            ClientMessage::Connect {\n                clean_start: _,\n                last_will_flag: _,\n                last_will_qos: _,\n                last_will_retain: _,\n                keep_alive: _,\n                properties: _,\n                client_id: _,\n                will_properties: _,\n                last_will_topic: _,\n                last_will_message: _,\n                username: _,\n                password: _,\n            } =\u003e todo!(),\n            ClientMessage::Publish {\n                packet_id,\n                topic_name,\n                qos: _,\n                retain_flag: _,\n                payload: _,\n                dup_flag: _,\n                properties,\n            } =\u003e {\n                write_u16(writer, packet_id)?;\n\n                write_string(writer, topic_name)?;\n\n                //Properties\n                properties.write_properties(writer)?;\n            }\n            ClientMessage::Subscribe {\n                packet_id,\n                topic_name,\n                properties,\n            } =\u003e {\n                write_u16(writer, packet_id)?;\n\n                write_string(writer, topic_name)?;\n\n                //Properties\n                properties.write_properties(writer)?;\n            }\n            ClientMessage::Unsubscribe {\n                packet_id,\n                topic_name,\n                properties,\n            } =\u003e {\n                write_u16(writer, packet_id)?;\n\n                write_string(writer, topic_name)?;\n\n                //Properties\n                properties.write_properties(writer)?;\n            }\n            ClientMessage::Disconnect {\n                reason_code,\n                session_expiry_interval,\n                reason_string,\n                user_properties,\n            } =\u003e {\n                //fixed header\n                let header: u8 = 0xE0_u8.to_le(); //11100000\n                write_u8(writer, \u0026header)?;\n                //variable_header\n                write_u8(writer, reason_code)?;\n\n                write_u8(writer, \u0026SESSION_EXPIRY_INTERVAL_ID)?;\n                write_u32(writer, session_expiry_interval)?;\n\n                write_u8(writer, \u0026REASON_STRING_ID)?;\n                write_string(writer, reason_string)?;\n\n                write_u8(writer, \u0026USER_PROPERTY_ID)?;\n                write_string_pairs(writer, user_properties)?;\n                writer.flush()?;\n            }\n            ClientMessage::Pingreq =\u003e {\n                let byte_1: u8 = 0xC0_u8;\n                writer.write_all(\u0026[byte_1])?;\n                writer.flush()?;\n            }\n        }\n\n        Ok(())\n    }\n\n    pub fn read_from(stream: \u0026mut impl Read) -\u003e Result\u003cClientMessage, Error\u003e {\n        let mut header = [0u8; 1];\n        stream.read_exact(\u0026mut header)?;\n\n        let mut header = u8::from_le_bytes(header);\n        let (mut dup_flag, mut qos, mut retain_flag) = (0, 0, 0);\n\n        let first_header_digits = header \u003e\u003e 4;\n        if first_header_digits == 0x3 {\n            let mask = 0b00001111;\n            let last_header_digits = header \u0026 mask;\n\n            header = 0x30_u8.to_le();\n\n            if last_header_digits \u0026 0b00000001 == 0b00000001 {\n                retain_flag = 1;\n            }\n            if last_header_digits \u0026 0b00000010 == 0b00000010 {\n                qos = 1;\n            }\n            if (last_header_digits \u003e\u003e 3) == 1 {\n                dup_flag = 1;\n            }\n        }\n\n        match header {\n            0x10 =\u003e {\n                //leo el protocol name\n\n                let protocol_name = read_string(stream)?;\n\n                if protocol_name != \"MQTT\" {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Nombre de protocolo inv√°lido\",\n                    ));\n                }\n                //protocol version\n                let protocol_version = read_u8(stream)?;\n\n                if protocol_version != PROTOCOL_VERSION {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Version de protocol inv√°lido\",\n                    ));\n                }\n\n                //connect flags\n                let connect_flags = read_u8(stream)?;\n                let clean_start = (connect_flags \u0026 (1 \u003c\u003c 1)) != 0;\n                let last_will_flag = (connect_flags \u0026 (1 \u003c\u003c 2)) != 0;\n                let last_will_qos = (connect_flags \u003e\u003e 3) \u0026 0b11;\n                let last_will_retain = (connect_flags \u0026 (1 \u003c\u003c 5)) != 0;\n\n                //keep alive\n                let keep_alive = read_u16(stream)?;\n                //properties\n                //payload\n                //client ID\n                let client_id = read_string(stream)?;\n                let will_properties = WillProperties::read_from(stream)?;\n\n                let mut last_will_topic = String::new();\n                let mut will_message = String::new();\n                if last_will_flag {\n                    last_will_topic = read_string(stream)?;\n                    will_message = read_string(stream)?;\n                }\n\n                let hay_user = (connect_flags \u0026 (1 \u003c\u003c 7)) != 0;\n                let mut user = String::new();\n                if hay_user {\n                    user = read_string(stream)?;\n                }\n\n                let hay_pass = (connect_flags \u0026 (1 \u003c\u003c 6)) != 0;\n                let mut pass = String::new();\n                if hay_pass {\n                    pass = read_string(stream)?;\n                }\n\n                let properties: ConnectProperties = ConnectProperties::read_from(stream)?;\n                Ok(ClientMessage::Connect {\n                    client_id: client_id.to_string(),\n                    clean_start,\n                    last_will_flag,\n                    last_will_qos,\n                    last_will_retain,\n                    keep_alive,\n                    properties,\n                    will_properties,\n                    last_will_topic: last_will_topic.to_string(),\n                    last_will_message: will_message.to_string(),\n                    username: user.to_string(),\n                    password: pass.to_string(),\n                })\n            }\n            0x30 =\u003e {\n                let topic_properties = TopicProperties {\n                    topic_alias: 10,\n                    response_topic: \"String\".to_string(),\n                };\n\n                let properties = PublishProperties::new(\n                    1,\n                    10,\n                    topic_properties,\n                    [1, 2, 3].to_vec(),\n                    \"a\".to_string(),\n                    1,\n                    \"a\".to_string(),\n                );\n                let packet_id = read_u16(stream)?;\n                let topic_name = read_string(stream)?;\n                PublishProperties::read_from(stream)?;\n                let message = read_string(stream)?;\n                Ok(ClientMessage::Publish {\n                    packet_id,\n                    topic_name,\n                    qos,\n                    retain_flag,\n                    payload: message,\n                    dup_flag,\n                    properties,\n                })\n            }\n            0x82 =\u003e {\n                let packet_id = read_u16(stream)?;\n                let topic = read_string(stream)?;\n                let properties = SubscribeProperties::read_properties(stream)?;\n                Ok(ClientMessage::Subscribe {\n                    packet_id,\n                    topic_name: topic,\n                    properties,\n                })\n            }\n            0xA2 =\u003e {\n                let packet_id = read_u16(stream)?;\n                let topic = read_string(stream)?;\n                let properties = SubscribeProperties::read_properties(stream)?;\n                Ok(ClientMessage::Unsubscribe {\n                    packet_id,\n                    topic_name: topic,\n                    properties,\n                })\n            }\n            0xE0 =\u003e {\n                let reason_code = read_u8(stream)?;\n                let session_expiry_interval_id = read_u8(stream)?;\n                if session_expiry_interval_id != SESSION_EXPIRY_INTERVAL_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid session expiry interval id\",\n                    ));\n                }\n                let session_expiry_interval = read_u32(stream)?;\n\n                let reason_string_id = read_u8(stream)?;\n                if reason_string_id != REASON_STRING_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid reason string id\",\n                    ));\n                }\n                let reason_string = read_string(stream)?;\n\n                let user_property_id = read_u8(stream)?;\n                if user_property_id != USER_PROPERTY_ID {\n                    return Err(Error::new(\n                        std::io::ErrorKind::Other,\n                        \"Invalid user property id\",\n                    ));\n                }\n                let user_properties = read_string_pairs(stream)?;\n\n                Ok(ClientMessage::Disconnect {\n                    reason_code,\n                    session_expiry_interval,\n                    reason_string,\n                    user_properties,\n                })\n            }\n            0xC0 =\u003e Ok(ClientMessage::Pingreq),\n            _ =\u003e Err(Error::new(std::io::ErrorKind::Other, \"Invalid header\")),\n        }\n    }\n\n    // pub fn analize_packet_id(\u0026self, packet: u16) -\u003e bool {\n    //     match self {\n    //         ClientMessage::Connect { clean_start, last_will_flag, last_will_qos, last_will_retain, keep_alive, properties, client_id, will_properties, last_will_topic, last_will_message, username, password } =\u003e todo!(),\n    //         ClientMessage::Publish { packet_id, topic_name, qos, retain_flag, payload, dup_flag, properties } =\u003e {\n    //             if *packet_id == packet {\n    //                 return true;\n    //             }\n    //             false\n    //         },\n    //         ClientMessage::Subscribe { packet_id, topic_name, properties } =\u003e {\n    //             if *packet_id == packet {\n    //                 return true;\n    //             }\n    //             false\n    //         },\n    //     }\n    // }\n}\n\n#[cfg(test)]\nmod tests {\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_01_connect_message_ok() {\n        let connect_propierties = ConnectProperties {\n            session_expiry_interval: 1,\n            receive_maximum: 2,\n            maximum_packet_size: 10,\n            topic_alias_maximum: 99,\n            request_response_information: true,\n            request_problem_information: false,\n            user_properties: vec![\n                (\"Hola\".to_string(), \"Mundo\".to_string()),\n                (\"Chau\".to_string(), \"Mundo\".to_string()),\n            ],\n            authentication_method: \"test\".to_string(),\n            authentication_data: vec![1_u8, 2_u8, 3_u8, 4_u8, 5_u8],\n        };\n        let will_properties = WillProperties::new(\n            120,\n            1,\n            30,\n            \"plain\".to_string(),\n            \"topic\".to_string(),\n            vec![1, 2, 3, 4, 5],\n            vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        );\n        let connect = ClientMessage::Connect {\n            clean_start: true,\n            last_will_flag: true,\n            last_will_qos: 1,\n            last_will_retain: true,\n            keep_alive: 35,\n            properties: connect_propierties,\n            client_id: \"kvtr33\".to_string(),\n            will_properties,\n            last_will_topic: \"topic\".to_string(),\n            last_will_message: \"chauchis\".to_string(),\n            username: \"prueba\".to_string(),\n            password: \"\".to_string(),\n        };\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match connect.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n\n        cursor.set_position(0);\n\n        match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(read_connect) =\u003e {\n                assert_eq!(connect, read_connect);\n            }\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        }\n    }\n\n    #[test]\n    fn test_02_connect_without_props_err() {\n        let connect_properties = ConnectProperties {\n            session_expiry_interval: 0,\n            receive_maximum: 0,\n            maximum_packet_size: 0,\n            topic_alias_maximum: 0,\n            request_response_information: false,\n            request_problem_information: false,\n            user_properties: vec![],\n            authentication_method: \"\".to_string(),\n            authentication_data: vec![],\n        };\n\n        let connect = ClientMessage::Connect {\n            clean_start: true,\n            last_will_flag: true,\n            last_will_qos: 1,\n            last_will_retain: true,\n            keep_alive: 35,\n            properties: connect_properties,\n            client_id: \"kvtr33\".to_string(),\n            will_properties: WillProperties::new(\n                0,\n                1,\n                0,\n                \"\".to_string(),\n                \"\".to_string(),\n                vec![],\n                vec![],\n            ),\n            last_will_topic: \"topic\".to_string(),\n            last_will_message: \"chauchis\".to_string(),\n            username: \"prueba\".to_string(),\n            password: \"\".to_string(),\n        };\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match connect.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n        cursor.set_position(0);\n\n        match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(read_connect) =\u003e {\n                assert_eq!(connect, read_connect);\n            }\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        }\n    }\n\n    #[test]\n    fn test_03_publish_message_ok() {\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let properties = PublishProperties::new(\n            1,\n            10,\n            topic_properties,\n            [1, 2, 3].to_vec(),\n            \"a\".to_string(),\n            1,\n            \"a\".to_string(),\n        );\n\n        let publish = ClientMessage::Publish {\n            packet_id: 1,\n            topic_name: \"mensajes para juan\".to_string(),\n            qos: 1,\n            retain_flag: 1,\n            payload: \"hola soy juan\".to_string(),\n            dup_flag: 1,\n            properties,\n        };\n\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match publish.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n        cursor.set_position(0);\n\n        match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(read_publish) =\u003e {\n                println!(\"{:?}\", read_publish);\n                assert_eq!(publish, read_publish);\n            }\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        }\n    }\n\n    #[test]\n    fn test_04_subscribe_ok() {\n        let sub = ClientMessage::Subscribe {\n            packet_id: 1,\n            topic_name: \"topico\".to_string(),\n            properties: SubscribeProperties::new(\n                1,\n                vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n                vec![0, 1, 2, 3],\n            ),\n        };\n\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match sub.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n        cursor.set_position(0);\n        let read_sub = match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(sub) =\u003e sub,\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        };\n        assert_eq!(sub, read_sub);\n    }\n\n    #[test]\n    fn test_05_disconnect_ok() {\n        let disconect = ClientMessage::Disconnect {\n            reason_code: 1,\n            session_expiry_interval: 1,\n            reason_string: \"hola\".to_string(),\n            user_properties: vec![(\"hola\".to_string(), \"mundo\".to_string())],\n        };\n\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match disconect.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                panic!(\"no se pudo escribir en el cursor {:?}\", e);\n            }\n        }\n        cursor.set_position(0);\n        let read_disconect = match ClientMessage::read_from(\u0026mut cursor) {\n            Ok(disconect) =\u003e disconect,\n            Err(e) =\u003e {\n                panic!(\"no se pudo leer del cursor {:?}\", e);\n            }\n        };\n        assert_eq!(disconect, read_disconect);\n    }\n}\n","traces":[{"line":99,"address":[],"length":0,"stats":{"Line":26},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":26},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":26},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":110,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":114,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":149,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":157,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":161,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":165,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":186,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":187,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":188,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":189,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":191,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":194,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":197,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":199,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":200,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":209,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":217,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":225,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":229,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":233,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":241,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":242,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":244,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":248,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":249,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":283,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":284,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":289,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":292,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":295,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":296,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":297,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":298,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":300,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":303,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":304,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":308,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":309,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":312,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":319,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":320,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":327,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":328,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":336,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":337,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":340,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":341,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":344,"address":[],"length":0,"stats":{"Line":19},"fn_name":null},{"line":347,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":351,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":367,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":368,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":369,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":370,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":371,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":372,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":373,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":374,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":375,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":377,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":380,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":383,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":384,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":385,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":386,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":387,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":389,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":392,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":395,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":396,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":397,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":398,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":399,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":401,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":404,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":407,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":408,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":409,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":410,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":411,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":413,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":414,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":416,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":418,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":419,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":421,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":422,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":424,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":425,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":426,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":429,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":430,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":431,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":435,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":438,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":439,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":440,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":442,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":443,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":445,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":446,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":447,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":448,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":450,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":452,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":453,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":455,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":456,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":458,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":459,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":463,"address":[],"length":0,"stats":{"Line":30},"fn_name":null},{"line":467,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":470,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":471,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":472,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":476,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":479,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":480,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":481,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":486,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":493,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":497,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":498,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":503,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":504,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":507,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":508,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":509,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":510,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":513,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":514,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":515,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":516,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":519,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":520,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":521,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":522,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":523,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":524,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":525,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":526,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":527,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":528,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":529,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":530,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":531,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":532,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":538,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":544,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":545,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":546,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":548,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":550,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":551,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":552,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":553,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":554,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":555,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":556,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":557,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":558,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":559,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":560,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":561,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":565,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":566,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":567,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":568,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":569,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":570,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":571,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":575,"address":[],"length":0,"stats":{"Line":6},"fn_name":null},{"line":576,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":577,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":578,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":579,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":580,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":581,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":585,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":586,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":588,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":589,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":590,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":593,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":595,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":597,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":598,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":599,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":602,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":604,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":606,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":607,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":608,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":611,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":613,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":614,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":615,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":616,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":617,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":620,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":621,"address":[],"length":0,"stats":{"Line":4},"fn_name":null}],"covered":227,"coverable":273},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","connack_properties.rs"],"content":"use crate::mqtt::reader::*;\nuse crate::mqtt::writer::*;\nuse std::io::{BufReader, BufWriter, Error, ErrorKind, Read, Write};\n\n#[derive(Debug, PartialEq)]\npub struct ConnackProperties {\n    session_expiry_interval: u32,\n    receive_maximum: u16,\n    maximum_qos: bool,\n    retain_available: bool,\n    maximum_packet_size: u32,\n    assigned_client_identifier: String,\n    topic_alias_maximum: u16,\n    reason_string: String,\n    user_properties: Vec\u003c(String, String)\u003e,\n    wildcard_subscription_available: bool,\n    subscription_identifier_available: bool,\n    shared_subscription_available: bool,\n    server_keep_alive: u16,\n    response_information: String,\n    server_reference: String,\n    authentication_method: String,\n    authentication_data: Vec\u003cu8\u003e,\n}\n\nimpl ConnackProperties {\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e Result\u003c(), Error\u003e {\n        let mut writer = BufWriter::new(stream);\n\n        let session_expiry_interval_id: u8 = 0x11_u8; //17\n        print!(\n            \"session_expiry_interval_id: {:?}\",\n            session_expiry_interval_id\n        );\n        writer.write_all(\u0026[session_expiry_interval_id])?;\n        write_u32(\u0026mut writer, \u0026self.session_expiry_interval)?;\n\n        let assigned_client_identifier_id: u8 = 0x12_u8; //18\n        print!(\n            \"assigned_client_identifier_id: {:?}\",\n            assigned_client_identifier_id\n        );\n        writer.write_all(\u0026[assigned_client_identifier_id])?;\n        write_string(\u0026mut writer, \u0026self.assigned_client_identifier)?;\n\n        let authentication_method_id: u8 = 0x15_u8; //21\n        print!(\"authentication_method_id: {:?}\", authentication_method_id);\n        writer.write_all(\u0026[authentication_method_id])?;\n        write_string(\u0026mut writer, \u0026self.authentication_method)?;\n\n        let authentication_data_id: u8 = 0x16_u8; //22\n        print!(\"authentication_data_id: {:?}\", authentication_data_id);\n        writer.write_all(\u0026[authentication_data_id])?;\n        write_bin_vec(\u0026mut writer, \u0026self.authentication_data)?;\n\n        let response_information_id: u8 = 0x1A_u8; //26\n        print!(\"response_information_id: {:?}\", response_information_id);\n        writer.write_all(\u0026[response_information_id])?;\n        write_string(\u0026mut writer, \u0026self.response_information)?;\n\n        let server_reference_id: u8 = 0x1C_u8; //28\n        print!(\"server_reference_id: {:?}\", server_reference_id);\n        writer.write_all(\u0026[server_reference_id])?;\n        write_string(\u0026mut writer, \u0026self.server_reference)?;\n\n        let reason_string_id: u8 = 0x1F_u8; //31\n        print!(\"reason_string_id: {:?}\", reason_string_id);\n        writer.write_all(\u0026[reason_string_id])?;\n        write_string(\u0026mut writer, \u0026self.reason_string)?;\n\n        let receive_maximum_id: u8 = 0x21_u8; //33\n        print!(\"receive_maximum_id: {:?}\", receive_maximum_id);\n        writer.write_all(\u0026[receive_maximum_id])?;\n        write_u16(\u0026mut writer, \u0026self.receive_maximum)?;\n\n        let topic_alias_maximum_id: u8 = 0x22_u8; //34\n        print!(\"topic_alias_maximum_id: {:?}\", topic_alias_maximum_id);\n        writer.write_all(\u0026[topic_alias_maximum_id])?;\n        write_u16(\u0026mut writer, \u0026self.topic_alias_maximum)?;\n\n        let maximum_qos_id: u8 = 0x24_u8; //36\n        print!(\"maximum_qos_id: {:?}\", maximum_qos_id);\n        writer.write_all(\u0026[maximum_qos_id])?;\n        write_bool(\u0026mut writer, \u0026self.maximum_qos)?;\n\n        let retain_available_id: u8 = 0x25_u8; //37\n        print!(\"retain_available_id: {:?}\", retain_available_id);\n        writer.write_all(\u0026[retain_available_id])?;\n        write_bool(\u0026mut writer, \u0026self.retain_available)?;\n\n        let user_properties_id: u8 = 0x26_u8; //38\n        print!(\"user_properties_id: {:?}\", user_properties_id);\n        writer.write_all(\u0026[user_properties_id])?;\n        write_tuple_vec(\u0026mut writer, \u0026self.user_properties)?;\n\n        let maximum_packet_size_id: u8 = 0x27_u8; //39\n        print!(\"maximum_packet_size_id: {:?}\", maximum_packet_size_id);\n        writer.write_all(\u0026[maximum_packet_size_id])?;\n        write_u32(\u0026mut writer, \u0026self.maximum_packet_size)?;\n\n        let wildcard_subscription_available_id: u8 = 0x28_u8; //40\n        print!(\n            \"wildcard_subscription_available_id: {:?}\",\n            wildcard_subscription_available_id\n        );\n        writer.write_all(\u0026[wildcard_subscription_available_id])?;\n        write_bool(\u0026mut writer, \u0026self.wildcard_subscription_available)?;\n\n        let subscription_identifier_available_id: u8 = 0x29_u8; //41\n        print!(\n            \"subscription_identifier_available_id: {:?}\",\n            subscription_identifier_available_id\n        );\n        writer.write_all(\u0026[subscription_identifier_available_id])?;\n        write_bool(\u0026mut writer, \u0026self.subscription_identifier_available)?;\n\n        let shared_subscription_available_id: u8 = 0x2A_u8; //42\n        print!(\n            \"shared_subscription_available_id: {:?}\",\n            shared_subscription_available_id\n        );\n        writer.write_all(\u0026[shared_subscription_available_id])?;\n        write_bool(\u0026mut writer, \u0026self.shared_subscription_available)?;\n\n        let server_keep_alive_id: u8 = 0x2D_u8; //45\n        print!(\"server_keep_alive_id: {:?}\", server_keep_alive_id);\n        writer.write_all(\u0026[server_keep_alive_id])?;\n        write_u16(\u0026mut writer, \u0026self.server_keep_alive)?;\n\n        Ok(())\n    }\n\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cConnackProperties, Error\u003e {\n        let mut reader = BufReader::new(stream);\n\n        let mut session_expiry_interval: Option\u003cu32\u003e = None;\n        let mut receive_maximum: Option\u003cu16\u003e = None;\n        let mut maximum_qos: Option\u003cbool\u003e = None;\n        let mut retain_available: Option\u003cbool\u003e = None;\n        let mut maximum_packet_size: Option\u003cu32\u003e = None;\n        let mut assigned_client_identifier: Option\u003cString\u003e = None;\n        let mut topic_alias_maximum: Option\u003cu16\u003e = None;\n        let mut reason_string: Option\u003cString\u003e = None;\n        let mut user_properties: Option\u003cVec\u003c(String, String)\u003e\u003e = None;\n        let mut wildcard_subscription_available: Option\u003cbool\u003e = None;\n        let mut subscription_identifier_available: Option\u003cbool\u003e = None;\n        let mut shared_subscription_available: Option\u003cbool\u003e = None;\n        let mut server_keep_alive: Option\u003cu16\u003e = None;\n        let mut response_information: Option\u003cString\u003e = None;\n        let mut server_reference: Option\u003cString\u003e = None;\n        let mut authentication_method: Option\u003cString\u003e = None;\n        let mut authentication_data: Option\u003cVec\u003cu8\u003e\u003e = None;\n\n        let mut count = 0;\n        while let Ok(property_id) = read_u8(\u0026mut reader) {\n            match property_id {\n                0x11 =\u003e {\n                    let value = read_u32(\u0026mut reader)?;\n                    session_expiry_interval = Some(value);\n                }\n                0x12 =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    assigned_client_identifier = Some(value);\n                }\n                0x15 =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    authentication_method = Some(value);\n                }\n                0x16 =\u003e {\n                    let value = read_bin_vec(\u0026mut reader)?;\n                    authentication_data = Some(value);\n                }\n                0x1A =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    response_information = Some(value);\n                }\n                0x1C =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    server_reference = Some(value);\n                }\n                0x1F =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    reason_string = Some(value);\n                }\n                0x21 =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    receive_maximum = Some(value);\n                }\n                0x22 =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    topic_alias_maximum = Some(value);\n                }\n                0x24 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    maximum_qos = Some(value);\n                }\n                0x25 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    retain_available = Some(value);\n                }\n                0x26 =\u003e {\n                    let value = read_tuple_vec(\u0026mut reader)?;\n                    user_properties = Some(value);\n                }\n                0x27 =\u003e {\n                    let value = read_u32(\u0026mut reader)?;\n                    maximum_packet_size = Some(value);\n                }\n                0x28 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    wildcard_subscription_available = Some(value);\n                }\n                0x29 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    subscription_identifier_available = Some(value);\n                }\n                0x2A =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    shared_subscription_available = Some(value);\n                }\n                0x2D =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    server_keep_alive = Some(value);\n                }\n                _ =\u003e {\n                    return Err(Error::new(\n                        ErrorKind::InvalidData,\n                        format!(\"Invalid property id: {:?}\", property_id),\n                    ));\n                }\n            }\n            count += 1;\n            if count == 17 {\n                break;\n            }\n        }\n\n        Ok(ConnackProperties {\n            session_expiry_interval: session_expiry_interval.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing session_expiry_interval property\",\n            ))?,\n            receive_maximum: receive_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing receive_maximum property\",\n            ))?,\n            maximum_packet_size: maximum_packet_size.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_packet_size property\",\n            ))?,\n            topic_alias_maximum: topic_alias_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing topic_alias_maximum property\",\n            ))?,\n            user_properties: user_properties.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing user_properties property\",\n            ))?,\n            authentication_method: authentication_method.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_method property\",\n            ))?,\n            authentication_data: authentication_data.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_data property\",\n            ))?,\n            maximum_qos: maximum_qos.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_qos property\",\n            ))?,\n            retain_available: retain_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing retain_available property\",\n            ))?,\n            assigned_client_identifier: assigned_client_identifier.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing assigned_client_identifier property\",\n            ))?,\n            reason_string: reason_string.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing reason_string property\",\n            ))?,\n            wildcard_subscription_available: wildcard_subscription_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing wildcard_subscription_available property\",\n            ))?,\n            subscription_identifier_available: subscription_identifier_available.ok_or(\n                Error::new(\n                    ErrorKind::InvalidData,\n                    \"Missing subscription_identifier_available property\",\n                ),\n            )?,\n            shared_subscription_available: shared_subscription_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing shared_subscription_available property\",\n            ))?,\n            server_keep_alive: server_keep_alive.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing server_keep_alive property\",\n            ))?,\n            response_information: response_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing response_information property\",\n            ))?,\n            server_reference: server_reference.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing server_reference property\",\n            ))?,\n        })\n    }\n}\n\npub struct ConnackPropertiesBuilder {\n    session_expiry_interval: Option\u003cu32\u003e,\n    receive_maximum: Option\u003cu16\u003e,\n    maximum_qos: Option\u003cbool\u003e,\n    retain_available: Option\u003cbool\u003e,\n    maximum_packet_size: Option\u003cu32\u003e,\n    assigned_client_identifier: Option\u003cString\u003e,\n    topic_alias_maximum: Option\u003cu16\u003e,\n    reason_string: Option\u003cString\u003e,\n    user_properties: Option\u003cVec\u003c(String, String)\u003e\u003e,\n    wildcard_subscription_available: Option\u003cbool\u003e,\n    subscription_identifier_available: Option\u003cbool\u003e,\n    shared_subscription_available: Option\u003cbool\u003e,\n    server_keep_alive: Option\u003cu16\u003e,\n    response_information: Option\u003cString\u003e,\n    server_reference: Option\u003cString\u003e,\n    authentication_method: Option\u003cString\u003e,\n    authentication_data: Option\u003cVec\u003cu8\u003e\u003e,\n}\n\nimpl Default for ConnackPropertiesBuilder {\n    fn default() -\u003e Self {\n        ConnackPropertiesBuilder::new()\n    }\n}\n\nimpl ConnackPropertiesBuilder {\n    pub fn new() -\u003e ConnackPropertiesBuilder {\n        ConnackPropertiesBuilder {\n            session_expiry_interval: None,\n            receive_maximum: None,\n            maximum_qos: None,\n            retain_available: None,\n            maximum_packet_size: None,\n            assigned_client_identifier: None,\n            topic_alias_maximum: None,\n            reason_string: None,\n            user_properties: None,\n            wildcard_subscription_available: None,\n            subscription_identifier_available: None,\n            shared_subscription_available: None,\n            server_keep_alive: None,\n            response_information: None,\n            server_reference: None,\n            authentication_method: None,\n            authentication_data: None,\n        }\n    }\n\n    pub fn session_expiry_interval(mut self, value: u32) -\u003e Self {\n        self.session_expiry_interval = Some(value);\n        self\n    }\n\n    pub fn receive_maximum(mut self, value: u16) -\u003e Self {\n        self.receive_maximum = Some(value);\n        self\n    }\n\n    pub fn maximum_qos(mut self, value: bool) -\u003e Self {\n        self.maximum_qos = Some(value);\n        self\n    }\n\n    pub fn retain_available(mut self, value: bool) -\u003e Self {\n        self.retain_available = Some(value);\n        self\n    }\n\n    pub fn maximum_packet_size(mut self, value: u32) -\u003e Self {\n        self.maximum_packet_size = Some(value);\n        self\n    }\n\n    pub fn assigned_client_identifier(mut self, value: String) -\u003e Self {\n        self.assigned_client_identifier = Some(value);\n        self\n    }\n\n    pub fn topic_alias_maximum(mut self, value: u16) -\u003e Self {\n        self.topic_alias_maximum = Some(value);\n        self\n    }\n\n    pub fn reason_string(mut self, value: String) -\u003e Self {\n        self.reason_string = Some(value);\n        self\n    }\n\n    pub fn user_properties(mut self, value: Vec\u003c(String, String)\u003e) -\u003e Self {\n        self.user_properties = Some(value);\n        self\n    }\n\n    pub fn wildcard_subscription_available(mut self, value: bool) -\u003e Self {\n        self.wildcard_subscription_available = Some(value);\n        self\n    }\n\n    pub fn subscription_identifier_available(mut self, value: bool) -\u003e Self {\n        self.subscription_identifier_available = Some(value);\n        self\n    }\n\n    pub fn shared_subscription_available(mut self, value: bool) -\u003e Self {\n        self.shared_subscription_available = Some(value);\n        self\n    }\n\n    pub fn server_keep_alive(mut self, value: u16) -\u003e Self {\n        self.server_keep_alive = Some(value);\n        self\n    }\n\n    pub fn response_information(mut self, value: String) -\u003e Self {\n        self.response_information = Some(value);\n        self\n    }\n\n    pub fn server_reference(mut self, value: String) -\u003e Self {\n        self.server_reference = Some(value);\n        self\n    }\n\n    pub fn authentication_method(mut self, value: String) -\u003e Self {\n        self.authentication_method = Some(value);\n        self\n    }\n\n    pub fn authentication_data(mut self, value: Vec\u003cu8\u003e) -\u003e Self {\n        self.authentication_data = Some(value);\n        self\n    }\n\n    pub fn build(self) -\u003e Result\u003cConnackProperties, Error\u003e {\n        Ok(ConnackProperties {\n            session_expiry_interval: self.session_expiry_interval.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing session_expiry_interval property\",\n            ))?,\n            receive_maximum: self.receive_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing receive_maximum property\",\n            ))?,\n            maximum_qos: self.maximum_qos.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_qos property\",\n            ))?,\n            retain_available: self.retain_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing retain_available property\",\n            ))?,\n            maximum_packet_size: self.maximum_packet_size.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_packet_size property\",\n            ))?,\n            assigned_client_identifier: self.assigned_client_identifier.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing assigned_client_identifier property\",\n            ))?,\n            topic_alias_maximum: self.topic_alias_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing topic_alias_maximum property\",\n            ))?,\n            reason_string: self.reason_string.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing reason_string property\",\n            ))?,\n            user_properties: self.user_properties.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing user_properties property\",\n            ))?,\n            wildcard_subscription_available: self.wildcard_subscription_available.ok_or(\n                Error::new(\n                    ErrorKind::InvalidData,\n                    \"Missing wildcard_subscription_available property\",\n                ),\n            )?,\n            subscription_identifier_available: self.subscription_identifier_available.ok_or(\n                Error::new(\n                    ErrorKind::InvalidData,\n                    \"Missing subscription_identifier_available property\",\n                ),\n            )?,\n            shared_subscription_available: self.shared_subscription_available.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing shared_subscription_available property\",\n            ))?,\n            server_keep_alive: self.server_keep_alive.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing server_keep_alive property\",\n            ))?,\n            response_information: self.response_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing response_information property\",\n            ))?,\n            server_reference: self.server_reference.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing server_reference property\",\n            ))?,\n            authentication_method: self.authentication_method.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_method property\",\n            ))?,\n            authentication_data: self.authentication_data.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_data property\",\n            ))?,\n        })\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","connect_config.rs"],"content":"use crate::mqtt::{connect_properties::ConnectProperties, will_properties::WillProperties};\n\nuse super::{client_message::ClientMessage, messages_config::MessagesConfig};\n\npub struct ConnectConfig {\n    pub(crate) clean_start: bool,\n    pub(crate) last_will_flag: bool,\n    pub(crate) last_will_qos: u8,\n    pub(crate) last_will_retain: bool,\n    pub(crate) keep_alive: u16,\n    pub(crate) properties: ConnectProperties,\n    pub(crate) client_id: String,\n    pub(crate) will_properties: WillProperties,\n    pub(crate) last_will_topic: String,\n    pub(crate) last_will_message: String,\n    pub(crate) username: String,\n    pub(crate) password: String,\n}\n\nimpl MessagesConfig for ConnectConfig {\n    fn parse_message(\u0026self, _packet_id: u16) -\u003e ClientMessage {\n        ClientMessage::Connect {\n            clean_start: self.clean_start,\n            last_will_flag: self.last_will_flag,\n            last_will_qos: self.last_will_qos,\n            last_will_retain: self.last_will_retain,\n            keep_alive: self.keep_alive,\n            properties: self.properties.clone(),\n            client_id: self.client_id.clone(),\n            will_properties: self.will_properties.clone(),\n            last_will_topic: self.last_will_topic.clone(),\n            last_will_message: self.last_will_message.clone(),\n            username: self.username.clone(),\n            password: self.password.clone(),\n        }\n    }\n}\n\nimpl ConnectConfig {\n    #[allow(clippy::too_many_arguments)]\n    pub fn new(\n        clean_start: bool,\n        last_will_flag: bool,\n        last_will_qos: u8,\n        last_will_retain: bool,\n        keep_alive: u16,\n        properties: ConnectProperties,\n        client_id: String,\n        will_properties: WillProperties,\n        last_will_topic: String,\n        last_will_message: String,\n        username: String,\n        password: String,\n    ) -\u003e ConnectConfig {\n        ConnectConfig {\n            clean_start,\n            last_will_flag,\n            last_will_qos,\n            last_will_retain,\n            keep_alive,\n            properties,\n            client_id,\n            will_properties,\n            last_will_topic,\n            last_will_message,\n            username,\n            password,\n        }\n    }\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":14},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","connect_properties.rs"],"content":"use crate::utils::{reader::*, writer::*};\n\nuse std::io::{BufReader, BufWriter, Error, ErrorKind, Read, Write};\n\n#[derive(Debug, PartialEq, Clone)]\npub struct ConnectProperties {\n    pub session_expiry_interval: u32,\n    pub receive_maximum: u16,\n    pub maximum_packet_size: u32,\n    pub topic_alias_maximum: u16,\n    pub request_response_information: bool,\n    pub request_problem_information: bool,\n    pub user_properties: Vec\u003c(String, String)\u003e,\n    pub authentication_method: String,\n    pub authentication_data: Vec\u003cu8\u003e,\n}\n\nimpl ConnectProperties {\n    #[allow(clippy::too_many_arguments)]\n    pub fn new(\n        session_expiry_interval: u32,\n        receive_maximum: u16,\n        maximum_packet_size: u32,\n        topic_alias_maximum: u16,\n        request_response_information: bool,\n        request_problem_information: bool,\n        user_properties: Vec\u003c(String, String)\u003e,\n        authentication_method: String,\n        authentication_data: Vec\u003cu8\u003e,\n    ) -\u003e ConnectProperties {\n        ConnectProperties {\n            session_expiry_interval,\n            receive_maximum,\n            maximum_packet_size,\n            topic_alias_maximum,\n            request_response_information,\n            request_problem_information,\n            user_properties,\n            authentication_method,\n            authentication_data,\n        }\n    }\n\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e Result\u003c(), Error\u003e {\n        let mut writer = BufWriter::new(stream);\n\n        let session_expiry_interval_id: u8 = 0x11_u8;\n\n        writer.write_all(\u0026[session_expiry_interval_id])?;\n        write_u32(\u0026mut writer, \u0026self.session_expiry_interval)?;\n\n        let authentication_method_id: u8 = 0x15_u8;\n        writer.write_all(\u0026[authentication_method_id])?;\n        write_string(\u0026mut writer, \u0026self.authentication_method)?;\n\n        let authentication_data_id: u8 = 0x16_u8;\n        writer.write_all(\u0026[authentication_data_id])?;\n        write_bin_vec(\u0026mut writer, \u0026self.authentication_data)?;\n\n        let request_problem_information_id: u8 = 0x17_u8;\n        writer.write_all(\u0026[request_problem_information_id])?;\n        write_bool(\u0026mut writer, \u0026self.request_problem_information)?;\n\n        let request_response_information_id: u8 = 0x19_u8; // 25\n\n        writer.write_all(\u0026[request_response_information_id])?;\n        write_bool(\u0026mut writer, \u0026self.request_response_information)?;\n\n        let receive_maximum_id: u8 = 0x21_u8; // 33\n        writer.write_all(\u0026[receive_maximum_id])?;\n        write_u16(\u0026mut writer, \u0026self.receive_maximum)?;\n\n        let topic_alias_maximum_id: u8 = 0x22_u8; // 34\n        writer.write_all(\u0026[topic_alias_maximum_id])?;\n        write_u16(\u0026mut writer, \u0026self.topic_alias_maximum)?;\n\n        let user_properties_id: u8 = 0x26_u8; // 38\n        writer.write_all(\u0026[user_properties_id])?;\n        write_tuple_vec(\u0026mut writer, \u0026self.user_properties)?;\n\n        let maximum_packet_size_id: u8 = 0x27_u8; // 39\n        writer.write_all(\u0026[maximum_packet_size_id])?;\n        write_u32(\u0026mut writer, \u0026self.maximum_packet_size)?;\n\n        Ok(())\n    }\n\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cConnectProperties, Error\u003e {\n        let mut reader = BufReader::new(stream);\n\n        let mut session_expiry_interval: Option\u003cu32\u003e = None;\n        let mut receive_maximum: Option\u003cu16\u003e = None;\n        let mut maximum_packet_size: Option\u003cu32\u003e = None;\n        let mut topic_alias_maximum: Option\u003cu16\u003e = None;\n        let mut request_response_information: Option\u003cbool\u003e = None;\n        let mut request_problem_information: Option\u003cbool\u003e = None;\n        let mut user_properties: Option\u003cVec\u003c(String, String)\u003e\u003e = None;\n        let mut authentication_method: Option\u003cString\u003e = None;\n        let mut authentication_data: Option\u003cVec\u003cu8\u003e\u003e = None;\n        let mut count = 0;\n        while let Ok(property_id) = read_u8(\u0026mut reader) {\n            match property_id {\n                0x11 =\u003e {\n                    let value = read_u32(\u0026mut reader)?;\n                    session_expiry_interval = Some(value);\n                }\n                0x15 =\u003e {\n                    let value = read_string(\u0026mut reader)?;\n                    authentication_method = Some(value);\n                }\n                0x16 =\u003e {\n                    let value = read_bin_vec(\u0026mut reader)?;\n                    authentication_data = Some(value);\n                }\n                0x17 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    request_problem_information = Some(value);\n                }\n                0x19 =\u003e {\n                    let value = read_bool(\u0026mut reader)?;\n                    request_response_information = Some(value);\n                }\n                0x21 =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    receive_maximum = Some(value);\n                }\n                0x22 =\u003e {\n                    let value = read_u16(\u0026mut reader)?;\n                    topic_alias_maximum = Some(value);\n                }\n                0x26 =\u003e {\n                    let value = read_tuple_vec(\u0026mut reader)?;\n                    user_properties = Some(value);\n                }\n                0x27 =\u003e {\n                    let value = read_u32(\u0026mut reader)?;\n                    maximum_packet_size = Some(value);\n                }\n                _ =\u003e {\n                    return Err(Error::new(ErrorKind::InvalidData, \"Property ID inv√°lido\"));\n                }\n            }\n            count += 1;\n            if count == 9 {\n                break;\n            }\n        }\n\n        Ok(ConnectProperties {\n            session_expiry_interval: session_expiry_interval.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing session_expiry_interval property\",\n            ))?,\n            receive_maximum: receive_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing receive_maximum property\",\n            ))?,\n            maximum_packet_size: maximum_packet_size.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_packet_size property\",\n            ))?,\n            topic_alias_maximum: topic_alias_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing topic_alias_maximum property\",\n            ))?,\n            request_response_information: request_response_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing request_response_information property\",\n            ))?,\n            request_problem_information: request_problem_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing request_problem_information property\",\n            ))?,\n            user_properties: user_properties.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing user_properties property\",\n            ))?,\n            authentication_method: authentication_method.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_method property\",\n            ))?,\n            authentication_data: authentication_data.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_data property\",\n            ))?,\n        })\n    }\n}\n\n#[derive(Default)]\npub struct ConnectPropertiesBuilder {\n    session_expiry_interval: Option\u003cu32\u003e,\n    receive_maximum: Option\u003cu16\u003e,\n    maximum_packet_size: Option\u003cu32\u003e,\n    topic_alias_maximum: Option\u003cu16\u003e,\n    request_response_information: Option\u003cbool\u003e,\n    request_problem_information: Option\u003cbool\u003e,\n    user_properties: Option\u003cVec\u003c(String, String)\u003e\u003e,\n    authentication_method: Option\u003cString\u003e,\n    authentication_data: Option\u003cVec\u003cu8\u003e\u003e,\n}\n\nimpl ConnectPropertiesBuilder {\n    pub fn create(self) -\u003e Result\u003cConnectProperties, Error\u003e {\n        Ok(ConnectProperties {\n            session_expiry_interval: self.session_expiry_interval.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing session_expiry_interval property\",\n            ))?,\n            receive_maximum: self.receive_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing receive_maximum property\",\n            ))?,\n            maximum_packet_size: self.maximum_packet_size.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing maximum_packet_size property\",\n            ))?,\n            topic_alias_maximum: self.topic_alias_maximum.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing topic_alias_maximum property\",\n            ))?,\n            request_response_information: self.request_response_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing request_response_information property\",\n            ))?,\n            request_problem_information: self.request_problem_information.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing request_problem_information property\",\n            ))?,\n            user_properties: self.user_properties.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing user_properties property\",\n            ))?,\n            authentication_method: self.authentication_method.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_method property\",\n            ))?,\n            authentication_data: self.authentication_data.ok_or(Error::new(\n                ErrorKind::InvalidData,\n                \"Missing authentication_data property\",\n            ))?,\n        })\n    }\n\n    pub fn session_expiry_interval(mut self, value: u32) -\u003e Self {\n        self.session_expiry_interval = Some(value);\n        self\n    }\n\n    pub fn receive_maximum(mut self, value: u16) -\u003e Self {\n        self.receive_maximum = Some(value);\n        self\n    }\n\n    pub fn maximum_packet_size(mut self, value: u32) -\u003e Self {\n        self.maximum_packet_size = Some(value);\n        self\n    }\n\n    pub fn topic_alias_maximum(mut self, value: u16) -\u003e Self {\n        self.topic_alias_maximum = Some(value);\n        self\n    }\n\n    pub fn request_response_information(mut self, value: bool) -\u003e Self {\n        self.request_response_information = Some(value);\n        self\n    }\n\n    pub fn request_problem_information(mut self, value: bool) -\u003e Self {\n        self.request_problem_information = Some(value);\n        self\n    }\n\n    pub fn user_properties(mut self, value: Vec\u003c(String, String)\u003e) -\u003e Self {\n        self.user_properties = Some(value);\n        self\n    }\n\n    pub fn authentication_method(mut self, value: String) -\u003e Self {\n        self.authentication_method = Some(value);\n        self\n    }\n\n    pub fn authentication_data(mut self, value: Vec\u003cu8\u003e) -\u003e Self {\n        self.authentication_data = Some(value);\n        self\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use core::panic;\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_01_connect_properties_ok() {\n        let mut buffer = Cursor::new(Vec::new());\n        let connect_properties = ConnectProperties {\n            session_expiry_interval: 1,\n            receive_maximum: 2,\n            maximum_packet_size: 10,\n            topic_alias_maximum: 99,\n            request_response_information: true,\n            request_problem_information: false,\n            user_properties: vec![\n                (\"Hola\".to_string(), \"Mundo\".to_string()),\n                (\"Chau\".to_string(), \"Mundo\".to_string()),\n            ],\n            authentication_method: \"test\".to_string(),\n            authentication_data: vec![1_u8, 2_u8, 3_u8, 4_u8, 5_u8],\n        };\n\n        match connect_properties.write_to(\u0026mut buffer) {\n            Ok(_) =\u003e {}\n            Err(e) =\u003e {\n                println!(\"Error: {:?}\", e);\n                panic!();\n            }\n        }\n        buffer.set_position(0);\n\n        let connect_properties_read = match ConnectProperties::read_from(\u0026mut buffer) {\n            Ok(properties) =\u003e properties,\n            Err(e) =\u003e {\n                println!(\"Error: {:?}\", e);\n\n                panic!();\n            }\n        };\n        assert_eq!(connect_properties, connect_properties_read);\n    }\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":162},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":115,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":119,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":123,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":124,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":127,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":131,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":140,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[],"length":0,"stats":{"Line":81},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":81},"fn_name":null},{"line":145,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":150,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":152,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":154,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":155,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":162,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":168,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":170,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":179,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":180,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":182,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":183,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":184,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":204,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":205,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":207,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":208,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":215,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":216,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":218,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":219,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":222,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":223,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":224,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":226,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":227,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":228,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":230,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":231,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":232,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":234,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":235,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":236,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":238,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":239,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":240,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":245,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":246,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":247,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":250,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":251,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":252,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":255,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":256,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":257,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":260,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":261,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":262,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":265,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":266,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":267,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":270,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":271,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":272,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":275,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":276,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":277,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":280,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":281,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":282,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":285,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":286,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":287,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":91,"coverable":149},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","error.rs"],"content":"#[derive(Debug)]\npub struct ClientError {\n    message: String,\n}\n\nimpl ClientError {\n    pub fn new(message: \u0026str) -\u003e Self {\n        Self {\n            message: message.to_string(),\n        }\n    }\n}\n\nimpl std::fmt::Display for ClientError {\n    fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n        write!(f, \"{}\", self.message)\n    }\n}\n\nimpl std::error::Error for ClientError {}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":9,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":16,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":4},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","incident.rs"],"content":"pub struct Incident {\n    location: (f64, f64),\n    time: String,\n    incident_type: String,\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","messages_config.rs"],"content":"use crate::mqtt::client_message::ClientMessage;\n\npub trait MessagesConfig {\n    fn parse_message(\u0026self, packet_id: u16) -\u003e ClientMessage;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","mod.rs"],"content":"pub mod client;\n\npub mod broker;\n\npub mod broker_message;\n\npub mod client_message;\n\npub mod publish_properties;\n\npub mod reason_code;\n\npub mod protocol_error;\n\npub mod protocol_return;\n\npub mod connect_properties;\n\npub mod quality_of_service;\n\npub mod reader;\n\npub mod subscribe_properties;\npub mod writer;\n\npub mod will_properties;\n\npub mod connack_properties;\npub mod topic;\n\npub mod error;\n\npub mod incident;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","protocol_error.rs"],"content":"use std::fmt;\n\n///Here are detailed all the errors that the protocol is capable of throwing.\n/// Unspecified se usa de placeholder para los results de los tests\n#[derive(Debug)]\npub enum ProtocolError {\n    ConectionError,\n    InvalidQOS,\n    InvalidNumberOfArguments,\n    StreamError,\n    ReadingTopicConfigFileError,\n    LockError,\n    PublishError,\n    SubscribeError,\n    UnsubscribeError,\n    UnspecifiedError,\n}\n\nimpl fmt::Display for ProtocolError {\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter) -\u003e fmt::Result {\n        match *self {\n            ProtocolError::ConectionError =\u003e write!(f, \"Error al conectar al broker.\"),\n            ProtocolError::InvalidQOS =\u003e write!(f, \"Error: Valor de QoS inv√°lido. Debe ser 0 o 1.\"),\n            ProtocolError::InvalidNumberOfArguments =\u003e {\n                write!(f, \"Error: n√∫mero de argumentos inv√°lido\")\n            }\n            ProtocolError::StreamError =\u003e write!(f, \"Error: Error en la creaci√≥n de un stream.\"),\n            ProtocolError::LockError =\u003e write!(f, \"Error en Lock.\"),\n            ProtocolError::PublishError =\u003e write!(f, \"Error al realizar un publish.\"),\n            ProtocolError::SubscribeError =\u003e write!(f, \"Error al realizar la subscripcion.\"),\n            ProtocolError::UnsubscribeError =\u003e write!(f, \"Error al desuscribirse.\"),\n\n            ProtocolError::ReadingTopicConfigFileError =\u003e {\n                write!(f, \"Error al leer el archivo de configuraci√≥n de t√≥picos\")\n            }\n            ProtocolError::UnspecifiedError =\u003e {\n                write!(f, \"Error no especificado\")\n            }\n        }\n    }\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":12},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","protocol_return.rs"],"content":"use std::fmt;\n\n#[derive(Debug, PartialEq)]\npub enum ProtocolReturn {\n    ConnackSent,\n    SubackSent,\n    PubackSent,\n    PingrespSent,\n    UnsubackSent,\n    DisconnectRecieved,\n    PlaceHolder,\n    DisconnectSent,\n}\n\nimpl fmt::Display for ProtocolReturn {\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter) -\u003e fmt::Result {\n        match *self {\n            ProtocolReturn::ConnackSent =\u003e write!(f, \"Connack Enviado.\"),\n            ProtocolReturn::SubackSent =\u003e write!(f, \"Suback Enviado.\"),\n            ProtocolReturn::PubackSent =\u003e write!(f, \"Puback Enviado.\"),\n            ProtocolReturn::PingrespSent =\u003e write!(f, \"Pingresp Enviado.\"),\n            ProtocolReturn::UnsubackSent =\u003e write!(f, \"Unsuback Enviado.\"),\n            ProtocolReturn::DisconnectRecieved =\u003e write!(f, \"Disconnect Recibido.\"),\n            ProtocolReturn::PlaceHolder =\u003e write!(f, \"Placeholder.\"),\n            ProtocolReturn::DisconnectSent =\u003e write!(f, \"Disconnect Enviado.\"),\n        }\n    }\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":17,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":10},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","publish_config.rs"],"content":"use crate::mqtt::{\n    client_message::ClientMessage, messages_config::MessagesConfig,\n    publish_properties::PublishProperties,\n};\n\npub struct PublishConfig {\n    pub(crate) dup_flag: usize,\n    pub(crate) qos: usize,\n    pub(crate) retain_flag: usize,\n    pub(crate) topic_name: String,\n    pub(crate) payload: String,\n    pub(crate) publish_properties: PublishProperties,\n}\n\nimpl MessagesConfig for PublishConfig {\n    fn parse_message(\u0026self, packet_id: u16) -\u003e ClientMessage {\n        ClientMessage::Publish {\n            packet_id,\n            topic_name: self.topic_name.clone(),\n            qos: self.qos,\n            retain_flag: self.retain_flag,\n            payload: self.payload.clone(),\n            dup_flag: self.dup_flag,\n            properties: self.publish_properties.clone(),\n        }\n    }\n}\n\nimpl PublishConfig {\n    pub fn new(\n        dup_flag: usize,\n        qos: usize,\n        retain_flag: usize,\n        topic_name: String,\n        payload: String,\n        publish_properties: PublishProperties,\n    ) -\u003e PublishConfig {\n        PublishConfig {\n            dup_flag,\n            qos,\n            retain_flag,\n            topic_name,\n            payload,\n            publish_properties,\n        }\n    }\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":8},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","publish_properties.rs"],"content":"use std::io::{Error, Read, Write};\n\nuse crate::utils::{reader::*, writer::*};\n\n//PROPERTIES IDs\nconst PAYLOAD_FORMAT_INDICATOR_ID: u8 = 0x01;\nconst MESSAGE_EXPIRY_INTERVAL_ID: u8 = 0x02;\nconst TOPIC_ALIAS_ID: u8 = 0x23;\nconst RESPONSE_TOPIC_ID: u8 = 0x08;\nconst CORRELATION_DATA_ID: u8 = 0x09;\nconst USER_PROPERTY_ID: u8 = 0x26;\nconst SUBSCRIPTION_IDENTIFIER_ID: u8 = 0x0B;\nconst CONTENT_TYPE_ID: u8 = 0x03;\n\n#[derive(Debug, PartialEq, Clone)]\npub struct PublishProperties {\n    /// Si vale 0, indica que el payload tiene bytes unspecified -\u003e es equivalente a no enviar un payload format indicator.\n    /// Si vale 1 indica que el payload esta encodeado en UTF-8\n    pub payload_format_indicator: u8,\n\n    ///Indica el lifetime del application message en segundos.\n    ///Si este intervalo expira y el servidor no ha hecho el delivery, se debe eliminar la copia del mensaje para ese subscriptor.\n    pub message_expiry_interval: u32,\n    pub topic_properties: TopicProperties,\n    pub correlation_data: Vec\u003cu8\u003e,\n    pub user_property: String,\n    pub subscription_identifier: u32,\n    pub content_type: String,\n}\n\n#[derive(Debug, PartialEq, Clone)]\npub struct TopicProperties {\n    pub topic_alias: u16,\n    pub response_topic: String,\n}\n\nimpl PublishProperties {\n    pub fn new(\n        payload_format_indicator: u8,\n        message_expiry_interval: u32,\n        topic_properties: TopicProperties,\n        correlation_data: Vec\u003cu8\u003e,\n        user_property: String,\n        subscription_identifier: u32,\n        content_type: String,\n    ) -\u003e PublishProperties {\n        PublishProperties {\n            payload_format_indicator,\n            message_expiry_interval,\n            topic_properties,\n            correlation_data,\n            user_property,\n            subscription_identifier,\n            content_type,\n        }\n    }\n\n    pub fn write_properties(\u0026self, stream: \u0026mut dyn Write) -\u003e std::io::Result\u003c()\u003e {\n        //payload format indicator\n        write_u8(stream, \u0026PAYLOAD_FORMAT_INDICATOR_ID)?;\n        write_u8(stream, \u0026self.payload_format_indicator)?;\n\n        //message expiry interval\n        write_u8(stream, \u0026MESSAGE_EXPIRY_INTERVAL_ID)?;\n        write_u32(stream, \u0026self.message_expiry_interval)?;\n\n        //topic alias\n        write_u8(stream, \u0026TOPIC_ALIAS_ID)?;\n        write_u16(stream, \u0026self.topic_properties.topic_alias)?;\n\n        //response topic\n        write_u8(stream, \u0026RESPONSE_TOPIC_ID)?;\n        write_string(stream, \u0026self.topic_properties.response_topic)?;\n\n        //correlation data\n        write_u8(stream, \u0026CORRELATION_DATA_ID)?;\n        write_bin_vec(stream, \u0026self.correlation_data)?;\n\n        //user property\n        write_u8(stream, \u0026USER_PROPERTY_ID)?;\n        write_string(stream, \u0026self.user_property)?;\n\n        //subscription identifier\n        write_u8(stream, \u0026SUBSCRIPTION_IDENTIFIER_ID)?;\n        write_u32(stream, \u0026self.subscription_identifier)?;\n\n        //content type\n        write_u8(stream, \u0026CONTENT_TYPE_ID)?;\n        write_string(stream, \u0026self.content_type)?;\n\n        Ok(())\n    }\n    #[allow(dead_code)]\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cPublishProperties, Error\u003e {\n        //payload format indicator\n        let _payload_format_indicator_id = read_u8(stream)?;\n        let payload_format_indicator = read_u8(stream)?;\n\n        //message expiry interval\n        let _message_expiry_interval_id = read_u8(stream)?;\n        let message_expiry_interval = read_u32(stream)?;\n\n        //topic alias\n        let _topic_alias_id = read_u8(stream)?;\n        let topic_alias = read_u16(stream)?;\n\n        //response topic\n        let _response_topic_id = read_u8(stream)?;\n        let response_topic = read_string(stream)?;\n\n        let topic_properties = TopicProperties {\n            topic_alias,\n            response_topic,\n        };\n\n        //correlation data\n        let _correlation_data_id = read_u8(stream)?;\n        let correlation_data = read_bin_vec(stream)?;\n\n        //user property\n        let _user_property_id = read_u8(stream)?;\n        let user_property = read_string(stream)?;\n\n        //subscription identifier\n        let _subscription_identifier_id = read_u8(stream)?;\n        let subscription_identifier = read_u32(stream)?;\n\n        //content type\n        let _content_type_id = read_u8(stream)?;\n        let content_type = read_string(stream)?;\n\n        Ok(PublishProperties {\n            payload_format_indicator,\n            message_expiry_interval,\n            topic_properties,\n            correlation_data,\n            user_property,\n            subscription_identifier,\n            content_type,\n        })\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_01_publish_properties_ok() {\n        let mut buffer = Cursor::new(Vec::new());\n\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let properties = PublishProperties::new(\n            1,\n            10,\n            topic_properties,\n            [1, 2, 3].to_vec(),\n            \"a\".to_string(),\n            1,\n            \"a\".to_string(),\n        );\n\n        match properties.write_properties(\u0026mut buffer) {\n            Ok(_) =\u003e (),\n            Err(err) =\u003e panic!(\"Error writing properties: {:?}\", err),\n        }\n        buffer.set_position(0);\n\n        let publish_properties_read = match PublishProperties::read_from(\u0026mut buffer) {\n            Ok(properties) =\u003e properties,\n            Err(err) =\u003e panic!(\"Error reading properties: {:?}\", err),\n        };\n        assert_eq!(properties, publish_properties_read);\n    }\n}\n","traces":[{"line":38,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":10},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":108,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":117,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":132,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":134,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":136,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":5},"fn_name":null}],"covered":44,"coverable":44},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","reason_code.rs"],"content":"use std::io::Error;\n\n///  reason codes in HEX\npub const SUCCESS_HEX: u8 = 0x00;\npub const NO_MATCHING_SUBSCRIBERS_HEX: u8 = 0x10;\npub const UNSPECIFIED_ERROR_HEX: u8 = 0x80;\npub const IMPLEMENTATION_SPECIFIC_ERROR_HEX: u8 = 0x83;\npub const NOT_AUTHORIZED_HEX: u8 = 0x87;\npub const TOPIC_NAME_INVALID_HEX: u8 = 0x90;\npub const PACKET_ID_IN_USE_HEX: u8 = 0x91;\npub const QUOTA_EXCEEDED_HEX: u8 = 0x97;\npub const PAYLOAD_FORMAT_INVALID_HEX: u8 = 0x99;\npub const SUB_ID_DUP_HEX: u8 = 0x85;\n\npub enum ReasonCode {\n    Success { reason_code: u8 },\n    NoMatchingSubscribers { reason_code: u8 },\n    UnspecifiedError { reason_code: u8 },\n    ImplementationSpecificError { reason_code: u8 },\n    NotAuthorized { reason_code: u8 },\n    TopicNameInvalid { reason_code: u8 },\n    PacketIdentifierInUse { reason_code: u8 },\n    QuotaExceeded { reason_code: u8 },\n    PayloadFormatInvalid { reason_code: u8 },\n    SubIdDup { reason_code: u8 },\n}\n\nimpl ReasonCode {\n    pub fn new(\u0026self, reason_code: u8) -\u003e Result\u003cReasonCode, Error\u003e {\n        match reason_code {\n            SUCCESS_HEX =\u003e Ok(ReasonCode::Success { reason_code }),\n            NO_MATCHING_SUBSCRIBERS_HEX =\u003e Ok(ReasonCode::NoMatchingSubscribers { reason_code }),\n            UNSPECIFIED_ERROR_HEX =\u003e Ok(ReasonCode::UnspecifiedError { reason_code }),\n            IMPLEMENTATION_SPECIFIC_ERROR_HEX =\u003e {\n                Ok(ReasonCode::ImplementationSpecificError { reason_code })\n            }\n            NOT_AUTHORIZED_HEX =\u003e Ok(ReasonCode::NotAuthorized { reason_code }),\n            TOPIC_NAME_INVALID_HEX =\u003e Ok(ReasonCode::TopicNameInvalid { reason_code }),\n            PACKET_ID_IN_USE_HEX =\u003e Ok(ReasonCode::PacketIdentifierInUse { reason_code }),\n            QUOTA_EXCEEDED_HEX =\u003e Ok(ReasonCode::QuotaExceeded { reason_code }),\n            PAYLOAD_FORMAT_INVALID_HEX =\u003e Ok(ReasonCode::PayloadFormatInvalid { reason_code }),\n            SUB_ID_DUP_HEX =\u003e Ok(ReasonCode::SubIdDup { reason_code }),\n            _ =\u003e Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Reason code inv√°lido\",\n            )),\n        }\n    }\n}\n","traces":[{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":15},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","run_broker.rs"],"content":"use std::env::args;\n\nuse rustic_city_eye::mqtt::{broker::Broker, protocol_error::ProtocolError};\n\nfn main() -\u003e Result\u003c(), ProtocolError\u003e {\n    let argv = args().collect::\u003cVec\u003cString\u003e\u003e();\n    let mut broker = Broker::new(argv)?;\n    let _ = broker.server_run();\n    Ok(())\n}\n","traces":[{"line":5,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":6,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":7,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":3},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","subscribe_config.rs"],"content":"use crate::mqtt::subscribe_properties::SubscribeProperties;\n\nuse super::{client_message::ClientMessage, messages_config::MessagesConfig};\n\npub struct SubscribeConfig {\n    pub(crate) topic_name: String,\n    pub(crate) properties: SubscribeProperties,\n}\n\nimpl MessagesConfig for SubscribeConfig {\n    fn parse_message(\u0026self, packet_id: u16) -\u003e ClientMessage {\n        ClientMessage::Subscribe {\n            packet_id,\n            topic_name: self.topic_name.clone(),\n            properties: self.properties.clone(),\n        }\n    }\n}\n\nimpl SubscribeConfig {\n    pub fn new(topic_name: String, properties: SubscribeProperties) -\u003e SubscribeConfig {\n        SubscribeConfig {\n            topic_name,\n            properties,\n        }\n    }\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":4},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","subscribe_properties.rs"],"content":"use crate::utils::{reader::*, writer::*};\nuse std::io::{Error, Read, Write};\n\n#[derive(Debug, PartialEq, Clone)]\npub struct SubscribeProperties {\n    pub sub_id: u8,\n    user_properties: Vec\u003c(String, String)\u003e,\n    payload: Vec\u003cu8\u003e,\n}\n\nimpl SubscribeProperties {\n    pub fn new(\n        sub_id: u8,\n        user_properties: Vec\u003c(String, String)\u003e,\n        payload: Vec\u003cu8\u003e,\n    ) -\u003e SubscribeProperties {\n        SubscribeProperties {\n            sub_id,\n            user_properties,\n            payload,\n        }\n    }\n\n    pub fn write_properties(\u0026self, stream: \u0026mut dyn Write) -\u003e Result\u003c(), Error\u003e {\n        write_u8(stream, \u0026self.sub_id)?;\n        write_string_pairs(stream, \u0026self.user_properties)?;\n        write_bin_vec(stream, \u0026self.payload)?;\n        Ok(())\n    }\n\n    pub fn read_properties(stream: \u0026mut dyn Read) -\u003e Result\u003cSubscribeProperties, Error\u003e {\n        let sub_id = read_u8(stream)?;\n        let user_properties = read_string_pairs(stream)?;\n        let payload = read_bin_vec(stream)?;\n        Ok(SubscribeProperties::new(sub_id, user_properties, payload))\n    }\n}\n","traces":[{"line":12,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":7},"fn_name":null}],"covered":11,"coverable":11},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","topic.rs"],"content":"use std::collections::HashMap;\nuse std::fmt::Debug;\nuse std::io::Error;\nuse std::net::TcpStream;\nuse std::sync::{Arc, RwLock};\n\nuse crate::mqtt::broker_message::BrokerMessage;\n\nuse super::client_message::ClientMessage;\n\nuse super::reason_code;\n\n#[derive(Debug, Clone)]\npub struct Topic {\n    /// Hashmap de subscriptores.\n    /// El u32 representa el sub_id, y el valor es el stream del subscriptor.\n    subscribers: Arc\u003cRwLock\u003cHashMap\u003cu8, TcpStream\u003e\u003e\u003e,\n}\n\nimpl Default for Topic {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Topic {\n    pub fn new() -\u003e Self {\n        Self {\n            subscribers: Arc::new(RwLock::new(HashMap::new())),\n        }\n    }\n\n    pub fn add_subscriber(\u0026mut self, stream: TcpStream, sub_id: u8) -\u003e u8 {\n        //verificar si el sub_id ya existe en topic subscribers\n        if self.subscribers.read().unwrap().contains_key(\u0026sub_id) {\n            return reason_code::SUB_ID_DUP_HEX;\n        }\n\n        let mut lock = match self.subscribers.write() {\n            Ok(guard) =\u003e guard,\n            Err(_) =\u003e return reason_code::UNSPECIFIED_ERROR_HEX,\n        };\n\n        lock.insert(sub_id, stream);\n        reason_code::SUCCESS_HEX\n    }\n\n    pub fn remove_subscriber(\u0026mut self, sub_id: u8) -\u003e u8 {\n        let mut lock = match self.subscribers.write() {\n            Ok(guard) =\u003e guard,\n            Err(_) =\u003e return reason_code::UNSPECIFIED_ERROR_HEX,\n        };\n\n        if !lock.contains_key(\u0026sub_id) {\n            println!(\"No se encontr√≥ el sub_id en los subscribers\");\n            return reason_code::NO_MATCHING_SUBSCRIBERS_HEX;\n        }\n\n        lock.remove(\u0026sub_id);\n        reason_code::SUCCESS_HEX\n    }\n\n    pub fn deliver_message(\u0026self, message: ClientMessage) -\u003e Result\u003cu8, Error\u003e {\n        let lock = self.subscribers.read().unwrap();\n        let mut puback_reason_code: u8 = 0x00;\n        match message {\n            ClientMessage::Publish {\n                topic_name,\n                payload,\n                packet_id,\n                qos,\n                retain_flag,\n                dup_flag,\n                properties,\n            } =\u003e {\n                let delivery_message = BrokerMessage::PublishDelivery {\n                    topic_name,\n                    payload,\n                    packet_id,\n                    qos,\n                    retain_flag,\n                    dup_flag,\n                    properties,\n                };\n\n                if lock.is_empty() {\n                    puback_reason_code = 0x10_u8;\n                    return Ok(puback_reason_code);\n                }\n\n                for mut subscriber in lock.iter() {\n                    println!(\"Enviando un PublishDelivery\");\n                    match delivery_message.write_to(\u0026mut subscriber.1) {\n                        Ok(_) =\u003e println!(\"PublishDelivery enviado\"),\n                        Err(err) =\u003e println!(\"Error al enviar PublishDelivery: {:?}\", err),\n                    }\n                }\n            }\n            _ =\u003e {\n                return Ok(0x10);\n            }\n        };\n        Ok(puback_reason_code)\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_01_topic_creation_ok() -\u003e std::io::Result\u003c()\u003e {\n        let _ = Topic::new();\n\n        Ok(())\n    }\n\n    // #[test]\n    // fn test_02_adding_sub_ok() -\u003e std::io::Result\u003c()\u003e {\n    //     let mut topic = Topic::new();\n\n    //     let (tx, _rx) = mpsc::channel();\n    //     topic.add_subscriber(tx);\n\n    //     Ok(())\n    // }\n\n    // #[test]\n    // fn test_03_adding_sub_and_sending_message_ok() {\n    //     let mut topic = Topic::new();\n    //     let (tx, rx) = mpsc::channel();\n    //     topic.add_subscriber(tx);\n\n    //     let _ = topic.send_message(\"holaholahola\");\n\n    //     let message_received = rx.recv().unwrap();\n\n    //     assert_eq!(message_received, \"holaholahola\".to_string());\n    // }\n\n    // #[test]\n    // fn test_04_adding_multiple_subs_and_sending_message_ok() {\n    //     let mut topic = Topic::new();\n    //     let (tx1, rx1) = mpsc::channel();\n    //     let (tx2, rx2) = mpsc::channel();\n    //     let (tx3, rx3) = mpsc::channel();\n\n    //     topic.add_subscriber(tx1);\n    //     topic.add_subscriber(tx2);\n    //     topic.add_subscriber(tx3);\n\n    //     let _ = topic.send_message(\"holaholahola\");\n\n    //     let message_received1 = rx1.recv().unwrap();\n    //     let message_received2 = rx2.recv().unwrap();\n    //     let message_received3 = rx3.recv().unwrap();\n\n    //     assert_eq!(message_received1, \"holaholahola\".to_string());\n    //     assert_eq!(message_received2, \"holaholahola\".to_string());\n    //     assert_eq!(message_received3, \"holaholahola\".to_string());\n    // }\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":2,"coverable":41},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","mqtt","will_properties.rs"],"content":"use std::io::BufWriter;\nuse std::io::Error;\nuse std::io::Read;\nuse std::io::Write;\n\nuse crate::utils::{reader::*, writer::*};\n\nconst WILL_DELAY_INTERVAL_ID: u8 = 0x18;\nconst PAYLOAD_FORMAT_INDICATOR_ID: u8 = 0x01;\nconst MESSAGE_EXPIRY_INTERVAL_ID: u8 = 0x02;\nconst CONTENT_TYPE_ID: u8 = 0x03;\nconst RESPONSE_TOPIC_ID: u8 = 0x08;\nconst CORRELATION_DATA_ID: u8 = 0x09;\nconst USER_PROPERTIES_ID: u8 = 0x26;\n\n#[derive(Debug, PartialEq, Clone)]\n/// last_will_delay_interval especifica el tiempo en segundos que el broker debe esperar antes de publicar el will message.\n///\n/// payload_format_indicator indica si el payload esta encodado en utf-8 o no.\n/// message_expiry_interval especifica el tiempo en segundos que el broker debe esperar antes de descartar el will message.\n/// content_type especifica el tipo de contenido del will message. (ej json, plain text)\n/// el response_topic es el el topic name que debera usar el mensaje de respuesta. Si hay response_topic, el will message se considera un request message.\n///\n/// `The Correlation Data is used by the sender of the Request Message to identify which request the Response Message is for when it is received`\n///\n/// user_property especifica una propiedad del usuario que se envia en el mensaje, se pueden enviar 0, 1 o m√°s propiedades.\npub struct WillProperties {\n    last_will_delay_interval: u32,\n    payload_format_indicator: u8,\n    message_expiry_interval: u16,\n    content_type: String,\n    response_topic: String,\n    correlation_data: Vec\u003cu8\u003e,\n    user_properties: Vec\u003c(String, String)\u003e,\n}\n\nimpl WillProperties {\n    pub fn new(\n        last_will_delay_interval: u32,\n        payload_format_indicator: u8,\n        message_expiry_interval: u16,\n        content_type: String,\n        response_topic: String,\n        correlation_data: Vec\u003cu8\u003e,\n        user_properties: Vec\u003c(String, String)\u003e,\n    ) -\u003e WillProperties {\n        WillProperties {\n            last_will_delay_interval,\n            payload_format_indicator,\n            message_expiry_interval,\n            content_type,\n            response_topic,\n            correlation_data,\n            user_properties,\n        }\n    }\n    pub fn write_to(\u0026self, stream: \u0026mut dyn Write) -\u003e Result\u003c(), Error\u003e {\n        let mut writer = BufWriter::new(stream);\n        //will properties\n        write_u8(\u0026mut writer, \u0026WILL_DELAY_INTERVAL_ID)?;\n\n        write_u32(\u0026mut writer, \u0026self.last_will_delay_interval)?;\n\n        let payload_format_indicator = 0x01_u8;\n        //siempre 1 porque los strings en rust siempre son utf-8\n        write_u8(\u0026mut writer, \u0026PAYLOAD_FORMAT_INDICATOR_ID)?;\n        write_u8(\u0026mut writer, \u0026payload_format_indicator)?;\n\n        write_u8(\u0026mut writer, \u0026MESSAGE_EXPIRY_INTERVAL_ID)?;\n\n        write_u16(\u0026mut writer, \u0026self.message_expiry_interval)?;\n\n        write_u8(\u0026mut writer, \u0026CONTENT_TYPE_ID)?;\n        write_string(\u0026mut writer, \u0026self.content_type)?;\n\n        write_u8(\u0026mut writer, \u0026RESPONSE_TOPIC_ID)?;\n        write_string(\u0026mut writer, \u0026self.response_topic)?;\n\n        write_u8(\u0026mut writer, \u0026CORRELATION_DATA_ID)?;\n        let correlation_data_length = self.correlation_data.len() as u16;\n        write_u16(\u0026mut writer, \u0026correlation_data_length)?;\n        for byte in \u0026self.correlation_data {\n            write_u8(\u0026mut writer, byte)?;\n        }\n        //user property\n\n        write_u8(\u0026mut writer, \u0026USER_PROPERTIES_ID)?;\n        let user_properties_length = self.user_properties.len() as u16;\n        write_u16(\u0026mut writer, \u0026user_properties_length)?;\n        for (key, value) in \u0026self.user_properties {\n            write_string(\u0026mut writer, key)?;\n            write_string(\u0026mut writer, value)?;\n        }\n\n        Ok(())\n    }\n\n    pub fn read_from(stream: \u0026mut dyn Read) -\u003e Result\u003cWillProperties, Error\u003e {\n        //will properties\n        let will_delay_interval_id = read_u8(stream)?;\n        if will_delay_interval_id != WILL_DELAY_INTERVAL_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid will delay interval id\",\n            ));\n        }\n        let will_delay_interval = read_u32(stream)?;\n\n        let payload_format_indicator_id = read_u8(stream)?;\n        if payload_format_indicator_id != PAYLOAD_FORMAT_INDICATOR_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid payload format indicator id\",\n            ));\n        }\n        let payload_format_indicator = read_u8(stream)?;\n\n        let message_expiry_interval_id = read_u8(stream)?;\n        if message_expiry_interval_id != MESSAGE_EXPIRY_INTERVAL_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid message expiry interval id\",\n            ));\n        }\n        let message_expiry_interval = read_u16(stream)?;\n        let content_type_id = read_u8(stream)?;\n        if content_type_id != CONTENT_TYPE_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid content type id\",\n            ));\n        }\n        let content_type = read_string(stream)?;\n\n        let response_topic_id = read_u8(stream)?;\n        if response_topic_id != RESPONSE_TOPIC_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid response topic id\",\n            ));\n        }\n        let response_topic = read_string(stream)?;\n\n        let correlation_data_id = read_u8(stream)?;\n        if correlation_data_id != CORRELATION_DATA_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid correlation data id\",\n            ));\n        }\n        let correlation_data_length = read_u16(stream)?;\n        let mut correlation_data = vec![0; correlation_data_length as usize];\n        stream.read_exact(\u0026mut correlation_data)?;\n\n        //user property\n        let user_properties_id = read_u8(stream)?;\n        if user_properties_id != USER_PROPERTIES_ID {\n            return Err(Error::new(\n                std::io::ErrorKind::Other,\n                \"Invalid user properties id\",\n            ));\n        }\n        let mut user_properties = Vec::new();\n        let user_properties_lenght = read_u16(stream)?;\n        for _ in 0..user_properties_lenght {\n            let user_properties_key = read_string(stream)?;\n            let user_properties_value = read_string(stream)?;\n            user_properties.push((user_properties_key, user_properties_value));\n        }\n\n        Ok(WillProperties {\n            last_will_delay_interval: will_delay_interval,\n            payload_format_indicator,\n            message_expiry_interval,\n            content_type,\n            response_topic,\n            correlation_data,\n            user_properties,\n        })\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use std::io::Cursor;\n\n    use super::*;\n\n    #[test]\n    fn test_01_will_properties_ok() {\n        let will_properties = WillProperties::new(\n            120,\n            1,\n            30,\n            \"plain\".to_string(),\n            \"topic\".to_string(),\n            vec![1, 2, 3, 4, 5],\n            vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        );\n        let mut cursor = Cursor::new(Vec::\u003cu8\u003e::new());\n        match will_properties.write_to(\u0026mut cursor) {\n            Ok(_) =\u003e (),\n            Err(err) =\u003e panic!(\"Error writing will properties: {:?}\", err),\n        };\n        cursor.set_position(0);\n\n        let read_will_properties = match WillProperties::read_from(\u0026mut cursor) {\n            Ok(properties) =\u003e properties,\n            Err(err) =\u003e panic!(\"Error reading will properties: {:?}\", err),\n        };\n\n        assert_eq!(will_properties, read_will_properties);\n    }\n}\n","traces":[{"line":38,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":82,"address":[],"length":0,"stats":{"Line":89},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":25},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":109,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":111,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":112,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":113,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":116,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":118,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":120,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":121,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":122,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":125,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":126,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":128,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":130,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":135,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":137,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":139,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":142,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":144,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":146,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":147,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":148,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":151,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":153,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":156,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":158,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":159,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":160,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":163,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":164,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":166,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":167,"address":[],"length":0,"stats":{"Line":8},"fn_name":null},{"line":171,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":172,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":173,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":174,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":175,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":176,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":177,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":178,"address":[],"length":0,"stats":{"Line":9},"fn_name":null}],"covered":50,"coverable":74},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","camera.rs"],"content":"use crate::surveilling::location::Location;\n\n#[derive(Debug, Clone)]\n#[allow(dead_code)]\npub struct Camera {\n    location: Location,\n}\n\nimpl Camera {\n    pub fn new(location: Location) -\u003e Camera {\n        Self { location }\n    }\n\n    pub fn get_location(\u0026self) -\u003e Location {\n        self.location.clone()\n    }\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":14,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":3},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","camera_system.rs"],"content":"use std::sync::mpsc::{self, Sender};\n\nuse crate::{\n    mqtt::{\n        client::Client, connect_config::ConnectConfig, connect_properties,\n        messages_config::MessagesConfig, protocol_error::ProtocolError,\n        subscribe_config::SubscribeConfig, subscribe_properties::SubscribeProperties,\n        will_properties,\n    },\n    surveilling::{camera::Camera, location::Location},\n};\n#[derive(Debug)]\n#[allow(dead_code)]\npub struct CameraSystem {\n    send_to_client_channel: Sender\u003cBox\u003cdyn MessagesConfig + Send\u003e\u003e,\n    camera_system_client: Client,\n    cameras: Vec\u003cCamera\u003e,\n}\n\nimpl CameraSystem {\n    pub fn new(args: Vec\u003cString\u003e) -\u003e Result\u003cCameraSystem, ProtocolError\u003e {\n        let address = args[0].clone() + \":\" + \u0026args[1];\n        let will_properties = will_properties::WillProperties::new(\n            1,\n            1,\n            1,\n            \"a\".to_string(),\n            \"a\".to_string(),\n            [1, 2, 3].to_vec(),\n            vec![(\"a\".to_string(), \"a\".to_string())],\n        );\n\n        let connect_properties = connect_properties::ConnectProperties::new(\n            30,\n            1,\n            20,\n            20,\n            true,\n            true,\n            vec![(\"hola\".to_string(), \"chau\".to_string())],\n            \"auth\".to_string(),\n            vec![1, 2, 3],\n        );\n\n        let connect_config = ConnectConfig::new(\n            true,\n            true,\n            1,\n            true,\n            35,\n            connect_properties,\n            \"juancito\".to_string(),\n            will_properties,\n            \"camera system\".to_string(),\n            \"soy el monitoring y me desconecte\".to_string(),\n            args[2].clone(),\n            args[3].clone(),\n        );\n\n        let (tx, rx) = mpsc::channel();\n\n        let camera_system_client = match Client::new(rx, address, connect_config) {\n            Ok(client) =\u003e client,\n            Err(err) =\u003e return Err(err),\n        };\n\n        let subscribe_config = SubscribeConfig::new(\n            \"incidente\".to_string(),\n            SubscribeProperties::new(\n                0,\n                vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n                vec![0, 1, 2, 3],\n            ),\n        );\n\n        let _ = tx.send(Box::new(subscribe_config));\n\n        Ok(CameraSystem {\n            send_to_client_channel: tx,\n            camera_system_client,\n            cameras: Vec::new(),\n        })\n    }\n\n    pub fn add_camera(\u0026mut self, location: Location) {\n        let camera = Camera::new(location);\n        self.cameras.push(camera);\n    }\n\n    pub fn get_cameras(\u0026self) -\u003e \u0026Vec\u003cCamera\u003e {\n        \u0026self.cameras\n    }\n\n    pub fn run_client(\u0026mut self) -\u003e Result\u003c(), ProtocolError\u003e {\n        self.camera_system_client.client_run()?;\n        Ok(())\n    }\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":40,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":27},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","location.rs"],"content":"#[derive(Debug, Clone)]\n#[allow(dead_code)]\npub struct Location {\n    pub longitude: f64,\n    pub latitude: f64,\n}\n\nimpl Location {\n    pub fn new(lat: String, long: String) -\u003e Location {\n        let latitude = lat.parse::\u003cf64\u003e().unwrap();\n        let longitude = long.parse::\u003cf64\u003e().unwrap();\n\n        Location {\n            longitude,\n            latitude,\n        }\n    }\n\n    pub fn parse_to_string(\u0026self) -\u003e String {\n        format!(\"({}, {})\", self.latitude, self.longitude)\n    }\n}\n","traces":[{"line":9,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":10,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","mod.rs"],"content":"pub mod camera;\n\npub mod camera_system;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","surveilling","run_camera_system.rs"],"content":"use std::{\n    env::args,\n    io::{stdin, Read},\n};\n\nuse rustic_city_eye::{\n    mqtt::protocol_error::ProtocolError, surveilling::camera_system::CameraSystem,\n};\n\nfn main() -\u003e Result\u003c(), ProtocolError\u003e {\n    let argv = args().collect::\u003cVec\u003cString\u003e\u003e();\n\n    let mut _camera_system = CameraSystem::new(argv)?;\n    let _stream: Box\u003cdyn Read + Send\u003e = Box::new(stdin());\n\n    // let _ = camera_system.app_run(stream);\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","utils","mod.rs"],"content":"pub mod reader;\npub mod threadpool;\npub mod writer;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","utils","reader.rs"],"content":"use std::io::{Error, Read};\n\npub fn read_string(stream: \u0026mut dyn Read) -\u003e Result\u003cString, Error\u003e {\n    let string_length = read_u16(stream)?;\n    let mut string_buf = vec![0; string_length as usize];\n    stream.read_exact(\u0026mut string_buf)?;\n\n    let protocol_name = std::str::from_utf8(\u0026string_buf).expect(\"Error al leer protocol_name\");\n    Ok(protocol_name.to_string())\n}\n\npub fn read_u8(stream: \u0026mut dyn Read) -\u003e Result\u003cu8, Error\u003e {\n    let mut buf = [0u8; 1];\n    stream.read_exact(\u0026mut buf)?;\n    Ok(u8::from_be_bytes(buf))\n}\n\npub fn read_u16(stream: \u0026mut dyn Read) -\u003e Result\u003cu16, Error\u003e {\n    let mut buf = [0u8; 2];\n    stream.read_exact(\u0026mut buf)?;\n    Ok(u16::from_be_bytes(buf))\n}\n\npub fn read_u32(stream: \u0026mut dyn Read) -\u003e Result\u003cu32, Error\u003e {\n    let mut buf = [0u8; 4];\n    stream.read_exact(\u0026mut buf)?;\n    Ok(u32::from_be_bytes(buf))\n}\n\npub fn read_string_pairs(stream: \u0026mut dyn Read) -\u003e Result\u003cVec\u003c(String, String)\u003e, Error\u003e {\n    let length = read_u16(stream)?;\n    let mut pairs = Vec::new();\n    for _ in 0..length {\n        let key = read_string(stream)?;\n        let value = read_string(stream)?;\n        pairs.push((key, value));\n    }\n    Ok(pairs)\n}\n\npub fn read_bin_vec(reader: \u0026mut dyn Read) -\u003e Result\u003cVec\u003cu8\u003e, Error\u003e {\n    let length = read_u16(reader)?;\n    let mut buffer = vec![0; length as usize];\n    reader.read_exact(\u0026mut buffer)?;\n    Ok(buffer)\n}\n\npub fn read_tuple_vec(reader: \u0026mut dyn Read) -\u003e Result\u003cVec\u003c(String, String)\u003e, Error\u003e {\n    let length = read_u16(reader)?;\n    let mut vec = Vec::with_capacity(length as usize);\n    for _ in 0..length {\n        let key = read_string(reader)?;\n        let value = read_string(reader)?;\n        vec.push((key, value));\n    }\n    Ok(vec)\n}\npub fn read_bool(stream: \u0026mut dyn Read) -\u003e Result\u003cbool, Error\u003e {\n    let mut buf = [0u8; 1];\n    stream.read_exact(\u0026mut buf)?;\n    Ok(buf[0] != 0)\n}\n","traces":[{"line":3,"address":[],"length":0,"stats":{"Line":171},"fn_name":null},{"line":4,"address":[],"length":0,"stats":{"Line":342},"fn_name":null},{"line":6,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":8,"address":[],"length":0,"stats":{"Line":171},"fn_name":null},{"line":9,"address":[],"length":0,"stats":{"Line":171},"fn_name":null},{"line":12,"address":[],"length":0,"stats":{"Line":240},"fn_name":null},{"line":13,"address":[],"length":0,"stats":{"Line":240},"fn_name":null},{"line":14,"address":[],"length":0,"stats":{"Line":240},"fn_name":null},{"line":15,"address":[],"length":0,"stats":{"Line":240},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":281},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":281},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":281},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":281},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":31,"address":[],"length":0,"stats":{"Line":22},"fn_name":null},{"line":34,"address":[],"length":0,"stats":{"Line":22},"fn_name":null},{"line":35,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":38,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":42},"fn_name":null},{"line":44,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":48,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":49,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":32},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":59,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":18},"fn_name":null}],"covered":33,"coverable":35},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","utils","threadpool.rs"],"content":"use std::{\n    sync::{\n        mpsc::{self, channel, Receiver},\n        Arc, Mutex,\n    },\n    thread,\n};\n/// El codigo que estan por ver es un poco falopa, pasa que tiene que ser una interfaz muy generalista\n/// Los workers tienen un thread y un ID, se crean segun el valor que se le pase por parametro al constructor.\n/// Si se ejecuta new(4), se crearan 4 workers.\n/// el sender es el encargado de recibir el nuevo job a ejecutar.\npub struct ThreadPool {\n    workers: Vec\u003cWorker\u003e,\n    sender: mpsc::Sender\u003cJob\u003e,\n}\nstruct Worker {\n    id: usize,\n    thread: thread::JoinHandle\u003c()\u003e,\n}\n\nimpl Worker {\n    fn new(id: usize, receiver: Arc\u003cMutex\u003cmpsc::Receiver\u003cJob\u003e\u003e\u003e) -\u003e Worker {\n        let thread = thread::spawn(move || loop {\n            let job = receiver.lock().unwrap().recv().unwrap();\n\n            job();\n        });\n\n        Worker { id, thread }\n    }\n}\n\ntype Job = Box\u003cdyn FnOnce() + Send + 'static\u003e;\n\nimpl ThreadPool {\n    pub fn new(size: usize) -\u003e ThreadPool {\n        assert!(size \u003e 0);\n\n        let (sender, receiver) = mpsc::channel();\n\n        let receiver = Arc::new(Mutex::new(receiver));\n\n        let mut workers = Vec::with_capacity(size);\n\n        for id in 0..size {\n            workers.push(Worker::new(id, Arc::clone(\u0026receiver)));\n        }\n\n        ThreadPool { workers, sender }\n    }\n\n    /// Esta funcion recibe una funncion F y devuelve un reciever con el resultado de la misma.\n    /// el channel creado internamente es para ejecutar la funcion F y luego retornar el resultado de su ejecuci√≥n\n    /// Se le pide entonces al job que ejecute F y mande su resultado por el channel.\n    /// Luego se le pasa ese job a un worker disponible mediante el self.sender.\n    /// Es en ese momento que la funcion F se ejecuta.\n    pub fn execute\u003cF, R\u003e(\u0026self, f: F) -\u003e Receiver\u003cR\u003e\n    where\n        F: FnOnce() -\u003e R + Send + 'static,\n        R: Send + 'static,\n    {\n        let (tx, rx) = channel();\n        let senderr = self.sender.clone();\n\n        let job = Box::new(move || {\n            let result = f();\n            if let Err(err) = tx.send(result) {\n                println!(\"Failed to send result: {:?}\", err);\n            }\n        });\n\n        if let Err(err) = senderr.send(job) {\n            println!(\"Failed to send job: {:?}\", err);\n        }\n\n        rx\n    }\n}\n","traces":[{"line":22,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":43,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":45,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":21},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","src","utils","writer.rs"],"content":"use std::io::{Error, Write};\n\n// enum Type {\n//     String,\n//     U16,\n//     U32,\n//     Vec,\n//     Bool,\n//     StringTuple,\n// }\n\n///Recibe un string y el stream al que escribir ese stream\n///\n/// Calcula su largo y luego escribe el largo y el string en el stream\npub fn write_string(stream: \u0026mut dyn Write, string: \u0026str) -\u003e Result\u003c(), Error\u003e {\n    let length = string.len() as u16;\n    let length_bytes = length.to_be_bytes();\n    stream.write_all(\u0026length_bytes)?;\n    stream.write_all(string.as_bytes())?;\n    Ok(())\n}\n\npub fn write_tuple_vec(stream: \u0026mut dyn Write, vec: \u0026Vec\u003c(String, String)\u003e) -\u003e Result\u003c(), Error\u003e {\n    let length = vec.len() as u16;\n    let length_bytes = length.to_be_bytes();\n    stream.write_all(\u0026length_bytes)?;\n    for item in vec {\n        write_string_tuple(stream, item)?;\n    }\n    Ok(())\n}\n\n// pub fn write_vec\u003cT\u003e(stream: \u0026mut dyn Write, vec: \u0026Vec\u003cT\u003e, data_type: Type) -\u003e Result\u003c(), Error\u003e {\n//     match data_type {\n//         Type::String =\u003e {\n//             for item in vec {\n//                 write_string(stream, \u0026item.to_string())?;\n//             }\n//         },\n\n//         Type::U16 =\u003e {},\n//         Type::U32 =\u003e todo!(),\n//         Type::Vec =\u003e todo!(),\n//         Type::Bool =\u003e todo!(),\n//         Type::StringTuple =\u003e todo!(),\n//     }\n\n//     Ok(())\n// }\n\npub fn write_bin_vec(stream: \u0026mut dyn Write, vec: \u0026Vec\u003cu8\u003e) -\u003e Result\u003c(), Error\u003e {\n    let length = vec.len() as u16;\n    let length_bytes = length.to_be_bytes();\n    stream.write_all(\u0026length_bytes)?;\n    for byte in vec {\n        stream.write_all(\u0026[*byte])?;\n    }\n    Ok(())\n}\n\npub fn write_string_tuple(stream: \u0026mut dyn Write, value: \u0026(String, String)) -\u003e Result\u003c(), Error\u003e {\n    write_string(stream, \u0026value.0)?;\n    write_string(stream, \u0026value.1)?;\n    Ok(())\n}\n\npub fn write_u8(stream: \u0026mut dyn Write, value: \u0026u8) -\u003e Result\u003c(), Error\u003e {\n    stream.write_all(\u0026[*value])?;\n    Ok(())\n}\n\npub fn write_u16(stream: \u0026mut dyn Write, value: \u0026u16) -\u003e Result\u003c(), Error\u003e {\n    let value_bytes = value.to_be_bytes();\n    stream.write_all(\u0026value_bytes)?;\n    Ok(())\n}\n\npub fn write_u32(stream: \u0026mut dyn Write, value: \u0026u32) -\u003e Result\u003c(), Error\u003e {\n    let value_bytes = value.to_be_bytes();\n    stream.write_all(\u0026value_bytes)?;\n    Ok(())\n}\n\npub fn write_bool(stream: \u0026mut dyn Write, value: \u0026bool) -\u003e Result\u003c(), Error\u003e {\n    let value_bytes = if *value { 1u8 } else { 0u8 };\n    stream.write_all(\u0026[value_bytes])?;\n    Ok(())\n}\n\npub fn write_string_pairs(\n    stream: \u0026mut dyn Write,\n    vec: \u0026Vec\u003c(String, String)\u003e,\n) -\u003e Result\u003c(), Error\u003e {\n    let length = vec.len() as u16;\n    let length_bytes = length.to_be_bytes();\n    stream.write_all(\u0026length_bytes)?;\n    for pair in vec {\n        write_string(stream, \u0026pair.0)?;\n        write_string(stream, \u0026pair.1)?;\n    }\n    Ok(())\n}\n","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":16,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":17,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":19,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":20,"address":[],"length":0,"stats":{"Line":174},"fn_name":null},{"line":23,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":24,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":41},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":9},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":52,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":53,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":55,"address":[],"length":0,"stats":{"Line":187},"fn_name":null},{"line":56,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[],"length":0,"stats":{"Line":21},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":16},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":232},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":232},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":232},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":69},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":69},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":69},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":69},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":44},"fn_name":null},{"line":79,"address":[],"length":0,"stats":{"Line":44},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":44},"fn_name":null},{"line":81,"address":[],"length":0,"stats":{"Line":44},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":54},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":18},"fn_name":null},{"line":90,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":14},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":36},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":11},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":14},"fn_name":null}],"covered":43,"coverable":47},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","tests","broker_tests.rs"],"content":"#[cfg(test)]\nmod tests {\n    use rustic_city_eye::mqtt::connect_properties::ConnectProperties;\n    use rustic_city_eye::mqtt::publish_properties::{PublishProperties, TopicProperties};\n    use rustic_city_eye::mqtt::subscribe_properties::SubscribeProperties;\n    use rustic_city_eye::mqtt::will_properties::WillProperties;\n    use rustic_city_eye::mqtt::{\n        broker::handle_messages, broker::Broker, client_message::ClientMessage,\n        protocol_error::ProtocolError, protocol_return::ProtocolReturn,\n    };\n\n    use std::collections::HashMap;\n    use std::io::Write;\n    use std::net::{TcpListener, TcpStream};\n    use std::sync::{Arc, RwLock};\n    use std::thread;\n\n    #[test]\n    fn test_mensaje_invalido_da_error() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n\n            stream.write_all(\u0026\"Hola\".as_bytes()).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert!(result.is_err());\n    }\n    #[test]\n    fn test_connect() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        let connect_propierties = ConnectProperties {\n            session_expiry_interval: 1,\n            receive_maximum: 2,\n            maximum_packet_size: 10,\n            topic_alias_maximum: 99,\n            request_response_information: true,\n            request_problem_information: false,\n            user_properties: vec![\n                (\"Hola\".to_string(), \"Mundo\".to_string()),\n                (\"Chau\".to_string(), \"Mundo\".to_string()),\n            ],\n            authentication_method: \"test\".to_string(),\n            authentication_data: vec![1_u8, 2_u8, 3_u8, 4_u8, 5_u8],\n        };\n        let will_properties = WillProperties::new(\n            120,\n            1,\n            30,\n            \"plain\".to_string(),\n            \"topic\".to_string(),\n            vec![1, 2, 3, 4, 5],\n            vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        );\n        let connect = ClientMessage::Connect {\n            clean_start: true,\n            last_will_flag: true,\n            last_will_qos: 1,\n            last_will_retain: true,\n            keep_alive: 35,\n            properties: connect_propierties,\n            client_id: \"kvtr33\".to_string(),\n            will_properties,\n            last_will_topic: \"topic\".to_string(),\n            last_will_message: \"chauchis\".to_string(),\n            username: \"prueba\".to_string(),\n            password: \"\".to_string(),\n        };\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            connect.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::ConnackSent);\n    }\n    #[test]\n    fn test_envio_connect_con_id_repetido_y_desconecta() {\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        let connect_propierties = ConnectProperties {\n            session_expiry_interval: 1,\n            receive_maximum: 2,\n            maximum_packet_size: 10,\n            topic_alias_maximum: 99,\n            request_response_information: true,\n            request_problem_information: false,\n            user_properties: vec![\n                (\"Hola\".to_string(), \"Mundo\".to_string()),\n                (\"Chau\".to_string(), \"Mundo\".to_string()),\n            ],\n            authentication_method: \"test\".to_string(),\n            authentication_data: vec![1_u8, 2_u8, 3_u8, 4_u8, 5_u8],\n        };\n        let will_properties = WillProperties::new(\n            120,\n            1,\n            30,\n            \"plain\".to_string(),\n            \"topic\".to_string(),\n            vec![1, 2, 3, 4, 5],\n            vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        );\n        let connect = ClientMessage::Connect {\n            clean_start: true,\n            last_will_flag: true,\n            last_will_qos: 1,\n            last_will_retain: true,\n            keep_alive: 35,\n            properties: connect_propierties,\n            client_id: \"kvtr33\".to_string(),\n            will_properties,\n            last_will_topic: \"topic\".to_string(),\n            last_will_message: \"chauchis\".to_string(),\n            username: \"prueba\".to_string(),\n            password: \"\".to_string(),\n        };\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            connect.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![\"kvtr33\".to_string()]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(\n                stream,\n                topics.clone(),\n                packets.clone(),\n                subs.clone(),\n                clients_ids.clone(),\n            );\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::DisconnectSent);\n    }\n\n    #[test]\n    fn test_subscribe() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let sub = ClientMessage::Subscribe {\n            packet_id: 1,\n            topic_name: \"topico\".to_string(),\n            properties: SubscribeProperties::new(\n                1,\n                vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n                vec![0, 1, 2, 3],\n            ),\n        };\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            sub.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::SubackSent);\n    }\n    #[test]\n    fn test_publish() {\n        // Set up a listener on a local port.\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n        let topic_properties = TopicProperties {\n            topic_alias: 10,\n            response_topic: \"String\".to_string(),\n        };\n\n        let properties = PublishProperties::new(\n            1,\n            10,\n            topic_properties,\n            [1, 2, 3].to_vec(),\n            \"a\".to_string(),\n            1,\n            \"a\".to_string(),\n        );\n\n        let publish = ClientMessage::Publish {\n            packet_id: 1,\n            topic_name: \"mensajes para juan\".to_string(),\n            qos: 1,\n            retain_flag: 1,\n            payload: \"hola soy juan\".to_string(),\n            dup_flag: 1,\n            properties,\n        };\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            publish.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::PubackSent);\n    }\n\n    #[test]\n    fn test_unsubcribe() {\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        let unsub = ClientMessage::Unsubscribe {\n            packet_id: 1,\n            topic_name: \"topico\".to_string(),\n            properties: SubscribeProperties::new(\n                1,\n                vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n                vec![0, 1, 2, 3],\n            ),\n        };\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            unsub.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::UnsubackSent);\n    }\n\n    #[test]\n    fn test_disconnect() {\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n        let disconnect = ClientMessage::Disconnect {\n            reason_code: 1,\n            session_expiry_interval: 1,\n            reason_string: \"pasaron_cosas\".to_string(),\n            user_properties: vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n        };\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            disconnect.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::DisconnectRecieved);\n    }\n\n    #[test]\n    fn test_pingreq() {\n        let listener = TcpListener::bind(\"127.0.0.1:0\").unwrap();\n        let addr = listener.local_addr().unwrap();\n\n        let pingreq = ClientMessage::Pingreq;\n\n        thread::spawn(move || {\n            let mut stream = TcpStream::connect(addr).unwrap();\n            let mut buffer = vec![];\n            pingreq.write_to(\u0026mut buffer).unwrap();\n            stream.write_all(\u0026buffer).unwrap();\n        });\n\n        let topics = HashMap::new();\n        let packets = Arc::new(RwLock::new(HashMap::new()));\n        let subs = vec![];\n        let clients_ids = Arc::new(vec![]);\n        let mut result: Result\u003cProtocolReturn, ProtocolError\u003e =\n            Err(ProtocolError::UnspecifiedError);\n\n        if let Ok((stream, _)) = listener.accept() {\n            result = handle_messages(stream, topics, packets, subs, clients_ids);\n        }\n\n        assert_eq!(result.unwrap(), ProtocolReturn::PingrespSent);\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","kvothe","repos","24C1-Rustic-City-Eye","rustic_city_eye","tests","sub_and_publish.rs"],"content":"// use rustic_city_eye::mqtt::{\n//     broker::Broker, client_message, subscribe_properties::SubscribeProperties,\n// };\n// use std::io::Cursor;\n\n// #[test]\n// fn test_sub_y_pub() -\u003e std::io::Result\u003c()\u003e {\n//     let mut broker = Broker::new(vec![]).unwrap();\n//     let mut subscribe_message = client_message::ClientMessage::Subscribe {\n//         packet_id: 1,\n//         topic_name: \"topico\".to_string(),\n//         properties: SubscribeProperties::new(\n//             1,\n//             vec![(\"propiedad\".to_string(), \"valor\".to_string())],\n//             vec![0, 1, 2, 3],\n//         ),\n//     };\n\n//     let mut stream1 = Cursor::new(Vec::new());\n//     let mut stream2 = Cursor::new(Vec::new());\n\n//     subscribe_message.write_to(\u0026mut stream1).unwrap();\n\n//     broker.handle_client(\u0026mut stream1).unwrap();\n\n//     Ok(())\n// }\n","traces":[],"covered":0,"coverable":0}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('pre', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('code', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>